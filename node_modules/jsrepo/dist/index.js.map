{"version":3,"sources":["../package.json","../src/utils/ascii.ts","../src/utils/blocks/ts/array.ts","../src/utils/blocks/ts/pad.ts","../src/utils/blocks/ts/lines.ts","../src/utils/blocks/package-managers/flags.ts","../src/utils/prompts.ts","../src/utils/persisted.ts","../src/utils/token-manager.ts","../src/utils/ai.ts","../src/utils/context.ts","../src/utils/diff.ts","../src/utils/fetch.ts","../src/utils/get-latest-version.ts","../src/utils/parse-package-name.ts","../src/utils/package.ts","../src/utils/dependencies.ts","../src/utils/files.ts","../src/utils/language-support/css.ts","../src/utils/language-support/html.ts","../src/utils/language-support/javascript.ts","../src/utils/language-support/json.ts","../src/utils/language-support/sass.ts","../src/utils/language-support/svelte.ts","../src/utils/language-support/svg.ts","../src/utils/language-support/vue.ts","../src/utils/language-support/yaml.ts","../src/utils/language-support/index.ts","../src/utils/build/check.ts","../src/utils/build/index.ts","../src/utils/config.ts","../src/utils/registry-providers/internal.ts","../src/utils/blocks.ts","../src/utils/blocks/commander/parsers.ts","../src/utils/blocks/ts/promises.ts","../src/utils/format.ts","../src/utils/get-watermark.ts","../src/utils/preconditions.ts","../src/commands/add.ts","../src/utils/blocks/ts/sleep.ts","../src/commands/auth.ts","../src/commands/build.ts","../src/commands/exec.ts","../src/commands/info.ts","../src/commands/init.ts","../src/utils/mcp.ts","../src/commands/mcp.ts","../src/commands/publish.ts","../src/commands/test.ts","../src/commands/tokens.ts","../src/commands/update.ts","../src/cli.ts","../src/index.ts"],"names":["package_default","unicode","isUnicodeSupported","s","c","fallback","S_STEP_ACTIVE","S_STEP_CANCEL","S_SUCCESS","S_WARN","S_ERROR","VERTICAL_LINE","color","HORIZONTAL_LINE","TOP_RIGHT_CORNER","BOTTOM_RIGHT_CORNER","JUNCTION_RIGHT","JUNCTION_TOP","TOP_LEFT_CORNER","BOTTOM_LEFT_CORNER","WARN","INFO","ERROR","JSREPO","JSREPO_DOT_COM","fromMap","map","fn","items","key","value","sum","arr","total","item","maxLength","max","str","stripVTControlCharacters","leftPadMin","length","padWith","strippedLength","stripAsni","rightPadMin","NEW_LINE_REGEX","get","join","lines","lineNumbers","prefix","transformed","line","i","os","bun","deno","npm","pnpm","yarn","flags","Conf","HTTP_REGISTRY_LIST_KEY","TokenManager","#storage","storage","name","token","secret","registries","registry","index","models","originalFile","newFile","loading","verbose","additionalInstructions","messages","apiKey","getApiKey","prompt","createUpdatePrompt","text","getNextCompletionAnthropic","unwrapCodeFromQuotes","getNextCompletionOpenAI","getNextCompletionOllama","maxTokens","model","first","OpenAI","anthropic","Anthropic","history","message","ollama","rePrompt","quoted","code","l","result","password","isCancel","cancel","packageJson","isWhitespace","trimSingleNewLine","formatDiff","from","to","changes","expand","maxUnchanged","colorRemoved","colorAdded","colorCharsRemoved","colorCharsAdded","onUnchanged","intro","change","lineOffset","linePrefix","hasPreviousChange","hasNextChange","prevLineOffset","ls","shownLines","count","colorLineChange","colorCharChange","sentence","diffChars","chg","iFetch","mfFetch","path","LATEST_VERSION_KEY","EXPIRATION_TIME","getLatestVersion","noCache","version","latestVersion","Ok","response","Err","ver","err","RE_SCOPED","RE_NON_SCOPED","parsePackageName","input","m","findNearestPackageJson","startDir","until","packagePath","fs","segments","getPackage","contents","cleanVersion","returnShouldInstall","dependencies","devDependencies","cwd","tempDeps","tempDevDeps","packageResult","pkg","dep","foundDep","semver","runTasks","tasks","task","runTasksConcurrently","startMessage","stopMessage","t","_spinner","spinner","msg","nextSteps","steps","box","boxen","truncatedList","truncated","remaining","newerVersionAvailable","oldVersion","newVersion","pm","detect","installCommand","resolveCommand","_intro","MODEL_PREFERENCE_KEY","promptUpdateFile","incoming","current","config","options","acceptedChanges","updatedContent","messageHistory","diffLines","formattedDiff","totalChanges","a","confirmOptions","confirmResult","select","modelResult","val","content","log","formatFile","promptInstallDependencies","deps","devDeps","yes","no","ignoreWorkspace","install","confirm","installDependencies","taskLog","title","BAR","ACTIVE","SUCCESS","output","frame","clear","eraseTitle","terminalWidth","height","cursor","erase","print","limit","data","frameHeight","dev","args","noWorkspace","add","program","proc","x","templatePattern","resolveLocalDependencyTemplate","template","destPath","destDir","_","category","relative","transformRemoteContent","file","imports","watermark","prettierOptions","biomeOptions","lang","languages","literal","resolvedImport","literalRegex","escapeStringRegexp","formatter","newContent","matchJSDescendant","searchFilePath","MATCH_EXTENSIONS","endsWithOneOf","dir","files","parsedSearch","tryGetTsconfig","searchPath","getTsconfig","css","fileName","filePath","isSubDir","excludeDeps","dirs","containingDir","sourceCode","parseResult","resolveResult","resolveImports","imp","formatError","biome","Biome","Distribution","html","ast","walk","node","enter","n","attr","cn","getJavascriptImports","oxc","modules","mod","exp","entry","typescript","dn","format","json","jsonc","sass","gn","hn","svelte","root","plugin","wn","svg","vue","parsed","mods","xn","yaml","Sn","moduleSpecifiers","doNotInstall","errors","localDeps","specifier","builtinModules","localDep","resolveLocalImport","tryResolveLocalAlias","depInfo","validatePackageName","resolveRemoteDeps","dropExtension","alias","modPath","absPath","longestMatch","containingPath","parsePath","localPath","block","rest","trimmedBlock","blockSpecifier","configResult","matcher","createPathsMatcher","paths","foundMod","searchForModule","pathResolved","shouldDropExtension","resolutionEquality","pathA","pathB","validExtensions","parsedA","parsedB","pathAWithoutExtension","pathBWithoutExtension","containing","modParsed","newPath","fileParsed","prettyPath","exemptDeps","pkgPath","packageDevDependencies","packageDependencies","FRAMEWORKS","ruleLevelSchema","V","ruleKeySchema","rules","manifest","depCategoryName","depBlockName","depCategory","cat","error","b","categoryName","chain","searchForDep","listedBlocks","frameworkDeps","d","frameworkDep","configFile","ruleConfigSchema","DEFAULT_CONFIG","runRules","ruleConfig","warnings","rule","conf","level","ruleErrors","search","categories","newChain","blockName","depBlock","found","isDependedOn","TEST_SUFFIXES","DOCS_SUFFIXES","isTestFile","isDocsFile","buildBlocksDirectory","blocksPath","ignore","categoryPath","categoryDir","dirName","shouldIncludeCategory","listCategory","shouldListCategory","blockDir","relativePath","transformBlockName","listBlock","shouldListBlock","shouldIncludeBlock","resolver","testsPath","f","suffix","docsPath","local","localDepsSet","depsSet","devDepsSet","hasTests","hasDocs","blockFiles","walkFiles","base","relativeFilePath","subFiles","imps","k","v","buildConfigFiles","configFiles","pruneUnused","pruned","catBlocks","IGNORES","PROJECT_CONFIG_NAME","REGISTRY_CONFIG_NAME","formatterSchema","pathsSchema","projectConfigSchema","getProjectConfig","registryConfigSchema","accessLevel","manifestMeta","peerDependencySchema","configFileSchema","getRegistryConfig","resolvePaths","newPaths","p","resolved","tryResolvePath","unresolvedPath","getPathForBlock","resolvedPaths","directory","internalFetchRaw","state","resourcePath","fetchRaw","getProviderToken","internalFetchManifest","fetchManifest","provider","url","getProviderState","repo","selectProvider","http","cached","providers","forEachPathGetProviderState","repos","getProviderResult","providerState","fetchBlocks","blocksMap","getManifestResult","getRemoteBlocks","manifests","fetchManifests","resolveTree","blockSpecifiers","repoPaths","installed","blocks","repoIdent","tempBlock","subDeps","getInstalled","installedBlocks","baseDir","blockPath","preloadBlocks","preloaded","includedFiles","getBlockFilePath","parseRecord","pair","InvalidArgumentError","immediate","res","loadFormatterConfig","Un","configPath","getWatermark","repoUrl","checkPreconditions","incompatible","expected","msgs","last","versionMessage","schema","L","Command","Option","blockNames","opts","_add","outro","noConfig","shouldContinue","mustResolveRepos","resolveAllRepos","repoPath","resolvedRepos","installingBlockNames","promptResult","multiselect","shortName","blockExists","label","installingBlocks","store","zeroConfigKey","zeroConfigParsed","zeroConfig","includeTests","addWatermark","defaultFormatter","updatedBlocks","overwriteAll","preloadedBlocks","updatedFiles","preloadedBlock","fullSpecifier","shortSpecifier","overwriteBlocks","installing","spec","overwrite","remoteContent","localContent","updateResult","updatedFile","folder","installResult","cmd","step","next","sleep","durationMs","Le","auth","_auth","tokenManager","hardwareId","nodeMachineId","anonSessionId","BASE_URL","timeout","pollingTimeout","endpoint","O","build","MANIFEST_FILE","_build","mergedVal","outDir","manifestOut","oldManifest","parseManifest","newDirPath","ig","ignoreFile","dirPath","builtCategories","createManifest","warning","prunedCategories","originalPath","he","exec","Argument","script","command","_exec","tempDirBase","tempDirectoryRelative","tempDirectory","resolvedPathsResult","addedBlocks","providerInfo","getSourceFile","sourceFile","sourcePath","pathFolder","packageContent","startIndex","arg","passthroughArgs","runningBlock","Jt","info","_info","jsrepo","headers","fetch","formattedOutput","registryInfo","out","multipleOfThree","num","blockTitles","minBlockTitleLength","isMultipleOfThree","isLast","tag","F","init","_initProject","_initRegistry","initialConfig","tsconfigResult","defaultPath","defaultPathResult","setupRepo","promptForRegistryConfig","r","configContent","tokenKey","fullFilePath","fileContents","matchedPath","originalRemoteContent","configurePaths","configuredValue","configurePublish","nameResponse","promptForScriptKey","alreadyInstalled","buildScript","publishScript","runScript","scriptKey","placeholder","listComponentsTool","listComponents","states","components","getComponentCodeTool","getComponentCode","component","includeDocs","getConfigFilesTool","getConfigFiles","requiredOnly","searchRegistriesTool","searchRegistries","query","cliReferenceTool","cliReference","cli","o","connectServer","server","Server","CallToolRequestSchema","request","ListToolsRequestSchema","transport","StdioServerTransport","mcp","I","publish","_publish","scope","registryName","NAME_REGEX","tempOutDir","readmePath","dest","access","tarBuffer","$e","test","_test","tempTestDirectory","cleanUp","testingBlocks","testingBlocksMapped","parsedRepo","testFiles","testFile","moduleSpecifier","newModuleSpecifier","testCommand","Me","services","tokens","service","_tokens","configuredRegistries","selectedService","promptHttpLogout","serviceName","selectedRegistry","registryUrl","ne","update","_update","updatingBlockNames","updatingBlocks"],"mappings":"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","file":"index.js","sourcesContent":["{\n\t\"name\": \"jsrepo\",\n\t\"description\": \"A CLI to add shared code from remote repositories.\",\n\t\"version\": \"2.4.3\",\n\t\"license\": \"MIT\",\n\t\"homepage\": \"https://jsrepo.dev\",\n\t\"author\": {\n\t\t\"name\": \"Aidan Bleser\",\n\t\t\"url\": \"https://github.com/ieedan\"\n\t},\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"git+https://github.com/jsrepojs/jsrepo\"\n\t},\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/jsrepojs/jsrepo/issues\"\n\t},\n\t\"keywords\": [\"repo\", \"cli\", \"svelte\", \"vue\", \"typescript\", \"javascript\", \"shadcn\", \"registry\"],\n\t\"type\": \"module\",\n\t\"packageManager\": \"pnpm@10.8.1\",\n\t\"exports\": {\n\t\t\".\": {\n\t\t\t\"types\": \"./dist/api/index.d.ts\",\n\t\t\t\"default\": \"./dist/api/index.js\"\n\t\t}\n\t},\n\t\"bin\": \"./dist/index.js\",\n\t\"main\": \"./dist/index.js\",\n\t\"files\": [\"./schemas/**/*\", \"dist/**/*\"],\n\t\"scripts\": {\n\t\t\"start\": \"tsup --silent && node ./dist/index.js\",\n\t\t\"build\": \"tsup\",\n\t\t\"generate:reference\": \"pnpm dlx tsx ./scripts/generate-reference.ts \",\n\t\t\"run:dev\": \"node ./dist/index.js\",\n\t\t\"format\": \"biome format --write\",\n\t\t\"lint\": \"biome lint --write\",\n\t\t\"check\": \"biome check && pnpm check:types\",\n\t\t\"test\": \"vitest\",\n\t\t\"check:types\": \"tsc\",\n\t\t\"changeset:version\": \"changeset version && pnpm generate:reference && pnpm format\",\n\t\t\"ci:release\": \"pnpm build && changeset publish\",\n\t\t\"mcp:inspector\": \"pnpm build && pnpm dlx @modelcontextprotocol/inspector node ./dist/index.js mcp\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@biomejs/biome\": \"1.9.4\",\n\t\t\"@changesets/cli\": \"^2.29.4\",\n\t\t\"@types/make-fetch-happen\": \"^10.0.4\",\n\t\t\"@types/node\": \"^22.15.24\",\n\t\t\"@types/semver\": \"^7.7.0\",\n\t\t\"@types/validate-npm-package-name\": \"^4.0.2\",\n\t\t\"pkg-pr-new\": \"^0.0.51\",\n\t\t\"tsup\": \"^8.5.0\",\n\t\t\"typescript\": \"^5.8.3\",\n\t\t\"vitest\": \"^3.1.4\"\n\t},\n\t\"dependencies\": {\n\t\t\"@anthropic-ai/sdk\": \"^0.52.0\",\n\t\t\"@biomejs/js-api\": \"^0.7.1\",\n\t\t\"@biomejs/wasm-nodejs\": \"^1.9.4\",\n\t\t\"@clack/prompts\": \"^0.11.0\",\n\t\t\"@modelcontextprotocol/sdk\": \"^1.12.0\",\n\t\t\"boxen\": \"^8.0.1\",\n\t\t\"chalk\": \"^5.4.1\",\n\t\t\"commander\": \"^14.0.0\",\n\t\t\"conf\": \"^13.1.0\",\n\t\t\"css-dependency\": \"^0.0.3\",\n\t\t\"diff\": \"^8.0.2\",\n\t\t\"escape-string-regexp\": \"^5.0.0\",\n\t\t\"estree-walker\": \"^3.0.3\",\n\t\t\"get-tsconfig\": \"^4.10.1\",\n\t\t\"ignore\": \"^7.0.4\",\n\t\t\"is-unicode-supported\": \"^2.1.0\",\n\t\t\"make-fetch-happen\": \"^14.0.3\",\n\t\t\"node-machine-id\": \"^1.1.12\",\n\t\t\"ollama\": \"^0.5.14\",\n\t\t\"openai\": \"^4.103.0\",\n\t\t\"oxc-parser\": \"^0.72.1\",\n\t\t\"package-manager-detector\": \"^1.3.0\",\n\t\t\"parse5\": \"^7.3.0\",\n\t\t\"pathe\": \"^2.0.3\",\n\t\t\"prettier\": \"^3.5.3\",\n\t\t\"semver\": \"^7.7.2\",\n\t\t\"sisteransi\": \"^1.0.5\",\n\t\t\"svelte\": \"^5.33.6\",\n\t\t\"tar\": \"^7.4.3\",\n\t\t\"tinyexec\": \"^1.0.1\",\n\t\t\"valibot\": \"1.1.0\",\n\t\t\"validate-npm-package-name\": \"^6.0.0\",\n\t\t\"vue\": \"^3.5.16\"\n\t}\n}\n","import color from 'chalk';\nimport isUnicodeSupported from 'is-unicode-supported';\n\nconst unicode = isUnicodeSupported();\n\nconst s = (c: string, fallback: string) => (unicode ? c : fallback);\n\nexport const S_STEP_ACTIVE = s('', '*');\nexport const S_STEP_CANCEL = s('', 'x');\nexport const S_STEP_ERROR = s('', 'x');\nexport const S_STEP_SUBMIT = s('', 'o');\nexport const S_INFO = s('', '');\nexport const S_SUCCESS = s('', '*');\nexport const S_WARN = s('', '!');\nexport const S_ERROR = s('', 'x');\n\nexport const VERTICAL_LINE = color.gray(s('', '|'));\nexport const HORIZONTAL_LINE = color.gray(s('', '-'));\nexport const TOP_RIGHT_CORNER = color.gray(s('', '+'));\nexport const BOTTOM_RIGHT_CORNER = color.gray(s('', '+'));\nexport const JUNCTION_RIGHT = color.gray(s('', '+'));\nexport const JUNCTION_TOP = color.gray(s('', '+'));\nexport const TOP_LEFT_CORNER = color.gray(s('', 'T'));\nexport const BOTTOM_LEFT_CORNER = color.gray(s('', '-'));\n\nexport const WARN = color.bgRgb(245, 149, 66).black(' WARN ');\nexport const INFO = color.bgBlueBright.white(' INFO ');\nexport const ERROR = color.bgRedBright.white(' ERROR ');\n\nexport const JSREPO = color.hex('#f7df1e')('jsrepo');\nexport const JSREPO_DOT_COM = color.hex('#f7df1e').bold('jsrepo.com');\n","/*\n\tInstalled from github/ieedan/std\n*/\n\nimport { stripVTControlCharacters } from 'node:util';\n\n/** Maps the provided map into an array using the provided mapping function.\n *\n * @param map Map to be entered into an array\n * @param fn A mapping function to transform each pair into an item\n * @returns\n *\n * ## Usage\n * ```ts\n * console.log(map); // Map(5) { 0 => 5, 1 => 4, 2 => 3, 3 => 2, 4 => 1 }\n *\n * const arr = fromMap(map, (_, value) => value);\n *\n * console.log(arr); // [5, 4, 3, 2, 1]\n * ```\n */\nexport function fromMap<K, V, T>(map: Map<K, V>, fn: (key: K, value: V) => T): T[] {\n\tconst items: T[] = [];\n\n\tfor (const [key, value] of map) {\n\t\titems.push(fn(key, value));\n\t}\n\n\treturn items;\n}\n\n/** Calculates the sum of all elements in the array based on the provided function.\n *\n * @param arr Array of items to be summed.\n * @param fn Summing function\n * @returns\n *\n * ## Usage\n *\n * ```ts\n * const total = sum([1, 2, 3, 4, 5], (num) => num);\n *\n * console.log(total); // 15\n * ```\n */\nexport function sum<T>(arr: T[], fn: (item: T) => number): number {\n\tlet total = 0;\n\n\tfor (const item of arr) {\n\t\ttotal = total + fn(item);\n\t}\n\n\treturn total;\n}\n\n/** Maps the provided array into a map\n *\n * @param arr Array of items to be entered into a map\n * @param fn A mapping function to transform each item into a key value pair\n * @returns\n *\n * ## Usage\n * ```ts\n * const map = toMap([5, 4, 3, 2, 1], (item, i) => [i, item]);\n *\n * console.log(map); // Map(5) { 0 => 5, 1 => 4, 2 => 3, 3 => 2, 4 => 1 }\n * ```\n */\nexport function toMap<T, K, V>(\n\tarr: T[],\n\tfn: (item: T, index: number) => [key: K, value: V]\n): Map<K, V> {\n\tconst map = new Map<K, V>();\n\n\tfor (let i = 0; i < arr.length; i++) {\n\t\tconst [key, value] = fn(arr[i], i);\n\n\t\tmap.set(key, value);\n\t}\n\n\treturn map;\n}\n\nexport function maxLength(arr: string[]): number {\n\tlet max = 0;\n\n\tfor (const item of arr) {\n\t\tconst str = stripVTControlCharacters(item);\n\t\tif (str.length > max) {\n\t\t\tmax = str.length;\n\t\t}\n\t}\n\n\treturn max;\n}\n","/*\n\tInstalled from github/ieedan/std\n*/\n\nimport { stripVTControlCharacters as stripAsni } from 'node:util';\n\n/** Adds the `padWith` (default `' '`) to the string the amount of times specified by the `space` argument\n *\n * @param str String to add padding to\n * @param space Whitespace to add\n * @param padWith Character to use to pad the string\n * @returns\n *\n * ## Usage\n * ```ts\n * const padded = leftPad(\"Hello\", 3, \".\");\n *\n * console.log(padded); // '...Hello'\n * ```\n */\nexport function leftPad(str: string, space: number, padWith = ' '): string {\n\treturn padWith.repeat(space) + str;\n}\n\n/** Adds the `padWith` until the string length matches the `length`\n *\n * @param str\n * @param length\n * @param padWith\n *\n * ## Usage\n * ```ts\n * const padded = leftPadMin(\"1\", 3, \".\");\n *\n * console.log(padded); // '..1'\n * ```\n */\nexport function leftPadMin(str: string, length: number, padWith = ' '): string {\n\tconst strippedLength = stripAsni(str).length;\n\n\tif (strippedLength > length)\n\t\tthrow new Error('String length is greater than the length provided.');\n\n\treturn padWith.repeat(length - strippedLength) + str;\n}\n\n/** Adds the `padWith` (default `' '`) to the string the amount of times specified by the `space` argument\n *\n * @param str String to add padding to\n * @param space Whitespace to add\n * @param padWith Character to use to pad the string\n * @returns\n *\n * ## Usage\n * ```ts\n * const padded = rightPad(\"Hello\", 3, \".\");\n *\n * console.log(padded); // 'Hello...'\n * ```\n */\nexport function rightPad(str: string, space: number, padWith = ' '): string {\n\treturn str + padWith.repeat(space);\n}\n\n/** Adds the `padWith` until the string length matches the `length`\n *\n * @param str\n * @param length\n * @param padWith\n *\n * ## Usage\n * ```ts\n * const padded = rightPadMin(\"1\", 3, \".\");\n *\n * console.log(padded); // '1..'\n * ```\n */\nexport function rightPadMin(str: string, length: number, padWith = ' '): string {\n\tconst strippedLength = stripAsni(str).length;\n\n\tif (strippedLength > length)\n\t\tthrow new Error('String length is greater than the length provided.');\n\n\treturn str + padWith.repeat(length - strippedLength);\n}\n\n/** Pads the string with the `padWith` so that it appears in the center of a new string with the provided length.\n *\n * @param str\n * @param length\n * @param padWith\n * @returns\n *\n * ## Usage\n * ```ts\n * const str = \"Hello, World!\";\n *\n * const padded = centerPad(str, str.length + 4);\n *\n * console.log(padded); // '  Hello, World!  '\n * ```\n */\nexport function centerPad(str: string, length: number, padWith = ' '): string {\n\tconst strippedLength = stripAsni(str).length;\n\n\tif (strippedLength > length) {\n\t\tthrow new Error('String length is greater than the length provided.');\n\t}\n\n\tconst overflow = length - strippedLength;\n\n\tconst paddingLeft = Math.floor(overflow / 2);\n\n\tconst paddingRight = Math.ceil(overflow / 2);\n\n\treturn padWith.repeat(paddingLeft) + str + padWith.repeat(paddingRight);\n}\n","/*\n\tInstalled from github/ieedan/std\n*/\n\nimport os from 'node:os';\nimport { leftPadMin } from './pad';\n\n/** Regex used to split on new lines\n *\n * ```\n * /\\n|\\r\\n/g\n * ```\n */\nexport const NEW_LINE_REGEX = /\\n|\\r\\n/g;\n\n/** Splits str into an array of lines.\n *\n * @param str\n * @returns\n *\n * ## Usage\n *\n * ```ts\n * lines.split(\"hello\\\\nhello\\nhello\"); // [\"hello\\\\nhello\", \"hello\"]\n * ```\n */\nexport function get(str: string): string[] {\n\treturn str.split(NEW_LINE_REGEX);\n}\n\nexport type Options = {\n\tlineNumbers: boolean;\n\tprefix: (line: number, lineCount: number) => string;\n};\n\n/** Joins the array of lines back into a string using the platform specific EOL.\n *\n * @param lines\n * @returns\n *\n * ## Usage\n *\n * ```ts\n * lines.join([\"1\", \"2\", \"3\"]); // \"1\\n2\\n3\" or on windows \"1\\r\\n2\\r\\n3\"\n *\n * // add line numbers\n * lines.join([\"import { } from '.'\", \"console.log('test')\"], { lineNumbers: true });\n * // 1 import {  } from '.'\n * // 2 console.log('test')\n *\n * // add a custom prefix\n * lines.join([\"import { } from '.'\", \"console.log('test')\"], { prefix: () => \" + \" });\n * // + import {  } from '.'\n * // + console.log('test')\n * ```\n */\nexport function join(\n\tlines: string[],\n\t{ lineNumbers = false, prefix }: Partial<Options> = {}\n): string {\n\tlet transformed = lines;\n\n\tif (lineNumbers) {\n\t\tconst length = lines.length.toString().length + 1;\n\n\t\ttransformed = transformed.map((line, i) => `${leftPadMin(`${i + 1}`, length)} ${line}`);\n\t}\n\n\tif (prefix !== undefined) {\n\t\ttransformed = transformed.map((line, i) => `${prefix(i, lines.length)}${line}`);\n\t}\n\n\treturn transformed.join(os.EOL);\n}\n","import type { Agent } from 'package-manager-detector';\n\nexport type Flags = {\n\t'no-workspace'?: string;\n\t'install-as-dev-dependency': string;\n};\n\nexport const bun: Flags = {\n\t'no-workspace': '--no-workspace',\n\t'install-as-dev-dependency': '-D',\n};\n\nexport const deno: Flags = {\n\t'install-as-dev-dependency': '-D',\n};\n\nexport const npm: Flags = {\n\t'no-workspace': '--workspaces=false',\n\t'install-as-dev-dependency': '-D',\n};\n\nexport const pnpm: Flags = {\n\t'no-workspace': '--ignore-workspace',\n\t'install-as-dev-dependency': '-D',\n};\n\nexport const yarn: Flags = {\n\t'no-workspace': '--focus',\n\t'install-as-dev-dependency': '-D',\n};\n\nexport const flags: Record<Agent, Flags> = {\n\tbun,\n\tnpm,\n\tpnpm,\n\tdeno,\n\tyarn,\n\t'yarn@berry': yarn,\n\t'pnpm@6': pnpm,\n};\n","import { stripVTControlCharacters as stripAsni } from 'node:util';\nimport type { PartialConfiguration } from '@biomejs/wasm-nodejs';\nimport { cancel, confirm, intro, isCancel, log, select, spinner, text } from '@clack/prompts';\nimport boxen from 'boxen';\nimport color from 'chalk';\nimport { program } from 'commander';\nimport { diffLines } from 'diff';\nimport { type Agent, detect, resolveCommand } from 'package-manager-detector';\nimport type * as prettier from 'prettier';\nimport semver from 'semver';\nimport { cursor, erase } from 'sisteransi';\nimport { type Message, type ModelName, models } from './ai';\nimport * as ascii from './ascii';\nimport type { ProjectConfig } from './config';\nimport { packageJson } from './context';\nimport { installDependencies } from './dependencies';\nimport { formatDiff } from './diff';\nimport { formatFile } from './files';\nimport { getLatestVersion } from './get-latest-version';\nimport { returnShouldInstall } from './package';\nimport * as persisted from './persisted';\n\nexport type Task = {\n\tloadingMessage: string;\n\tcompletedMessage: string;\n\trun: () => Promise<void>;\n};\n\ntype TaskOptions = {\n\tloading: ReturnType<typeof spinner>;\n};\n\nexport async function runTasks(tasks: Task[], { loading }: TaskOptions) {\n\tfor (const task of tasks) {\n\t\tloading.start(task.loadingMessage);\n\n\t\ttry {\n\t\t\tawait task.run();\n\t\t} catch (err) {\n\t\t\tloading.stop(`Error while ${task.loadingMessage}`);\n\t\t\tconsole.error(err);\n\t\t}\n\n\t\tloading.stop(task.completedMessage);\n\t}\n}\n\nexport type ConcurrentTask = {\n\trun: ({ message }: { message: (str: string) => void }) => Promise<void>;\n};\n\nexport type ConcurrentOptions = {\n\tloading: ReturnType<typeof spinner>;\n\tstartMessage: string;\n\tstopMessage: string;\n\ttasks: ConcurrentTask[];\n};\n\nexport async function runTasksConcurrently({\n\ttasks,\n\tstartMessage,\n\tstopMessage,\n\tloading,\n}: ConcurrentOptions) {\n\tloading.start(startMessage);\n\n\tawait Promise.all([...tasks.map((t) => t.run({ message: loading.message }))]);\n\n\tloading.stop(stopMessage);\n}\n\n/** A spinner compatible with verbose logging\n *\n * @param param0\n * @returns\n */\nfunction _spinner({\n\tverbose,\n}: { verbose?: (msg: string) => void } = {}): ReturnType<typeof spinner> {\n\tconst loading = spinner();\n\n\treturn {\n\t\tmessage: (msg) => {\n\t\t\tif (verbose) {\n\t\t\t\tverbose(msg ?? '');\n\t\t\t} else {\n\t\t\t\tloading.message(msg);\n\t\t\t}\n\t\t},\n\t\tstop: (msg) => {\n\t\t\tif (verbose) {\n\t\t\t\tverbose(msg ?? '');\n\t\t\t} else {\n\t\t\t\tloading.stop(msg);\n\t\t\t}\n\t\t},\n\t\tstart: (msg) => {\n\t\t\tif (verbose) {\n\t\t\t\tverbose(msg ?? '');\n\t\t\t} else {\n\t\t\t\tloading.start(msg);\n\t\t\t}\n\t\t},\n\t};\n}\n\nexport function nextSteps(steps: string[]): string {\n\tconst box = boxen(steps.join('\\n'), {\n\t\ttitle: 'Next Steps',\n\t\ttextAlignment: 'left',\n\t\tpadding: 1,\n\t\tborderColor: 'gray',\n\t\tborderStyle: {\n\t\t\ttopLeft: stripAsni(ascii.JUNCTION_RIGHT),\n\t\t\tbottomLeft: stripAsni(ascii.JUNCTION_RIGHT),\n\t\t\ttopRight: stripAsni(ascii.TOP_RIGHT_CORNER),\n\t\t\ttop: stripAsni(ascii.HORIZONTAL_LINE),\n\t\t\tbottom: stripAsni(ascii.HORIZONTAL_LINE),\n\t\t\tbottomRight: stripAsni(ascii.BOTTOM_RIGHT_CORNER),\n\t\t\tleft: stripAsni(ascii.VERTICAL_LINE),\n\t\t\tright: stripAsni(ascii.VERTICAL_LINE),\n\t\t},\n\t});\n\n\treturn `${ascii.VERTICAL_LINE}\\n${box}\\n`;\n}\n\nexport function truncatedList(items: string[], maxLength = 3) {\n\tconst truncated = items.slice(0, maxLength);\n\n\tconst remaining = items.length - truncated.length;\n\n\treturn `${truncated.join(', ')}${remaining > 0 ? ` and ${remaining} other(s)` : ''}`;\n}\n\nasync function newerVersionAvailable(name: string, oldVersion: string, newVersion: string) {\n\tconst pm = (await detect({ cwd: process.cwd() }))?.agent ?? 'npm';\n\n\tconst installCommand = resolveCommand(pm, 'global', ['jsrepo@latest']);\n\n\tconst text: string[] = [\n\t\t`Update available! ${color.redBright(oldVersion)} -> ${color.greenBright(newVersion)}`,\n\t\t`${color.cyan('Changelog')}: https://github.com/jsrepojs/jsrepo/releases/tag/${name}@${newVersion}`,\n\t\t`Run ${color.cyan(`${installCommand?.command} ${installCommand?.args.join(' ')}`)} to update!`,\n\t\t'',\n\t\t`${color.yellowBright('Star')} on GitHub for updates: https://github.com/jsrepojs/jsrepo`,\n\t];\n\n\tconst box = boxen(text.join('\\n'), {\n\t\tborderColor: 'gray',\n\t\tpadding: 1,\n\t\tmargin: 1,\n\t\ttextAlignment: 'center',\n\t});\n\n\treturn box;\n}\n\nasync function _intro() {\n\tconsole.clear();\n\n\tconst latestVersion = await getLatestVersion();\n\n\tif (latestVersion.isOk()) {\n\t\tif (semver.lt(packageJson.version, latestVersion.unwrap())) {\n\t\t\tconsole.info(\n\t\t\t\tawait newerVersionAvailable(\n\t\t\t\t\tpackageJson.name,\n\t\t\t\t\tpackageJson.version,\n\t\t\t\t\tlatestVersion.unwrap()\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tintro(\n\t\t`${color.bgHex('#f7df1e').black(` ${packageJson.name} `)}${color.gray(` v${packageJson.version} `)}`\n\t);\n}\n\ntype UpdateBlockOptions = {\n\tincoming: {\n\t\tcontent: string;\n\t\tpath: string;\n\t};\n\tcurrent: {\n\t\tcontent: string;\n\t\tpath: string;\n\t};\n\tconfig: {\n\t\tformatter: ProjectConfig['formatter'];\n\t\tprettierOptions: prettier.Options | null;\n\t\tbiomeOptions: PartialConfiguration | null;\n\t};\n\toptions: {\n\t\tyes: boolean;\n\t\tno: boolean;\n\t\texpand: boolean;\n\t\tmaxUnchanged: number;\n\t\tverbose?: (msg: string) => void;\n\t\tloading: ReturnType<typeof spinner>;\n\t};\n};\n\ntype UpdateBlockResult =\n\t| {\n\t\t\tapplyChanges: true;\n\t\t\tupdatedContent: string;\n\t  }\n\t| {\n\t\t\tapplyChanges: false;\n\t  };\n\nconst MODEL_PREFERENCE_KEY = 'model-preference';\n\nexport async function promptUpdateFile({\n\tincoming,\n\tcurrent,\n\tconfig,\n\toptions,\n}: UpdateBlockOptions): Promise<UpdateBlockResult> {\n\tconst storage = persisted.get();\n\n\tprocess.stdout.write(`${ascii.VERTICAL_LINE}\\n`);\n\n\tlet acceptedChanges = false;\n\n\tlet updatedContent = incoming.content;\n\n\tlet model: ModelName = storage.get(MODEL_PREFERENCE_KEY, 'Claude 3.5 Sonnet') as ModelName;\n\n\tlet messageHistory: Message[] = [];\n\n\twhile (true) {\n\t\tconst changes = diffLines(current.content, updatedContent);\n\n\t\t// print diff\n\t\tconst formattedDiff = formatDiff({\n\t\t\tfrom: incoming.path,\n\t\t\tto: current.path,\n\t\t\tchanges,\n\t\t\texpand: options.expand,\n\t\t\tmaxUnchanged: options.maxUnchanged,\n\t\t\tprefix: () => `${ascii.VERTICAL_LINE}  `,\n\t\t\tonUnchanged: ({ from, to, prefix }) =>\n\t\t\t\t`${prefix?.() ?? ''}${color.cyan(from)}  ${color.gray(to)} ${color.gray('(unchanged)')}\\n`,\n\t\t\tintro: ({ from, to, changes, prefix }) => {\n\t\t\t\tconst totalChanges = changes.filter((a) => a.added || a.removed).length;\n\n\t\t\t\treturn `${prefix?.() ?? ''}${color.cyan(from)}  ${color.gray(to)} (${totalChanges} change${totalChanges === 1 ? '' : 's'})\\n${prefix?.() ?? ''}\\n`;\n\t\t\t},\n\t\t});\n\n\t\tprocess.stdout.write(formattedDiff);\n\n\t\t// if there are no changes then don't ask\n\t\tif (changes.length > 1 || current.content === '') {\n\t\t\tacceptedChanges = options.yes;\n\n\t\t\tif (!options.yes && !options.no) {\n\t\t\t\tconst confirmOptions = [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Accept',\n\t\t\t\t\t\tvalue: 'accept',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Reject',\n\t\t\t\t\t\tvalue: 'reject',\n\t\t\t\t\t},\n\t\t\t\t];\n\n\t\t\t\tif (messageHistory.length > 0) {\n\t\t\t\t\tconfirmOptions.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: ` ${color.yellow('Update with AI')}  ${color.gray('(Iterate)')}`,\n\t\t\t\t\t\t\tvalue: 'update-iterate',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: ` ${color.yellow('Update with AI')}  ${color.gray('(Start over)')}`,\n\t\t\t\t\t\t\tvalue: 'update',\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconfirmOptions.push({\n\t\t\t\t\t\tlabel: ` ${color.yellow('Update with AI')} `,\n\t\t\t\t\t\tvalue: 'update',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// prompt the user\n\t\t\t\tconst confirmResult = await select({\n\t\t\t\t\tmessage: 'Accept changes?',\n\t\t\t\t\toptions: confirmOptions,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(confirmResult)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tif (confirmResult === 'update' || confirmResult === 'update-iterate') {\n\t\t\t\t\t// clear chat context\n\t\t\t\t\tif (confirmResult === 'update') {\n\t\t\t\t\t\tmessageHistory = [];\n\t\t\t\t\t}\n\n\t\t\t\t\t// prompt for model\n\t\t\t\t\tconst modelResult = await select({\n\t\t\t\t\t\tmessage: 'Select a model',\n\t\t\t\t\t\toptions: Object.keys(models).map((key) => ({\n\t\t\t\t\t\t\tlabel: key,\n\t\t\t\t\t\t\tvalue: key,\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tinitialValue: model,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isCancel(modelResult)) {\n\t\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\t\tprocess.exit(0);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (modelResult !== model) {\n\t\t\t\t\t\tstorage.set(MODEL_PREFERENCE_KEY, modelResult);\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel = modelResult as ModelName;\n\n\t\t\t\t\tconst additionalInstructions = await text({\n\t\t\t\t\t\tmessage: 'Additional instructions:',\n\t\t\t\t\t\tdefaultValue: 'None',\n\t\t\t\t\t\tvalidate: (val) => {\n\t\t\t\t\t\t\t// don't care if no messages have been sent\n\t\t\t\t\t\t\tif (messageHistory.length === 0) return undefined;\n\n\t\t\t\t\t\t\tif (val.trim() === '') {\n\t\t\t\t\t\t\t\treturn 'Please provide additional context so that I know how I can improve.';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isCancel(additionalInstructions)) {\n\t\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\t\tprocess.exit(0);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst { content, prompt } = await models[model].updateFile({\n\t\t\t\t\t\t\toriginalFile: current,\n\t\t\t\t\t\t\tnewFile: {\n\t\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\t\tconfirmResult === 'update-iterate'\n\t\t\t\t\t\t\t\t\t\t? updatedContent\n\t\t\t\t\t\t\t\t\t\t: incoming.content,\n\t\t\t\t\t\t\t\tpath: incoming.path,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tadditionalInstructions:\n\t\t\t\t\t\t\t\tadditionalInstructions !== 'None'\n\t\t\t\t\t\t\t\t\t? additionalInstructions\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tloading: options.loading,\n\t\t\t\t\t\t\tverbose: options.verbose,\n\t\t\t\t\t\t\tmessages: messageHistory,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tupdatedContent = content;\n\n\t\t\t\t\t\t// add messages to history\n\t\t\t\t\t\tmessageHistory.push({ role: 'user', content: prompt });\n\t\t\t\t\t\tmessageHistory.push({ role: 'assistant', content: content });\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\toptions.loading.stop();\n\t\t\t\t\t\tlog.error(color.red(`Error getting completions: ${err}`));\n\t\t\t\t\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}\\n`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tupdatedContent = await formatFile({\n\t\t\t\t\t\tfile: {\n\t\t\t\t\t\t\tcontent: updatedContent,\n\t\t\t\t\t\t\tdestPath: current.path,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbiomeOptions: config.biomeOptions,\n\t\t\t\t\t\tprettierOptions: config.prettierOptions,\n\t\t\t\t\t\tformatter: config.formatter,\n\t\t\t\t\t});\n\n\t\t\t\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}\\n`);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tacceptedChanges = confirmResult === 'accept';\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tbreak; // there were no changes or changes were automatically accepted\n\t}\n\n\tif (acceptedChanges) {\n\t\treturn { applyChanges: true, updatedContent };\n\t}\n\n\treturn { applyChanges: false };\n}\n\ntype InstallDependenciesOptions = {\n\tyes: boolean;\n\tno?: boolean;\n\tcwd: string;\n\tpm: Agent;\n\tignoreWorkspace?: boolean;\n};\n\ntype InstallDependenciesResult = {\n\t/** True if dependencies were installed */\n\tinstalled: boolean;\n\tdependencies: Set<string>;\n\tdevDependencies: Set<string>;\n};\n\nexport async function promptInstallDependencies(\n\tdeps: Set<string>,\n\tdevDeps: Set<string>,\n\t{ yes, no = false, cwd, pm, ignoreWorkspace = false }: InstallDependenciesOptions\n): Promise<InstallDependenciesResult> {\n\t// check if dependencies are already installed\n\tconst { dependencies, devDependencies } = returnShouldInstall(deps, devDeps, { cwd });\n\n\tconst hasDependencies = dependencies.size > 0 || devDependencies.size > 0;\n\n\tif (hasDependencies) {\n\t\tlet install = yes;\n\t\tif (!yes && !no) {\n\t\t\tconst result = await confirm({\n\t\t\t\tmessage: 'Would you like to install dependencies?',\n\t\t\t\tinitialValue: true,\n\t\t\t});\n\n\t\t\tif (isCancel(result)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tinstall = result;\n\t\t}\n\n\t\tif (install) {\n\t\t\tif (dependencies.size > 0) {\n\t\t\t\tawait installDependencies({\n\t\t\t\t\tpm,\n\t\t\t\t\tdeps: Array.from(dependencies),\n\t\t\t\t\tdev: false,\n\t\t\t\t\tcwd,\n\t\t\t\t\tignoreWorkspace,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (devDependencies.size > 0) {\n\t\t\t\tawait installDependencies({\n\t\t\t\t\tpm,\n\t\t\t\t\tdeps: Array.from(devDependencies),\n\t\t\t\t\tdev: true,\n\t\t\t\t\tcwd,\n\t\t\t\t\tignoreWorkspace,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn { installed: true, dependencies, devDependencies };\n\t\t}\n\t}\n\n\treturn { installed: false, dependencies, devDependencies };\n}\n\n// From sveltejs/cli https://github.com/sveltejs/cli/blob/main/packages/clack-prompts/index.ts#L606\nexport function taskLog(title: string) {\n\tconst BAR = color.dim(ascii.VERTICAL_LINE);\n\tconst ACTIVE = color.green(ascii.S_STEP_ACTIVE);\n\tconst SUCCESS = color.green(ascii.S_SUCCESS);\n\tconst ERROR = color.red(ascii.S_ERROR);\n\n\t// heading\n\tprocess.stdout.write(`${BAR}\\n`);\n\tprocess.stdout.write(`${ACTIVE}  ${title}\\n`);\n\n\tlet output = '';\n\tlet frame = '';\n\n\t// clears previous output\n\tconst clear = (eraseTitle = false): void => {\n\t\tif (!frame) return;\n\t\tconst terminalWidth = process.stdout.columns;\n\t\tconst frameHeight = frame.split('\\n').reduce((height, line) => {\n\t\t\t// accounts for line wraps\n\t\t\treturn height + Math.ceil(line.length / terminalWidth);\n\t\t}, 0);\n\t\tconst lines = frameHeight + (eraseTitle ? 1 : 0);\n\n\t\tprocess.stdout.write(cursor.up(lines));\n\t\tprocess.stdout.write(erase.down());\n\t};\n\n\t// logs the output\n\tconst print = (limit = 0): void => {\n\t\tconst lines = output.split('\\n').slice(-limit);\n\t\t// reset frame\n\t\tframe = '';\n\t\tfor (const line of lines) {\n\t\t\tframe += `${BAR}  ${line}\\n`;\n\t\t}\n\t\tprocess.stdout.write(color.dim(frame));\n\t};\n\n\treturn {\n\t\tset text(data: string) {\n\t\t\tclear();\n\t\t\toutput += data;\n\t\t\t// half the height of the terminal\n\t\t\tconst frameHeight = Math.ceil(process.stdout.rows / 2);\n\t\t\tprint(frameHeight);\n\t\t},\n\t\tfail(message: string): void {\n\t\t\tclear(true);\n\t\t\tprocess.stdout.write(`${ERROR}  ${message}\\n`);\n\t\t\tprint(); // log the output on failure\n\t\t},\n\t\tsuccess(message: string): void {\n\t\t\tclear(true);\n\t\t\tprocess.stdout.write(`${SUCCESS}  ${message}\\n`);\n\t\t},\n\t};\n}\n\nexport { _intro as intro, _spinner as spinner };\n","import Conf from 'conf';\n\nfunction get() {\n\treturn new Conf({ projectName: 'jsrepo' });\n}\n\nexport { get };\n","import type Conf from 'conf';\nimport * as persisted from './persisted';\n\nconst HTTP_REGISTRY_LIST_KEY = 'http-registries-w-tokens';\n\nexport class TokenManager {\n\t#storage: Conf;\n\n\tconstructor(storage?: Conf) {\n\t\tthis.#storage = storage ?? persisted.get();\n\t}\n\n\tprivate getKey(name: string) {\n\t\treturn `${name}-token`.toLowerCase();\n\t}\n\n\tget(name: string): string | undefined {\n\t\tconst key = this.getKey(name);\n\n\t\tconst token = this.#storage.get(key, undefined) as string | undefined;\n\n\t\tif (name === 'jsrepo') {\n\t\t\treturn token ?? process.env.JSREPO_TOKEN;\n\t\t}\n\n\t\treturn token;\n\t}\n\n\tset(name: string, secret: string) {\n\t\tif (name.startsWith('http')) {\n\t\t\tlet registries = this.getHttpRegistriesWithTokens();\n\n\t\t\tconst registry = name.slice(5);\n\n\t\t\tif (!registries) {\n\t\t\t\tregistries = [];\n\t\t\t}\n\n\t\t\tif (!registries.includes(registry)) registries.push(registry);\n\n\t\t\tthis.#storage.set(HTTP_REGISTRY_LIST_KEY, registries);\n\t\t}\n\n\t\tconst key = this.getKey(name);\n\n\t\tthis.#storage.set(key, secret);\n\t}\n\n\tdelete(name: string) {\n\t\tif (name.startsWith('http')) {\n\t\t\tlet registries = this.getHttpRegistriesWithTokens();\n\n\t\t\tconst registry = name.slice(5);\n\n\t\t\tconst index = registries.indexOf(registry);\n\n\t\t\tif (index !== -1) {\n\t\t\t\tregistries = [...registries.slice(0, index), ...registries.slice(index + 1)];\n\t\t\t}\n\n\t\t\tthis.#storage.set(HTTP_REGISTRY_LIST_KEY, registries);\n\t\t}\n\n\t\tconst key = this.getKey(name);\n\n\t\tthis.#storage.delete(key);\n\t}\n\n\tgetHttpRegistriesWithTokens(): string[] {\n\t\tconst registries = this.#storage.get(HTTP_REGISTRY_LIST_KEY);\n\n\t\tif (!registries) return [];\n\n\t\treturn registries as string[];\n\t}\n}\n","import Anthropic from '@anthropic-ai/sdk';\nimport { cancel, isCancel, password, type spinner } from '@clack/prompts';\nimport ollama from 'ollama';\nimport OpenAI from 'openai';\nimport * as lines from './blocks/ts/lines';\nimport { TokenManager } from './token-manager';\n\ntype File = {\n\tpath: string;\n\tcontent: string;\n};\n\nexport type Message = {\n\trole: 'assistant' | 'user';\n\tcontent: string;\n};\n\nexport type UpdateFileResult = {\n\tcontent: string;\n\t/** Prompt constructed by the user (for context) */\n\tprompt: string;\n};\n\nexport interface Model {\n\tupdateFile: (opts: {\n\t\toriginalFile: File;\n\t\tnewFile: File;\n\t\tloading: ReturnType<typeof spinner>;\n\t\tadditionalInstructions?: string;\n\t\tmessages?: Message[];\n\t\tverbose?: (msg: string) => void;\n\t}) => Promise<UpdateFileResult>;\n}\n\nexport type ModelName = 'Claude 3.7 Sonnet' | 'OpenAI o3-mini' | 'Phi4';\n\ntype Prompt = {\n\tsystem: string;\n\tmessage: string;\n};\n\nconst models: Record<ModelName, Model> = {\n\t'Claude 3.7 Sonnet': {\n\t\tupdateFile: async ({\n\t\t\toriginalFile,\n\t\t\tnewFile,\n\t\t\tloading,\n\t\t\tverbose,\n\t\t\tadditionalInstructions,\n\t\t\tmessages,\n\t\t}) => {\n\t\t\tconst apiKey = await getApiKey('Anthropic');\n\n\t\t\tif (!verbose) loading.start(`Asking ${'Claude 3.7 Sonnet'}`);\n\n\t\t\tconst prompt = createUpdatePrompt({\n\t\t\t\toriginalFile,\n\t\t\t\tnewFile,\n\t\t\t\tadditionalInstructions,\n\t\t\t\trePrompt: messages !== undefined && messages.length > 0,\n\t\t\t});\n\n\t\t\tverbose?.(\n\t\t\t\t`Prompting ${'Claude 3.7 Sonnet'} with:\\n${JSON.stringify(prompt, null, '\\t')}`\n\t\t\t);\n\n\t\t\tconst text = await getNextCompletionAnthropic({\n\t\t\t\tmodel: 'claude-3-7-sonnet-latest',\n\t\t\t\tprompt,\n\t\t\t\tapiKey,\n\t\t\t\tmessages,\n\t\t\t\tmaxTokens: (originalFile.content.length + newFile.content.length) * 2,\n\t\t\t});\n\n\t\t\tif (!verbose) loading.stop(`${'Claude 3.7 Sonnet'} updated the file`);\n\n\t\t\tif (!text) return { content: newFile.content, prompt: prompt.message };\n\n\t\t\treturn { content: unwrapCodeFromQuotes(text), prompt: prompt.message };\n\t\t},\n\t},\n\t'OpenAI o3-mini': {\n\t\tupdateFile: async ({\n\t\t\toriginalFile,\n\t\t\tnewFile,\n\t\t\tloading,\n\t\t\tverbose,\n\t\t\tadditionalInstructions,\n\t\t\tmessages,\n\t\t}) => {\n\t\t\tconst apiKey = await getApiKey('OpenAI');\n\n\t\t\tif (!verbose) loading.start(`Asking ${'OpenAI o3-mini'}`);\n\n\t\t\tconst prompt = createUpdatePrompt({\n\t\t\t\toriginalFile,\n\t\t\t\tnewFile,\n\t\t\t\tadditionalInstructions,\n\t\t\t\trePrompt: messages !== undefined && messages.length > 0,\n\t\t\t});\n\n\t\t\tverbose?.(`Prompting ${'OpenAI o3-mini'} with:\\n${JSON.stringify(prompt, null, '\\t')}`);\n\n\t\t\tconst text = await getNextCompletionOpenAI({\n\t\t\t\tmodel: 'o3-mini',\n\t\t\t\tprompt,\n\t\t\t\tapiKey,\n\t\t\t\tmessages,\n\t\t\t\tmaxTokens: (originalFile.content.length + newFile.content.length) * 2,\n\t\t\t});\n\n\t\t\tif (!verbose) loading.stop(`${'OpenAI o3-mini'} updated the file`);\n\n\t\t\tif (!text) return { content: newFile.content, prompt: prompt.message };\n\n\t\t\treturn { content: unwrapCodeFromQuotes(text), prompt: prompt.message };\n\t\t},\n\t},\n\tPhi4: {\n\t\tupdateFile: async ({\n\t\t\toriginalFile,\n\t\t\tnewFile,\n\t\t\tloading,\n\t\t\tverbose,\n\t\t\tadditionalInstructions,\n\t\t\tmessages,\n\t\t}) => {\n\t\t\tif (!verbose) loading.start(`Asking ${'Phi4'}`);\n\n\t\t\tconst prompt = createUpdatePrompt({\n\t\t\t\toriginalFile,\n\t\t\t\tnewFile,\n\t\t\t\tadditionalInstructions,\n\t\t\t\trePrompt: messages !== undefined && messages.length > 0,\n\t\t\t});\n\n\t\t\tverbose?.(`Prompting ${'Phi4'} with:\\n${JSON.stringify(prompt, null, '\\t')}`);\n\n\t\t\tconst text = await getNextCompletionOllama({ model: 'phi4', prompt, messages });\n\n\t\t\tif (!verbose) loading.stop(`${'Phi4'} updated the file`);\n\n\t\t\tif (!text) return { content: newFile.content, prompt: prompt.message };\n\n\t\t\treturn { content: unwrapCodeFromQuotes(text), prompt: prompt.message };\n\t\t},\n\t},\n};\n\nasync function getNextCompletionOpenAI({\n\tprompt,\n\tmaxTokens,\n\tmodel,\n\tapiKey,\n\tmessages,\n}: {\n\tprompt: Prompt;\n\tmessages?: Message[];\n\tmaxTokens: number;\n\tmodel: OpenAI.Chat.ChatModel;\n\tapiKey: string;\n}): Promise<string | null> {\n\tconst openai = new OpenAI({ apiKey });\n\n\tconst msg = await openai.chat.completions.create({\n\t\tmodel,\n\t\tmax_completion_tokens: maxTokens,\n\t\tmessages: [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: prompt.system,\n\t\t\t},\n\t\t\t...(messages ?? []),\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: prompt.message,\n\t\t\t},\n\t\t],\n\t});\n\n\tconst first = msg.choices[0];\n\n\tif (first.message.content === null) return null;\n\n\treturn first.message.content;\n}\n\nasync function getNextCompletionAnthropic({\n\tprompt,\n\tmessages,\n\tmaxTokens,\n\tmodel,\n\tapiKey,\n}: {\n\tprompt: Prompt;\n\tmessages?: Message[];\n\tmaxTokens: number;\n\tmodel: Anthropic.Messages.Model;\n\tapiKey: string;\n}): Promise<string | null> {\n\tconst anthropic = new Anthropic({ apiKey });\n\n\t// didn't want to do it this way but I couldn't get `.map` to work\n\tconst history: Anthropic.Messages.MessageParam[] = [];\n\n\t// add history\n\tif (messages) {\n\t\tfor (const message of messages) {\n\t\t\thistory.push({\n\t\t\t\trole: message.role,\n\t\t\t\tcontent: [{ type: 'text', text: message.content }],\n\t\t\t});\n\t\t}\n\t}\n\n\t// add new message\n\thistory.push({\n\t\trole: 'user',\n\t\tcontent: [\n\t\t\t{\n\t\t\t\ttype: 'text',\n\t\t\t\ttext: prompt.message,\n\t\t\t},\n\t\t],\n\t});\n\n\tconst msg = await anthropic.messages.create({\n\t\tmodel,\n\t\tmax_tokens: Math.min(maxTokens, 8192),\n\t\ttemperature: 0.5,\n\t\tsystem: prompt.system,\n\t\tmessages: history,\n\t});\n\n\tconst first = msg.content[0];\n\n\t// if we don't get it in the format you want just return the new file\n\tif (first.type !== 'text') return null;\n\n\treturn first.text;\n}\n\nasync function getNextCompletionOllama({\n\tprompt,\n\tmessages,\n\tmodel,\n}: {\n\tprompt: Prompt;\n\tmessages?: Message[];\n\tmodel: string;\n}): Promise<string | null> {\n\tconst resp = await ollama.chat({\n\t\tmodel,\n\t\tmessages: [\n\t\t\t{\n\t\t\t\trole: 'system',\n\t\t\t\tcontent: prompt.system,\n\t\t\t},\n\t\t\t...(messages ?? []),\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: prompt.message,\n\t\t\t},\n\t\t],\n\t});\n\n\treturn resp.message.content;\n}\n\nfunction createUpdatePrompt({\n\toriginalFile,\n\tnewFile,\n\tadditionalInstructions,\n\trePrompt,\n}: {\n\toriginalFile: File;\n\tnewFile: File;\n\tadditionalInstructions?: string;\n\trePrompt: boolean;\n}): Prompt {\n\treturn {\n\t\tsystem: 'You will merge two files provided by the user. You will respond only with the resulting code. DO NOT format the code with markdown, DO NOT put the code inside of triple quotes, only return the code as a raw string. DO NOT make unnecessary changes.',\n\t\tmessage: rePrompt\n\t\t\t? (additionalInstructions ?? '')\n\t\t\t: `\nThis is my current file ${originalFile.path}:\n<code>\n${originalFile.content}\n</code>\n\t\nThis is the file that has changes I want to update with ${newFile.path}:\n<code>\n${newFile.content}\n</code>${additionalInstructions ? `<additional-instructions>${additionalInstructions}</additional-instructions>` : ''}\n\t`,\n\t};\n}\n\n/** The AI isn't always that smart and likes to wrap the code in quotes even though I beg it not to.\n *  This function attempts to remove the quotes.\n */\nexport function unwrapCodeFromQuotes(quoted: string): string {\n\tlet code = quoted.trim();\n\n\tif (code.startsWith('```')) {\n\t\t// takes out the entire first line\n\t\t// this is because often a language will come after the triple quotes\n\t\tcode = lines.get(code).slice(1).join('\\n').trim();\n\t}\n\n\tif (code.endsWith('```')) {\n\t\tconst l = lines.get(code);\n\t\tcode = l\n\t\t\t.slice(0, l.length - 1)\n\t\t\t.join('\\n')\n\t\t\t.trim();\n\t}\n\n\treturn code;\n}\n\n/** Attempts to get the cached api key if it can't it will prompt the user\n *\n * @param name\n * @returns\n */\nasync function getApiKey(name: 'OpenAI' | 'Anthropic'): Promise<string> {\n\tconst storage = new TokenManager();\n\n\tlet apiKey = storage.get(name);\n\n\tif (!apiKey) {\n\t\t// prompt for api key\n\t\tconst result = await password({\n\t\t\tmessage: `Paste your ${name} API key:`,\n\t\t\tvalidate(value) {\n\t\t\t\tif (value.trim() === '') return 'Please provide an API key';\n\t\t\t},\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tapiKey = result;\n\t}\n\n\tstorage.set(name, apiKey);\n\n\treturn apiKey;\n}\n\nexport { models };\n","import pkg from '../../package.json';\nimport type { PackageJson } from './package';\n\nexport const packageJson = pkg as PackageJson;\n","import color from 'chalk';\nimport { type Change, diffChars } from 'diff';\nimport * as array from './blocks/ts/array';\nimport * as lines from './blocks/ts/lines';\nimport { leftPadMin } from './blocks/ts/pad';\n\ntype Options = {\n\t/** The source file */\n\tfrom: string;\n\t/** The destination file */\n\tto: string;\n\t/** The changes to the file */\n\tchanges: Change[];\n\t/** Expands all lines to show the entire file */\n\texpand: boolean;\n\t/** Maximum lines to show before collapsing */\n\tmaxUnchanged: number;\n\t/** Color the removed lines */\n\tcolorRemoved?: (line: string) => string;\n\t/** Color the added lines */\n\tcolorAdded?: (line: string) => string;\n\t/** Color the removed chars */\n\tcolorCharsRemoved?: (line: string) => string;\n\t/** Color the added chars */\n\tcolorCharsAdded?: (line: string) => string;\n\t/** Prefixes each line with the string returned from this function. */\n\tprefix: () => string;\n\tintro: (options: Options) => string;\n\tonUnchanged: (options: Options) => string;\n};\n\n/** Check if a character is whitespace\n *\n * @param str\n * @returns\n */\nfunction isWhitespace(str: string) {\n\treturn /^\\s+$/g.test(str);\n}\n\n/** We need to add a newline at the end of each change to make sure\n * the next change can start correctly. So we take off just 1.\n *\n * @param str\n * @returns\n */\nfunction trimSingleNewLine(str: string): string {\n\tlet i = str.length - 1;\n\twhile (isWhitespace(str[i]) && i >= 0) {\n\t\tif (str[i] === '\\n') {\n\t\t\tif (str[i - 1] === '\\r') {\n\t\t\t\treturn str.slice(0, i - 1);\n\t\t\t}\n\n\t\t\treturn str.slice(0, i);\n\t\t}\n\n\t\ti--;\n\t}\n\n\treturn str;\n}\n\nfunction formatDiff({\n\tfrom,\n\tto,\n\tchanges,\n\texpand = false,\n\tmaxUnchanged = 5,\n\tcolorRemoved = color.redBright,\n\tcolorAdded = color.greenBright,\n\tcolorCharsRemoved = color.bgRedBright,\n\tcolorCharsAdded = color.bgGreenBright,\n\tprefix,\n\tonUnchanged,\n\tintro,\n}: Options): string {\n\tlet result = '';\n\n\tconst length = array.sum(changes, (change) => change.count ?? 0).toString().length + 1;\n\n\tlet lineOffset = 0;\n\n\tif (changes.length === 1 && !changes[0].added && !changes[0].removed) {\n\t\treturn onUnchanged({\n\t\t\tfrom,\n\t\t\tto,\n\t\t\tchanges,\n\t\t\texpand,\n\t\t\tmaxUnchanged,\n\t\t\tcolorAdded,\n\t\t\tcolorRemoved,\n\t\t\tprefix,\n\t\t\tonUnchanged,\n\t\t\tintro,\n\t\t});\n\t}\n\n\tresult += intro({\n\t\tfrom,\n\t\tto,\n\t\tchanges,\n\t\texpand,\n\t\tmaxUnchanged,\n\t\tcolorAdded,\n\t\tcolorRemoved,\n\t\tprefix,\n\t\tonUnchanged,\n\t\tintro,\n\t});\n\n\t/** Provides the line number prefix */\n\tconst linePrefix = (line: number): string =>\n\t\tcolor.gray(`${prefix?.() ?? ''}${leftPadMin(`${line + 1 + lineOffset} `, length)} `);\n\n\tfor (let i = 0; i < changes.length; i++) {\n\t\tconst change = changes[i];\n\n\t\tconst hasPreviousChange = changes[i - 1]?.added || changes[i - 1]?.removed;\n\t\tconst hasNextChange = changes[i + 1]?.added || changes[i + 1]?.removed;\n\n\t\tif (!change.added && !change.removed) {\n\t\t\t// show collapsed\n\t\t\tif (!expand && change.count !== undefined && change.count > maxUnchanged) {\n\t\t\t\tconst prevLineOffset = lineOffset;\n\t\t\t\tconst ls = lines.get(trimSingleNewLine(change.value));\n\n\t\t\t\tlet shownLines = 0;\n\n\t\t\t\tif (hasNextChange) shownLines += maxUnchanged;\n\t\t\t\tif (hasPreviousChange) shownLines += maxUnchanged;\n\n\t\t\t\t// just show all if we are going to show more than we have\n\t\t\t\tif (shownLines >= ls.length) {\n\t\t\t\t\tresult += `${lines.join(ls, {\n\t\t\t\t\t\tprefix: linePrefix,\n\t\t\t\t\t})}\\n`;\n\t\t\t\t\tlineOffset += ls.length;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// this writes the top few lines\n\t\t\t\tif (hasPreviousChange) {\n\t\t\t\t\tresult += `${lines.join(ls.slice(0, maxUnchanged), {\n\t\t\t\t\t\tprefix: linePrefix,\n\t\t\t\t\t})}\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (ls.length > shownLines) {\n\t\t\t\t\tconst count = ls.length - shownLines;\n\t\t\t\t\tresult += `${lines.join(\n\t\t\t\t\t\tlines.get(\n\t\t\t\t\t\t\tcolor.gray(\n\t\t\t\t\t\t\t\t`+ ${count} more unchanged (${color.italic('-E to expand')})`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tprefix: () => `${prefix?.() ?? ''}${leftPadMin(' ', length)} `,\n\t\t\t\t\t\t}\n\t\t\t\t\t)}\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (hasNextChange) {\n\t\t\t\t\tlineOffset = lineOffset + ls.length - maxUnchanged;\n\t\t\t\t\tresult += `${lines.join(ls.slice(ls.length - maxUnchanged), {\n\t\t\t\t\t\tprefix: linePrefix,\n\t\t\t\t\t})}\\n`;\n\t\t\t\t}\n\n\t\t\t\t// resets the line offset\n\t\t\t\tlineOffset = prevLineOffset + change.count;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// show expanded\n\t\t\tresult += `${lines.join(lines.get(trimSingleNewLine(change.value)), {\n\t\t\t\tprefix: linePrefix,\n\t\t\t})}\\n`;\n\t\t\tlineOffset += change.count ?? 0;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst colorLineChange = (change: Change) => {\n\t\t\tif (change.added) {\n\t\t\t\treturn colorAdded(trimSingleNewLine(change.value));\n\t\t\t}\n\n\t\t\tif (change.removed) {\n\t\t\t\treturn colorRemoved(trimSingleNewLine(change.value));\n\t\t\t}\n\n\t\t\treturn change.value;\n\t\t};\n\n\t\tconst colorCharChange = (change: Change) => {\n\t\t\tif (change.added) {\n\t\t\t\treturn colorCharsAdded(trimSingleNewLine(change.value));\n\t\t\t}\n\n\t\t\tif (change.removed) {\n\t\t\t\treturn colorCharsRemoved(trimSingleNewLine(change.value));\n\t\t\t}\n\n\t\t\treturn change.value;\n\t\t};\n\n\t\tif (\n\t\t\tchange.removed &&\n\t\t\tchange.count === 1 &&\n\t\t\tchanges[i + 1]?.added &&\n\t\t\tchanges[i + 1]?.count === 1\n\t\t) {\n\t\t\t// single line change\n\t\t\tconst diffedChars = diffChars(change.value, changes[i + 1].value);\n\n\t\t\tconst sentence = diffedChars.map((chg) => colorCharChange(chg)).join('');\n\n\t\t\tresult += `${linePrefix(0)}${sentence}`;\n\n\t\t\tlineOffset += 1;\n\n\t\t\ti++;\n\t\t} else {\n\t\t\tif (isWhitespace(change.value)) {\n\t\t\t\t// adds some spaces to make sure that you can see the change\n\t\t\t\tresult += `${lines.join(lines.get(colorCharChange(change)), {\n\t\t\t\t\tprefix: (line) =>\n\t\t\t\t\t\t`${linePrefix(line)}${colorCharChange({\n\t\t\t\t\t\t\tremoved: true,\n\t\t\t\t\t\t\tvalue: '   ',\n\t\t\t\t\t\t\tadded: false,\n\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t})}`,\n\t\t\t\t})}\\n`;\n\n\t\t\t\tif (!change.removed) {\n\t\t\t\t\tlineOffset += change.count ?? 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult += `${lines.join(lines.get(colorLineChange(change)), {\n\t\t\t\t\tprefix: linePrefix,\n\t\t\t\t})}\\n`;\n\n\t\t\t\tif (!change.removed) {\n\t\t\t\t\tlineOffset += change.count ?? 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!result.endsWith('\\n')) {\n\t\tresult = result += '\\n';\n\t}\n\n\treturn result;\n}\n\nexport { formatDiff };\n","import mfFetch from 'make-fetch-happen';\nimport path from 'pathe';\n\n/** Fetch method used for (i)nternal consumption */\nexport const iFetch = mfFetch.defaults({ cachePath: path.join(import.meta.dirname, 'cache') });\n","import { Err, Ok, type Result } from './blocks/ts/result';\nimport { iFetch } from './fetch';\nimport type { Package } from './parse-package-name';\nimport * as persisted from './persisted';\n\nconst LATEST_VERSION_KEY = 'latest-version';\nconst EXPIRATION_TIME = 60 * 60 * 1000; // 1 hour\n\ntype LatestVersion = {\n\texpiration: number;\n\tversion: string;\n};\n\n/** Checks for the latest version from the github repository. Will cache results for up to 1 hour. */\nexport async function getLatestVersion({\n\tnoCache = false,\n}: { noCache?: boolean } = {}): Promise<Result<string, string>> {\n\ttry {\n\t\t// handle caching\n\t\tconst storage = persisted.get();\n\n\t\tlet version: string;\n\n\t\tif (!noCache) {\n\t\t\tconst latestVersion = storage.get(LATEST_VERSION_KEY) as LatestVersion | null;\n\n\t\t\tif (latestVersion) {\n\t\t\t\tif (latestVersion.expiration > Date.now()) {\n\t\t\t\t\tversion = latestVersion.version;\n\n\t\t\t\t\treturn Ok(version);\n\t\t\t\t}\n\n\t\t\t\tstorage.delete(LATEST_VERSION_KEY);\n\t\t\t}\n\t\t}\n\n\t\tconst response = await iFetch(\n\t\t\t'https://raw.githubusercontent.com/jsrepojs/jsrepo/refs/heads/main/packages/cli/package.json',\n\t\t\t{\n\t\t\t\ttimeout: 1000,\n\t\t\t}\n\t\t);\n\n\t\tif (!response.ok) {\n\t\t\treturn Err('Error getting version');\n\t\t}\n\n\t\tconst { version: ver } = (await response.json()) as Package;\n\n\t\tversion = ver;\n\n\t\tstorage.set(LATEST_VERSION_KEY, {\n\t\t\texpiration: Date.now() + EXPIRATION_TIME,\n\t\t\tversion,\n\t\t} satisfies LatestVersion);\n\n\t\treturn Ok(version);\n\t} catch (err) {\n\t\treturn Err(`Error getting version: ${err}`);\n\t}\n}\n","/**\n * Adapted from https://github.com/egoist/parse-package-name/blob/main/src/index.ts\n * @module\n */\n\nimport { Err, Ok } from './blocks/ts/result';\n\n// Parsed a scoped package name into name, version, and path.\nconst RE_SCOPED = /^(@[^\\/]+\\/[^@\\/]+)(?:@([^\\/]+))?(\\/.*)?$/;\n// Parsed a non-scoped package name into name, version, path\nconst RE_NON_SCOPED = /^([^@\\/]+)(?:@([^\\/]+))?(\\/.*)?$/;\n\nexport type Package = {\n\t/** Name of the package as it would be installed from npm */\n\tname: string;\n\t/** Version of the package */\n\tversion: string;\n\tpath: string;\n};\n\nexport function parsePackageName(input: string) {\n\tconst m = RE_SCOPED.exec(input) || RE_NON_SCOPED.exec(input);\n\n\tif (!m) return Err(`invalid package name: ${input}`);\n\n\treturn Ok({\n\t\tname: m[1] || '',\n\t\tversion: m[2] || undefined,\n\t\tpath: m[3] || '',\n\t});\n}\n","import fs from 'node:fs';\nimport path from 'pathe';\nimport semver from 'semver';\nimport { Err, Ok, type Result } from './blocks/ts/result';\nimport { parsePackageName } from './parse-package-name';\n\nfunction findNearestPackageJson(startDir: string, until: string): string | undefined {\n\tconst packagePath = path.join(startDir, 'package.json');\n\n\tif (fs.existsSync(packagePath)) return packagePath;\n\n\tif (startDir === until) return undefined;\n\n\tconst segments = startDir.split(/[\\/\\\\]/);\n\n\treturn findNearestPackageJson(segments.slice(0, segments.length - 1).join('/'), until);\n}\n\nexport type PackageJson = {\n\tname: string;\n\tversion: string;\n\tdescription: string;\n\tscripts: Record<string, string>;\n\tdependencies: Record<string, string>;\n\tdevDependencies: Record<string, string>;\n};\n\nfunction getPackage(path: string): Result<Partial<PackageJson>, string> {\n\tif (!fs.existsSync(path)) return Err(`${path} doesn't exist`);\n\n\tconst contents = fs.readFileSync(path).toString();\n\n\ttry {\n\t\treturn Ok(JSON.parse(contents));\n\t} catch (err) {\n\t\treturn Err(`Error reading package.json: ${err}`);\n\t}\n}\n\nexport function cleanVersion(version: string) {\n\tif (version[0] === '^') {\n\t\treturn version.slice(1);\n\t}\n\n\treturn version;\n}\n\n/** Returns only the dependencies that should be installed based on what is already in the package.json */\nfunction returnShouldInstall(\n\tdependencies: Set<string>,\n\tdevDependencies: Set<string>,\n\t{ cwd }: { cwd: string }\n): { devDependencies: Set<string>; dependencies: Set<string> } {\n\t// don't mutate originals\n\tconst tempDeps = dependencies;\n\tconst tempDevDeps = devDependencies;\n\n\tconst packageResult = getPackage(path.join(cwd, 'package.json'));\n\n\tif (!packageResult.isErr()) {\n\t\tconst pkg = packageResult.unwrap();\n\n\t\tif (pkg.dependencies) {\n\t\t\tfor (const dep of tempDeps) {\n\t\t\t\t// this was already parsed when building\n\t\t\t\tconst { name, version } = parsePackageName(dep).unwrap();\n\n\t\t\t\tconst foundDep = pkg.dependencies[name];\n\n\t\t\t\t// if version isn't pinned and dep exists delete\n\t\t\t\tif (version === undefined && foundDep) {\n\t\t\t\t\ttempDeps.delete(dep);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if the version installed satisfies the requested version remove the dep\n\t\t\t\tif (foundDep && semver.satisfies(cleanVersion(foundDep), version!)) {\n\t\t\t\t\ttempDeps.delete(dep);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (pkg.devDependencies) {\n\t\t\tfor (const dep of tempDevDeps) {\n\t\t\t\t// this was already parsed when building\n\t\t\t\tconst { name, version } = parsePackageName(dep).unwrap();\n\n\t\t\t\tconst foundDep = pkg.devDependencies[name];\n\n\t\t\t\t// if version isn't pinned and dep exists delete\n\t\t\t\tif (version === undefined && foundDep) {\n\t\t\t\t\ttempDevDeps.delete(dep);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if the version installed satisfies the requested version remove the dep\n\t\t\t\tif (foundDep && semver.satisfies(cleanVersion(foundDep), version!)) {\n\t\t\t\t\ttempDevDeps.delete(dep);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { dependencies: tempDeps, devDependencies: tempDevDeps };\n}\n\nexport { findNearestPackageJson, getPackage, returnShouldInstall };\n","import color from 'chalk';\nimport { program } from 'commander';\nimport { type Agent, resolveCommand } from 'package-manager-detector';\nimport path from 'pathe';\nimport { x } from 'tinyexec';\nimport { flags } from './blocks/package-managers/flags';\nimport type { ProjectConfig } from './config';\nimport { taskLog } from './prompts';\n\nexport type Options = {\n\tpm: Agent;\n\tdeps: string[];\n\t/** Install as devDependency */\n\tdev: boolean;\n\tcwd: string;\n\tignoreWorkspace?: boolean;\n};\n\n/** Installs the provided dependencies using the provided package manager\n *\n * @param param0\n * @returns\n */\nexport async function installDependencies({\n\tpm,\n\tdeps,\n\tdev,\n\tcwd,\n\tignoreWorkspace = false,\n}: Options) {\n\tconst args = [...deps];\n\n\tif (dev) {\n\t\targs.push(flags[pm]['install-as-dev-dependency']);\n\t}\n\n\tconst noWorkspace = flags[pm]['no-workspace'];\n\n\tif (ignoreWorkspace && noWorkspace) {\n\t\targs.push(noWorkspace);\n\t}\n\n\tconst add = resolveCommand(pm, 'add', args);\n\n\tif (add == null) {\n\t\tprogram.error(color.red(`Could not resolve add command for '${pm}'.`));\n\t}\n\n\tconst task = taskLog(`Installing dependencies with ${pm}...`);\n\n\ttry {\n\t\tconst proc = x(add.command, [...add.args], { nodeOptions: { cwd } });\n\n\t\tfor await (const line of proc) {\n\t\t\ttask.text = `${line}\\n`;\n\t\t}\n\n\t\ttask.success(`Installed ${color.cyan(deps.join(', '))}`);\n\t} catch {\n\t\ttask.fail('Failed to install dependencies');\n\t\tprocess.exit(2);\n\t}\n}\n\nconst templatePattern = /\\{\\{([^\\/]+)\\/([^\\}]+)\\}\\}/g;\n\nexport type ResolveOptions = {\n\ttemplate: string;\n\tconfig: ProjectConfig;\n\tdestPath: string;\n\tcwd: string;\n};\n\n/** Takes a template and uses replaces it with an alias or relative path that resolves to the correct block\n *\n * @param param0\n * @returns\n */\nexport function resolveLocalDependencyTemplate({\n\ttemplate,\n\tconfig,\n\tdestPath,\n\tcwd,\n}: ResolveOptions) {\n\tconst destDir = path.join(destPath, '../');\n\n\treturn template.replace(templatePattern, (_, category, name) => {\n\t\tif (config.paths[category] === undefined) {\n\t\t\t// if relative make it relative\n\t\t\tif (config.paths['*'].startsWith('.')) {\n\t\t\t\tconst relative = path.relative(\n\t\t\t\t\tdestDir,\n\t\t\t\t\tpath.join(cwd, config.paths['*'], category, name)\n\t\t\t\t);\n\n\t\t\t\treturn relative.startsWith('.') ? relative : `./${relative}`;\n\t\t\t}\n\n\t\t\treturn path.join(config.paths['*'], category, name);\n\t\t}\n\n\t\t// if relative make it relative\n\t\tif (config.paths[category].startsWith('.')) {\n\t\t\tconst relative = path.relative(destDir, path.join(cwd, config.paths[category], name));\n\n\t\t\treturn relative.startsWith('.') ? relative : `./${relative}`;\n\t\t}\n\n\t\treturn path.join(config.paths[category], name);\n\t});\n}\n","import fs from 'node:fs';\nimport type { PartialConfiguration } from '@biomejs/wasm-nodejs';\nimport color from 'chalk';\nimport escapeStringRegexp from 'escape-string-regexp';\nimport { type TsConfigResult, getTsconfig } from 'get-tsconfig';\nimport path from 'pathe';\nimport type * as prettier from 'prettier';\nimport { Err, Ok, type Result } from './blocks/ts/result';\nimport { endsWithOneOf } from './blocks/ts/strings';\nimport type { ProjectConfig } from './config';\nimport { resolveLocalDependencyTemplate } from './dependencies';\nimport { languages } from './language-support';\n\ntype TransformRemoteContentOptions = {\n\tfile: {\n\t\t/** The content of the file */\n\t\tcontent: string;\n\t\t/** The dest path of the file used to determine the language */\n\t\tdestPath: string;\n\t};\n\tconfig: ProjectConfig;\n\twatermark: string;\n\timports: Record<string, string>;\n\tprettierOptions: prettier.Options | null;\n\tbiomeOptions: PartialConfiguration | null;\n\tcwd: string;\n\tverbose?: (msg: string) => void;\n};\n\n/** Makes the necessary modifications to the content of the file to ensure it works properly in the users project\n *\n * @param param0\n * @returns\n */\nexport async function transformRemoteContent({\n\tfile,\n\tconfig,\n\timports,\n\twatermark,\n\tprettierOptions,\n\tbiomeOptions,\n\tcwd,\n\tverbose,\n}: TransformRemoteContentOptions): Promise<Result<string, string>> {\n\tconst lang = languages.find((lang) => lang.matches(file.destPath));\n\n\tlet content: string = file.content;\n\n\tif (lang) {\n\t\tif (config.watermark) {\n\t\t\tconst comment = lang.comment(watermark);\n\n\t\t\tcontent = `${comment}\\n\\n${content}`;\n\t\t}\n\n\t\tverbose?.(`Formatting ${color.bold(file.destPath)}`);\n\n\t\ttry {\n\t\t\tcontent = await lang.format(content, {\n\t\t\t\tfilePath: file.destPath,\n\t\t\t\tformatter: config.formatter,\n\t\t\t\tprettierOptions,\n\t\t\t\tbiomeOptions,\n\t\t\t});\n\t\t} catch (err) {\n\t\t\treturn Err(`Error formatting ${color.bold(file.destPath)} ${err}`);\n\t\t}\n\t}\n\n\t// transform imports\n\tfor (const [literal, template] of Object.entries(imports)) {\n\t\tconst resolvedImport = resolveLocalDependencyTemplate({\n\t\t\ttemplate,\n\t\t\tconfig,\n\t\t\tdestPath: file.destPath,\n\t\t\tcwd,\n\t\t});\n\n\t\t// this way we only replace the exact import since it will be surrounded in quotes\n\t\tconst literalRegex = new RegExp(`(['\"])${escapeStringRegexp(literal)}\\\\1`, 'g');\n\n\t\tcontent = content.replaceAll(literalRegex, `$1${resolvedImport}$1`);\n\t}\n\n\treturn Ok(content);\n}\n\ntype FormatOptions = {\n\tfile: {\n\t\t/** The content of the file */\n\t\tcontent: string;\n\t\t/** The dest path of the file used to determine the language */\n\t\tdestPath: string;\n\t};\n\tformatter: ProjectConfig['formatter'];\n\tprettierOptions: prettier.Options | null;\n\tbiomeOptions: PartialConfiguration | null;\n};\n\n/** Auto detects the language and formats the file content.\n *\n * @param param0\n * @returns\n */\nexport async function formatFile({\n\tfile,\n\tformatter,\n\tprettierOptions,\n\tbiomeOptions,\n}: FormatOptions): Promise<string> {\n\tconst lang = languages.find((lang) => lang.matches(file.destPath));\n\n\tlet newContent = file.content;\n\n\tif (lang) {\n\t\ttry {\n\t\t\tnewContent = await lang.format(file.content, {\n\t\t\t\tfilePath: file.destPath,\n\t\t\t\tformatter,\n\t\t\t\tprettierOptions,\n\t\t\t\tbiomeOptions,\n\t\t\t});\n\t\t} catch {\n\t\t\treturn newContent;\n\t\t}\n\t}\n\n\treturn newContent;\n}\n\nexport function matchJSDescendant(searchFilePath: string): string | undefined {\n\tconst MATCH_EXTENSIONS = ['.js', '.ts', '.cjs', '.mjs'];\n\n\tif (!endsWithOneOf(searchFilePath, MATCH_EXTENSIONS)) return undefined;\n\n\tconst dir = path.dirname(searchFilePath);\n\n\tconst files = fs.readdirSync(dir);\n\n\tconst parsedSearch = path.parse(searchFilePath);\n\n\tfor (const file of files) {\n\t\tif (!endsWithOneOf(file, MATCH_EXTENSIONS)) continue;\n\n\t\tif (path.parse(file).name === parsedSearch.name) return path.join(dir, file);\n\t}\n\n\treturn undefined;\n}\n\n/** Attempts to get the js/tsconfig file for the searched path\n *\n * @param searchPath\n * @returns\n */\nexport function tryGetTsconfig(searchPath?: string): Result<TsConfigResult | null, string> {\n\tlet config: TsConfigResult | null;\n\n\ttry {\n\t\tconfig = getTsconfig(searchPath, 'tsconfig.json');\n\n\t\tif (!config) {\n\t\t\t// if we don't find the config at first check for a jsconfig\n\t\t\tconfig = getTsconfig(searchPath, 'jsconfig.json');\n\n\t\t\tif (!config) {\n\t\t\t\treturn Ok(null);\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn Err(`Error while trying to get ${color.bold('tsconfig.json')}: ${err}`);\n\t}\n\n\treturn Ok(config);\n}\n","import fs from 'node:fs';\nimport { Biome, Distribution } from '@biomejs/js-api';\nimport * as cssDependency from 'css-dependency';\nimport * as prettier from 'prettier';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\n\n/** Language support for `*.css` files. */\nexport const css: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.css'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst sourceCode = fs.readFileSync(filePath).toString();\n\n\t\tconst parseResult = cssDependency.parse(sourceCode, { allowTailwindDirectives: true });\n\n\t\tif (parseResult.isErr()) {\n\t\t\treturn Err(parseResult.unwrapErr().message);\n\t\t}\n\n\t\tconst imports = parseResult.unwrap();\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: imports.map((imp) => imp.module),\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: excludeDeps,\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `/*\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n*/`,\n\tformat: async (code, { formatter, prettierOptions, biomeOptions, filePath }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { filepath: filePath, ...prettierOptions });\n\t\t}\n\n\t\tconst biome = await Biome.create({\n\t\t\tdistribution: Distribution.NODE,\n\t\t});\n\n\t\tif (biomeOptions) {\n\t\t\tbiome.applyConfiguration(biomeOptions);\n\t\t}\n\n\t\treturn biome.formatContent(code, { filePath }).content;\n\t},\n};\n","import fs from 'node:fs';\nimport * as parse5 from 'parse5';\nimport * as prettier from 'prettier';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\n\n/** Language support for `*.html` files. */\nexport const html: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.html'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst sourceCode = fs.readFileSync(filePath).toString();\n\n\t\tconst ast = parse5.parse(sourceCode);\n\n\t\tconst imports: string[] = [];\n\n\t\t// @ts-ignore yeah I know\n\t\tconst walk = (node, enter: (node) => void) => {\n\t\t\tif (!node) return;\n\n\t\t\tenter(node);\n\n\t\t\tif (node.childNodes && node.childNodes.length > 0) {\n\t\t\t\tfor (const n of node.childNodes) {\n\t\t\t\t\twalk(n, enter);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfor (const node of ast.childNodes) {\n\t\t\twalk(node, (n) => {\n\t\t\t\tif (n.tagName === 'script') {\n\t\t\t\t\tfor (const attr of n.attrs) {\n\t\t\t\t\t\tif (attr.name === 'src') {\n\t\t\t\t\t\t\timports.push(attr.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tn.tagName === 'link' &&\n\t\t\t\t\t// @ts-ignore yeah I know\n\t\t\t\t\tn.attrs.find((attr) => attr.name === 'rel' && attr.value === 'stylesheet')\n\t\t\t\t) {\n\t\t\t\t\tfor (const attr of n.attrs) {\n\t\t\t\t\t\tif (attr.name === 'href' && !attr.value.startsWith('http')) {\n\t\t\t\t\t\t\timports.push(attr.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: imports,\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: ['svelte', '@sveltejs/kit', ...excludeDeps],\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `<!--\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n-->`,\n\tformat: async (code, { formatter, prettierOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { parser: 'html', ...prettierOptions });\n\t\t}\n\n\t\t// biome is in progress for formatting html\n\n\t\treturn code;\n\t},\n};\n","import fs from 'node:fs';\nimport { Biome, Distribution } from '@biomejs/js-api';\nimport oxc from 'oxc-parser';\nimport * as prettier from 'prettier';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\n\n/** Parses the provided code and returns the names of any other modules required by the module.\n *\n * @param fileName This must be provided for oxc to infer the dialect i.e. (jsx, tsx, js, ts)\n * @param code The code to be parsed\n * @returns\n */\nexport function getJavascriptImports(fileName: string, code: string): string[] {\n\tconst result = oxc.parseSync(fileName, code);\n\n\tconst modules: string[] = [];\n\n\t// handle static imports\n\tfor (const imp of result.module.staticImports) {\n\t\tmodules.push(imp.moduleRequest.value);\n\t}\n\n\t// handle dynamic imports\n\tfor (const imp of result.module.dynamicImports) {\n\t\t// trims the codes and gets the module\n\t\tconst mod = code.slice(imp.moduleRequest.start + 1, imp.moduleRequest.end - 1);\n\n\t\tmodules.push(mod);\n\t}\n\n\t// handle `export x from y` syntax\n\tfor (const exp of result.module.staticExports) {\n\t\tfor (const entry of exp.entries) {\n\t\t\tif (entry.moduleRequest) {\n\t\t\t\tmodules.push(entry.moduleRequest.value);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn modules;\n}\n\n/** Language support for `*.(js|ts|jsx|tsx)` files. */\nexport const typescript: Lang = {\n\tmatches: (fileName) =>\n\t\tfileName.endsWith('.ts') ||\n\t\tfileName.endsWith('.js') ||\n\t\tfileName.endsWith('.tsx') ||\n\t\tfileName.endsWith('.jsx'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst code = fs.readFileSync(filePath).toString();\n\n\t\tconst modules = getJavascriptImports(filePath, code);\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: modules,\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: excludeDeps,\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `/*\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n*/`,\n\tformat: async (code, { formatter, filePath, prettierOptions, biomeOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { filepath: filePath, ...prettierOptions });\n\t\t}\n\n\t\tconst biome = await Biome.create({\n\t\t\tdistribution: Distribution.NODE,\n\t\t});\n\n\t\tif (biomeOptions) {\n\t\t\tbiome.applyConfiguration(biomeOptions);\n\t\t}\n\n\t\treturn biome.formatContent(code, { filePath }).content;\n\t},\n};\n","import { Biome, Distribution } from '@biomejs/js-api';\nimport * as prettier from 'prettier';\nimport type { Lang } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Ok } from '../blocks/ts/result';\n\nconst format: Lang['format'] = async (\n\tcode,\n\t{ formatter, prettierOptions, biomeOptions, filePath }\n) => {\n\tif (!formatter) return code;\n\n\tif (formatter === 'prettier') {\n\t\treturn await prettier.format(code, { filepath: filePath, ...prettierOptions });\n\t}\n\n\tconst biome = await Biome.create({\n\t\tdistribution: Distribution.NODE,\n\t});\n\n\tif (biomeOptions) {\n\t\tbiome.applyConfiguration({\n\t\t\t...biomeOptions,\n\t\t\tjson: { parser: { allowComments: true } },\n\t\t});\n\t}\n\n\treturn biome.formatContent(code, { filePath }).content;\n};\n\n/** Language support for `*.(json)` files. */\nexport const json: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.json'),\n\tresolveDependencies: () =>\n\t\tOk({ dependencies: [], local: [], devDependencies: [], imports: {} }),\n\t// json doesn't support comments\n\tcomment: (content: string) => content,\n\tformat,\n};\n\n/** Language support for `*.(jsonc)` files. */\nexport const jsonc: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.jsonc'),\n\tresolveDependencies: () =>\n\t\tOk({ dependencies: [], local: [], devDependencies: [], imports: {} }),\n\tcomment: (content) => `/*\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n*/`,\n\tformat,\n};\n","import fs from 'node:fs';\nimport * as cssDependency from 'css-dependency';\nimport * as prettier from 'prettier';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\n\n/** Language support for `*.(sass|scss)` files. */\nexport const sass: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.sass') || fileName.endsWith('.scss'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst sourceCode = fs.readFileSync(filePath).toString();\n\n\t\tconst parseResult = cssDependency.parse(sourceCode);\n\n\t\tif (parseResult.isErr()) {\n\t\t\treturn Err(parseResult.unwrapErr().message);\n\t\t}\n\n\t\tconst imports = parseResult.unwrap();\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: imports.map((imp) => imp.module),\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: excludeDeps,\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `/*\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n*/`,\n\tformat: async (code, { formatter, prettierOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { parser: 'scss', ...prettierOptions });\n\t\t}\n\n\t\treturn code;\n\t},\n};\n","import fs from 'node:fs';\nimport { type Node, walk } from 'estree-walker';\nimport * as prettier from 'prettier';\nimport * as sv from 'svelte/compiler';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\n\n/** Language support for `*.svelte` files. */\nexport const svelte: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.svelte'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst sourceCode = fs.readFileSync(filePath).toString();\n\n\t\tconst root = sv.parse(sourceCode, { modern: true, filename: filePath });\n\n\t\t// if no script tag then no dependencies\n\t\tif (!root.instance && !root.module)\n\t\t\treturn Ok({ dependencies: [], devDependencies: [], local: [], imports: {} });\n\n\t\tconst modules: string[] = [];\n\n\t\tconst enter = (node: Node) => {\n\t\t\tif (\n\t\t\t\tnode.type === 'ImportDeclaration' ||\n\t\t\t\tnode.type === 'ExportAllDeclaration' ||\n\t\t\t\tnode.type === 'ExportNamedDeclaration'\n\t\t\t) {\n\t\t\t\tif (typeof node.source?.value === 'string') {\n\t\t\t\t\tmodules.push(node.source.value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (node.type === 'ImportExpression') {\n\t\t\t\tif (node.source.type === 'Literal' && typeof node.source.value === 'string') {\n\t\t\t\t\tmodules.push(node.source.value);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (root.instance) {\n\t\t\t// biome-ignore lint/suspicious/noExplicitAny: The root instance is just missing the `id` prop\n\t\t\twalk(root.instance as any, { enter });\n\t\t}\n\n\t\tif (root.module) {\n\t\t\t// biome-ignore lint/suspicious/noExplicitAny: The root instance is just missing the `id` prop\n\t\t\twalk(root.module as any, { enter });\n\t\t}\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: modules,\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: ['svelte', '@sveltejs/kit', ...excludeDeps],\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `<!--\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n-->`,\n\tformat: async (code, { formatter, filePath, prettierOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\t// only attempt to format if svelte plugin is included in the config.\n\t\tif (\n\t\t\tformatter === 'prettier' &&\n\t\t\tprettierOptions &&\n\t\t\tprettierOptions.plugins?.find((plugin) => plugin === 'prettier-plugin-svelte')\n\t\t) {\n\t\t\treturn await prettier.format(code, {\n\t\t\t\tfilepath: filePath,\n\t\t\t\t...prettierOptions,\n\t\t\t});\n\t\t}\n\n\t\treturn code;\n\t},\n};\n","import type { Lang } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Ok } from '../blocks/ts/result';\n\n/** Language support for `*.svg` files. */\nexport const svg: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.svg'),\n\tresolveDependencies: () =>\n\t\tOk({ dependencies: [], local: [], devDependencies: [], imports: {} }),\n\tcomment: (content) => `<!--\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n-->`,\n\tformat: async (code) => code,\n};\n","import fs from 'node:fs';\nimport * as prettier from 'prettier';\nimport * as v from 'vue/compiler-sfc';\nimport { type Lang, formatError, resolveImports } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok } from '../blocks/ts/result';\nimport { getJavascriptImports } from './javascript';\n\n/** Language support for `*.vue` files. */\nexport const vue: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.vue'),\n\tresolveDependencies: ({ filePath, isSubDir, excludeDeps, dirs, cwd, containingDir }) => {\n\t\tconst code = fs.readFileSync(filePath).toString();\n\n\t\tconst parsed = v.parse(code, { filename: filePath });\n\n\t\tconst modules: string[] = [];\n\n\t\tif (parsed.descriptor.script?.content) {\n\t\t\tconst mods = getJavascriptImports('noop.ts', parsed.descriptor.script.content);\n\n\t\t\tmodules.push(...mods);\n\t\t}\n\n\t\tif (parsed.descriptor.scriptSetup?.content) {\n\t\t\tconst mods = getJavascriptImports('noop.ts', parsed.descriptor.scriptSetup.content);\n\n\t\t\tmodules.push(...mods);\n\t\t}\n\n\t\tif (modules.length === 0)\n\t\t\treturn Ok({ dependencies: [], devDependencies: [], local: [], imports: {} });\n\n\t\tconst resolveResult = resolveImports({\n\t\t\tmoduleSpecifiers: modules,\n\t\t\tfilePath,\n\t\t\tisSubDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t\tcontainingDir,\n\t\t\tdoNotInstall: ['vue', 'nuxt', ...excludeDeps],\n\t\t});\n\n\t\tif (resolveResult.isErr()) {\n\t\t\treturn Err(\n\t\t\t\tresolveResult\n\t\t\t\t\t.unwrapErr()\n\t\t\t\t\t.map((err) => formatError(err))\n\t\t\t\t\t.join('\\n')\n\t\t\t);\n\t\t}\n\n\t\treturn Ok(resolveResult.unwrap());\n\t},\n\tcomment: (content) => `<!--\\n${lines.join(lines.get(content), { prefix: () => '\\t' })}\\n-->`,\n\tformat: async (code, { formatter, prettierOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { parser: 'vue', ...prettierOptions });\n\t\t}\n\n\t\t// biome has issues with vue support\n\t\treturn code;\n\t},\n};\n","import * as prettier from 'prettier';\nimport type { Lang } from '.';\nimport * as lines from '../blocks/ts/lines';\nimport { Ok } from '../blocks/ts/result';\n\n/** Language support for `*.(yaml|yml)` files. */\nexport const yaml: Lang = {\n\tmatches: (fileName) => fileName.endsWith('.yml') || fileName.endsWith('.yaml'),\n\tresolveDependencies: () =>\n\t\tOk({ dependencies: [], local: [], devDependencies: [], imports: {} }),\n\tcomment: (content: string) => lines.join(lines.get(content), { prefix: () => '# ' }),\n\tformat: async (code, { formatter, prettierOptions }) => {\n\t\tif (!formatter) return code;\n\n\t\tif (formatter === 'prettier') {\n\t\t\treturn await prettier.format(code, { parser: 'yaml', ...prettierOptions });\n\t\t}\n\n\t\treturn code;\n\t},\n};\n","import fs from 'node:fs';\nimport { builtinModules } from 'node:module';\nimport type { PartialConfiguration } from '@biomejs/wasm-nodejs';\nimport color from 'chalk';\nimport { createPathsMatcher } from 'get-tsconfig';\nimport path from 'pathe';\nimport type * as prettier from 'prettier';\nimport validatePackageName from 'validate-npm-package-name';\nimport * as ascii from '../ascii';\nimport * as lines from '../blocks/ts/lines';\nimport { Err, Ok, type Result } from '../blocks/ts/result';\nimport type { Formatter } from '../config';\nimport { tryGetTsconfig } from '../files';\nimport { findNearestPackageJson } from '../package';\nimport { parsePackageName } from '../parse-package-name';\nimport { css } from './css';\nimport { html } from './html';\nimport { typescript } from './javascript';\nimport { json, jsonc } from './json';\nimport { sass } from './sass';\nimport { svelte } from './svelte';\nimport { svg } from './svg';\nimport { vue } from './vue';\nimport { yaml } from './yaml';\n\nexport type ResolvedDependencies = {\n\tlocal: string[];\n\tdevDependencies: string[];\n\tdependencies: string[];\n\t/** Maps a literal import to a template import to be replaced during add/update */\n\timports: Record<string, string>;\n};\n\nexport type ResolveDependencyOptions = {\n\tfilePath: string;\n\t/** Only valid for folder based blocks. Helps identify a self dependency */\n\tcontainingDir?: string;\n\tisSubDir: boolean;\n\texcludeDeps: string[];\n\tcwd: string;\n\tdirs: string[];\n};\n\nexport type FormatOptions = {\n\tformatter?: Formatter;\n\t/** Can be used to infer the prettier parser */\n\tfilePath: string;\n\tprettierOptions: prettier.Options | null;\n\tbiomeOptions: PartialConfiguration | null;\n};\n\nexport type Lang = {\n\t/** Matches the supported file types */\n\tmatches: (fileName: string) => boolean;\n\t/** Reads the file and gets any dependencies from its imports */\n\tresolveDependencies: (opts: ResolveDependencyOptions) => Result<ResolvedDependencies, string>;\n\t/** Returns a multiline comment containing the content */\n\tcomment: (content: string) => string;\n\tformat: (code: string, opts: FormatOptions) => Promise<string>;\n};\n\nexport type ResolveImportOptions = {\n\tmoduleSpecifiers: string[];\n\tisSubDir: boolean;\n\tfilePath: string;\n\t/** Only valid for folder based blocks. Helps identify a self dependency */\n\tcontainingDir?: string;\n\tdoNotInstall?: string[];\n\tdirs: string[];\n\tcwd: string;\n};\n\nexport function formatError(err: string) {\n\treturn `${lines.join(lines.get(err), {\n\t\tprefix: (l) => {\n\t\t\tif (l === 0) return `${ascii.VERTICAL_LINE}  ${ascii.ERROR} `;\n\n\t\t\treturn `${ascii.VERTICAL_LINE}  `;\n\t\t},\n\t})}`;\n}\n\nexport function resolveImports({\n\tmoduleSpecifiers,\n\tisSubDir,\n\tfilePath,\n\tcontainingDir,\n\tdoNotInstall,\n\tdirs,\n\tcwd,\n}: ResolveImportOptions): Result<ResolvedDependencies, string[]> {\n\tconst errors: string[] = [];\n\n\tconst deps = new Set<string>();\n\tconst localDeps = new Set<string>();\n\tconst imports: Record<string, string> = {};\n\n\tfor (const specifier of moduleSpecifiers) {\n\t\t// don't add dependencies to node\n\t\tif (builtinModules.includes(specifier) || specifier.startsWith('node:')) continue;\n\n\t\t// check if specifier is a local dependency\n\t\tif (specifier.startsWith('.')) {\n\t\t\tconst localDep = resolveLocalImport(specifier, isSubDir, {\n\t\t\t\tfilePath,\n\t\t\t\tcontainingDir,\n\t\t\t\tdirs,\n\t\t\t\tcwd,\n\t\t\t});\n\n\t\t\tif (localDep.isErr()) {\n\t\t\t\terrors.push(localDep.unwrapErr());\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst dep = localDep.unwrap();\n\n\t\t\tif (dep) {\n\t\t\t\tlocalDeps.add(dep.dependency);\n\t\t\t\timports[specifier] = dep.template;\n\t\t\t}\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// if specifier wasn't a local dependency then it might be a path alias\n\t\tconst localDep = tryResolveLocalAlias(specifier, isSubDir, {\n\t\t\tfilePath,\n\t\t\tcontainingDir,\n\t\t\tdirs,\n\t\t\tcwd,\n\t\t});\n\n\t\tif (!localDep.isErr()) {\n\t\t\tconst dep = localDep.unwrap();\n\n\t\t\tif (dep) {\n\t\t\t\tlocalDeps.add(dep.dependency);\n\t\t\t\timports[specifier] = dep.template;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// check if the specifier is a package\n\t\tconst parsed = parsePackageName(specifier);\n\n\t\tif (!parsed.isErr()) {\n\t\t\tconst depInfo = parsed.unwrap();\n\n\t\t\tif (validatePackageName(depInfo.name).validForNewPackages) {\n\t\t\t\tdeps.add(specifier);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tconsole.warn(\n\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped adding import \\`${color.cyan(specifier)}\\` from ${filePath}. Reason: Not a valid package name or path alias.`\n\t\t);\n\t}\n\n\tif (errors.length > 0) {\n\t\treturn Err(errors);\n\t}\n\n\tconst { devDependencies, dependencies } = resolveRemoteDeps(Array.from(deps), filePath, {\n\t\tdoNotInstall: doNotInstall ? doNotInstall : [],\n\t});\n\n\treturn Ok({\n\t\tdependencies,\n\t\tdevDependencies,\n\t\tlocal: Array.from(localDeps),\n\t\timports,\n\t} satisfies ResolvedDependencies);\n}\n\ntype ResolveLocalImportResult = {\n\t/** The local block that is a dependency */\n\tdependency: string;\n\t/** A template used to resolve the import during add/update */\n\ttemplate: string;\n};\n\nfunction resolveLocalImport(\n\tmod: string,\n\tisSubDir: boolean,\n\t{\n\t\tfilePath,\n\t\tcontainingDir,\n\t\tdropExtension = true,\n\t\talias,\n\t\tdirs,\n\t\tcwd,\n\t}: {\n\t\tfilePath: string;\n\t\tcontainingDir?: string;\n\t\tdirs: string[];\n\t\talias?: string;\n\t\tmodIsFile?: boolean;\n\t\tcwd: string;\n\t\tdropExtension?: boolean;\n\t}\n): Result<ResolveLocalImportResult | undefined, string> {\n\tif (isSubDir && (mod.startsWith('./') || mod === '.')) return Ok(undefined);\n\n\t// get the actual path to the module\n\tconst modPath = path.join(path.join(filePath, '../'), mod);\n\n\t// prevent self reference in subdirectories\n\tif (containingDir && modPath.startsWith(containingDir)) return Ok(undefined);\n\n\tconst absPath = path.resolve(modPath);\n\n\t// Here we try and find the most specific directory that matches the module.\n\t// This fixes issues where there are 2 nested directories that both\n\t// contain the module by simply choosing the more specific path.\n\tlet longestMatch: string | null = null;\n\tfor (const dir of dirs) {\n\t\tconst containingPath = path.resolve(path.join(cwd, dir));\n\n\t\tif (absPath.startsWith(containingPath)) {\n\t\t\tif (longestMatch === null || longestMatch.length < containingPath.length) {\n\t\t\t\tlongestMatch = containingPath;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (longestMatch !== null) {\n\t\treturn Ok(parsePath(absPath.slice(longestMatch.length + 1), dropExtension));\n\t}\n\n\treturn Err(\n\t\t`${filePath}:\\n${alias ? alias : mod} references code not contained in ${color.bold(dirs.join(', '))} and cannot be resolved.`\n\t);\n}\n\nfunction parsePath(localPath: string, dropExtension = true): ResolveLocalImportResult {\n\tlet [category, block, ...rest] = localPath.split('/');\n\n\t// if undefined we assume we are pointing to the index file\n\tif (block === undefined) {\n\t\tblock = 'index';\n\t}\n\n\tlet trimmedBlock = block;\n\n\t// remove file extension\n\tif (dropExtension && trimmedBlock.includes('.')) {\n\t\ttrimmedBlock = trimmedBlock.slice(\n\t\t\t0,\n\t\t\ttrimmedBlock.length - path.parse(trimmedBlock).ext.length\n\t\t);\n\t}\n\n\tconst blockSpecifier = `${category}/${trimmedBlock}`;\n\n\tlet template = `{{${blockSpecifier}}}`;\n\n\tif (rest.length === 0) {\n\t\tif (trimmedBlock.length !== block.length) {\n\t\t\t// add extension to template\n\t\t\ttemplate += path.parse(block).ext;\n\t\t}\n\t} else {\n\t\ttemplate += `/${rest.join('/')}`;\n\t}\n\n\treturn { dependency: blockSpecifier, template };\n}\n\n/** Tries to resolve the modules as an alias using the tsconfig. */\nfunction tryResolveLocalAlias(\n\tmod: string,\n\tisSubDir: boolean,\n\t{\n\t\tfilePath,\n\t\tdirs,\n\t\tcwd,\n\t\tcontainingDir,\n\t}: { filePath: string; containingDir?: string; dirs: string[]; cwd: string }\n): Result<ResolveLocalImportResult | undefined, string> {\n\tconst configResult = tryGetTsconfig(filePath);\n\n\tif (configResult.isErr()) return Err(configResult.unwrapErr());\n\n\tconst config = configResult.unwrap();\n\n\tif (config === null) return Ok(undefined);\n\n\tconst matcher = createPathsMatcher(config);\n\n\tif (matcher) {\n\t\t// if the mod is actually remote the returns paths will be empty\n\t\tconst paths = matcher(mod);\n\n\t\tfor (const modPath of paths) {\n\t\t\tconst foundMod = searchForModule(modPath);\n\n\t\t\tif (!foundMod) continue;\n\n\t\t\tconst pathResolved = path.relative(\n\t\t\t\tpath.resolve(path.join(filePath, '../')),\n\t\t\t\tfoundMod.prettyPath\n\t\t\t);\n\n\t\t\t// if it is not equal the extension has already been dropped\n\t\t\t// we omit the '' extension because it there is no extension there is nothing to be dropped\n\t\t\tconst shouldDropExtension = resolutionEquality(foundMod.prettyPath, foundMod.path, [\n\t\t\t\t'.js',\n\t\t\t\t'.ts',\n\t\t\t]);\n\n\t\t\tconst localDep = resolveLocalImport(pathResolved, isSubDir, {\n\t\t\t\tfilePath,\n\t\t\t\tcontainingDir,\n\t\t\t\talias: mod,\n\t\t\t\tdropExtension: shouldDropExtension,\n\t\t\t\tdirs,\n\t\t\t\tcwd,\n\t\t\t\tmodIsFile: foundMod.type === 'file',\n\t\t\t});\n\n\t\t\tif (localDep.isErr()) return Err(localDep.unwrapErr());\n\n\t\t\tif (localDep.unwrap()) return Ok(localDep.unwrap()!);\n\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn Ok(undefined);\n}\n\n/** Node allows no extension or a .js extension or a .ts extension to all resolve to the same place because of this we employ a different method of equality.\n *\n *  Basically we want to treat a path with a .js extension as equal to the same path with a .ts extension and vise versa.\n */\nfunction resolutionEquality(pathA: string, pathB: string, validExtensions = ['.ts', '.js', '']) {\n\tif (pathA === pathB) return true;\n\n\tconst parsedA = path.parse(pathA);\n\tconst parsedB = path.parse(pathB);\n\n\tconst pathAWithoutExtension = path.join(parsedA.dir, parsedA.name);\n\tconst pathBWithoutExtension = path.join(parsedB.dir, parsedB.name);\n\n\t// if paths without extension aren't equal then return false\n\tif (pathAWithoutExtension !== pathBWithoutExtension) return false;\n\n\t// as long as both paths have a .js or .ts extension we can be sure that they are equal\n\tif (validExtensions.includes(parsedA.ext) && validExtensions.includes(parsedB.ext)) return true;\n\n\treturn false;\n}\n\n/** Searches around for the module\n *\n * @param path\n */\nfunction searchForModule(\n\tmodPath: string\n): { path: string; prettyPath: string; type: 'file' | 'directory' } | undefined {\n\tif (fs.existsSync(modPath)) {\n\t\treturn {\n\t\t\tpath: modPath,\n\t\t\tprettyPath: modPath,\n\t\t\ttype: fs.statSync(modPath).isDirectory() ? 'directory' : 'file',\n\t\t};\n\t}\n\n\tconst containing = path.join(modPath, '../');\n\n\t// if containing folder doesn't exist this can't exist\n\tif (!fs.existsSync(containing)) return undefined;\n\n\tconst modParsed = path.parse(modPath);\n\n\t// sometimes it will point to .js because it will resolve in prod but not for us\n\tif (modParsed.ext === '.js') {\n\t\tconst newPath = `${modPath.slice(0, modPath.length - 3)}.ts`;\n\n\t\tif (fs.existsSync(newPath)) return { path: newPath, prettyPath: modPath, type: 'file' };\n\t}\n\n\tconst files = fs.readdirSync(containing);\n\n\tfor (const file of files) {\n\t\tconst fileParsed = path.parse(file);\n\n\t\t// this way the extension doesn't matter\n\t\tif (fileParsed.name === modParsed.base) {\n\t\t\tconst filePath = path.join(containing, file);\n\n\t\t\t// we remove the extension since it wasn't included by the user\n\t\t\tconst prettyPath = filePath.slice(0, filePath.length - fileParsed.ext.length);\n\n\t\t\treturn {\n\t\t\t\tpath: filePath,\n\t\t\t\tprettyPath: prettyPath,\n\t\t\t\ttype: fs.statSync(filePath).isDirectory() ? 'directory' : 'file',\n\t\t\t};\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n/** Iterates over the dependency and resolves each one using the nearest package.json file.\n * Strips node APIs and pins the version of each dependency based on what is in the package.json.\n *\n * @param deps\n * @param filePath\n * @returns\n */\nfunction resolveRemoteDeps(\n\tdeps: string[],\n\tfilePath: string,\n\t{ doNotInstall }: { doNotInstall: string[] } = {\n\t\tdoNotInstall: [],\n\t}\n) {\n\tconst exemptDeps = new Set(doNotInstall);\n\n\tconst pkgPath = findNearestPackageJson(path.dirname(filePath), '');\n\n\tconst dependencies = new Set<string>();\n\tconst devDependencies = new Set<string>();\n\n\tif (pkgPath) {\n\t\tconst { devDependencies: packageDevDependencies, dependencies: packageDependencies } =\n\t\t\tJSON.parse(fs.readFileSync(pkgPath, 'utf-8'));\n\n\t\tfor (const dep of deps) {\n\t\t\tconst parsed = parsePackageName(dep);\n\n\t\t\tif (parsed.isErr()) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped adding import \\`${color.cyan(dep)}\\`. Reason: Couldn't parse package name`\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst depInfo = parsed.unwrap();\n\n\t\t\tif (!validatePackageName(depInfo.name).validForNewPackages) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped adding import \\`${color.cyan(dep)}\\`. Reason: Not a valid package name`\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (exemptDeps.has(depInfo.name)) continue;\n\n\t\t\tlet version: string | undefined = undefined;\n\t\t\tif (packageDependencies !== undefined) {\n\t\t\t\tversion = packageDependencies[depInfo.name];\n\t\t\t}\n\n\t\t\tif (version !== undefined) {\n\t\t\t\tdependencies.add(`${depInfo.name}@${version}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (packageDevDependencies !== undefined) {\n\t\t\t\tversion = packageDevDependencies[depInfo.name];\n\t\t\t}\n\n\t\t\tif (version !== undefined) {\n\t\t\t\tdevDependencies.add(`${depInfo.name}@${version}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if no version found just add it without a version\n\t\t\tdependencies.add(depInfo.name);\n\t\t}\n\t}\n\n\treturn {\n\t\tdependencies: Array.from(dependencies),\n\t\tdevDependencies: Array.from(devDependencies),\n\t};\n}\n\nconst languages: Lang[] = [css, html, json, jsonc, sass, svelte, svg, typescript, vue, yaml];\n\nexport {\n\tcss,\n\thtml,\n\tjson,\n\tjsonc,\n\tsass,\n\tsvelte,\n\tsvg,\n\ttypescript,\n\tvue,\n\tyaml,\n\tlanguages,\n\tresolutionEquality,\n};\n","import fs from 'node:fs';\nimport color from 'chalk';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport type { Block, Category, Manifest } from '../../types';\nimport * as ascii from '../ascii';\nimport type { RegistryConfig } from '../config';\nimport { parsePackageName } from '../parse-package-name';\n\n// Update this list as needed\n// Use the name of the package not the framework\nconst FRAMEWORKS = new Set([\n\t// svelte\n\t'svelte',\n\t'@sveltejs/kit',\n\n\t// vue\n\t'vue',\n\t'nuxt',\n\n\t// react\n\t'react',\n\t'react-dom',\n\t'next',\n\t'@remix-run/react',\n\n\t// angular\n\t'@angular/core',\n\t'@angular/common',\n\t'@angular/forms',\n\t'@angular/platform-browser',\n\t'@angular/platform-browser-dynamic',\n\t'@angular/router',\n\n\t// misc\n\t'@builder.io/qwik',\n\t'astro',\n\t'solid-js',\n]);\n\nconst ruleLevelSchema = v.union([v.literal('off'), v.literal('warn'), v.literal('error')]);\n\nexport type RuleLevel = v.InferInput<typeof ruleLevelSchema>;\n\nexport type CheckOptions = {\n\tmanifest: Manifest;\n\toptions: (string | number)[];\n\tcwd: string;\n\tconfig: RegistryConfig;\n};\n\nexport type Rule = { description: string } & (\n\t| {\n\t\t\tscope: 'block';\n\t\t\tcheck: (block: Block, opts: CheckOptions) => string[] | undefined;\n\t  }\n\t| {\n\t\t\tscope: 'global';\n\t\t\tcheck: (opts: CheckOptions) => string[] | undefined;\n\t  }\n);\n\nconst ruleKeySchema = v.union([\n\tv.literal('no-category-index-file-dependency'),\n\tv.literal('no-unpinned-dependency'),\n\tv.literal('require-local-dependency-exists'),\n\tv.literal('max-local-dependencies'),\n\tv.literal('no-circular-dependency'),\n\tv.literal('no-unused-block'),\n\tv.literal('no-framework-dependency'),\n\tv.literal('require-config-file-exists'),\n\tv.literal('no-config-file-framework-dependency'),\n\tv.literal('no-config-file-unpinned-dependency'),\n]);\n\nexport type RuleKey = v.InferInput<typeof ruleKeySchema>;\n\nconst rules: Record<RuleKey, Rule> = {\n\t'no-unpinned-dependency': {\n\t\tdescription: 'Require all dependencies to have a pinned version.',\n\t\tscope: 'block',\n\t\tcheck: (block) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tfor (const dep of [...block.dependencies, ...block.devDependencies]) {\n\t\t\t\tif (!dep.includes('@')) {\n\t\t\t\t\terrors.push(`Couldn't find a version to use for ${color.bold(dep)}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'require-local-dependency-exists': {\n\t\tdescription: 'Require all local dependencies to exist.',\n\t\tscope: 'block',\n\t\tcheck: (block, { manifest }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tfor (const dep of block.localDependencies) {\n\t\t\t\tconst [depCategoryName, depBlockName] = dep.split('/');\n\n\t\t\t\tconst depCategory = manifest.categories.find(\n\t\t\t\t\t(cat) => cat.name.trim() === depCategoryName.trim()\n\t\t\t\t);\n\n\t\t\t\tconst error = `${color.bold(`${block.category}/${block.name}`)} depends on local dependency ${color.bold(dep)} which doesn't exist`;\n\n\t\t\t\tif (!depCategory) {\n\t\t\t\t\terrors.push(error);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (depCategory.blocks.find((b) => b.name === depBlockName) === undefined) {\n\t\t\t\t\terrors.push(error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'no-category-index-file-dependency': {\n\t\tdescription: 'Disallow depending on the index file of a category.',\n\t\tscope: 'block',\n\t\tcheck: (block, { manifest }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tfor (const dep of block.localDependencies) {\n\t\t\t\tconst [categoryName, name] = dep.split('/');\n\n\t\t\t\tif (name !== 'index') continue;\n\n\t\t\t\tconst category = manifest.categories.find((cat) => cat.name === categoryName);\n\n\t\t\t\tif (!category) continue;\n\n\t\t\t\tconst depBlock = category.blocks.find((b) => b.name === name);\n\n\t\t\t\tif (!depBlock) continue;\n\n\t\t\t\terrors.push(\n\t\t\t\t\t`${color.bold(`${block.category}/${block.name}`)} depends on ${color.bold(`${categoryName}/${name}`)}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'max-local-dependencies': {\n\t\tdescription: 'Enforces a limit on the amount of local dependencies a block can have.',\n\t\tscope: 'block',\n\t\tcheck: (block, { options }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tlet limit: number;\n\n\t\t\tif (typeof options[0] !== 'number') {\n\t\t\t\tlimit = 5;\n\t\t\t} else {\n\t\t\t\tlimit = options[0];\n\t\t\t}\n\n\t\t\tif (block.localDependencies.length > limit) {\n\t\t\t\terrors.push(\n\t\t\t\t\t`${color.bold(`${block.category}/${block.name}`)} has too many local dependencies (${color.bold(block.localDependencies.length)}) limit (${color.bold(limit)})`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'no-circular-dependency': {\n\t\tdescription: 'Disallow circular dependencies.',\n\t\tscope: 'block',\n\t\tcheck: (block, { manifest }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tconst specifier = `${block.category}/${block.name}`;\n\n\t\t\tconst chain = searchForDep(specifier, block, manifest.categories);\n\n\t\t\tif (chain) {\n\t\t\t\terrors.push(\n\t\t\t\t\t`There is a circular dependency in ${color.bold(specifier)}: ${color.bold(chain.join(' -> '))}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'no-unused-block': {\n\t\tdescription: 'Disallow unused blocks. (Not listed and not a dependency of another block)',\n\t\tscope: 'block',\n\t\tcheck: (block, { manifest }) => {\n\t\t\tif (block.list) return;\n\n\t\t\tconst specifier = `${block.category}/${block.name}`;\n\n\t\t\tconst listedBlocks = manifest.categories\n\t\t\t\t.flatMap((cat) => cat.blocks)\n\t\t\t\t.filter((b) => b.list);\n\n\t\t\tfor (const block of listedBlocks) {\n\t\t\t\tconst chain = searchForDep(specifier, block, manifest.categories);\n\n\t\t\t\tif (chain) return;\n\t\t\t}\n\n\t\t\treturn [`${color.bold(specifier)} is unused and will be ${color.bold.red('removed')}`];\n\t\t},\n\t},\n\t'no-framework-dependency': {\n\t\tdescription: 'Disallow frameworks (Svelte, Vue, React) as dependencies.',\n\t\tscope: 'block',\n\t\tcheck: (block) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tconst frameworkDeps = [...block.devDependencies, ...block.dependencies]\n\t\t\t\t.map((d) => parsePackageName(d).unwrap().name)\n\t\t\t\t.filter((d) => FRAMEWORKS.has(d));\n\n\t\t\tif (frameworkDeps.length > 0) {\n\t\t\t\tfor (const frameworkDep of frameworkDeps) {\n\t\t\t\t\terrors.push(\n\t\t\t\t\t\t`${color.bold(`${block.category}/${block.name}`)} depends on ${color.bold(frameworkDep)} causing it to be installed when added`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'require-config-file-exists': {\n\t\tdescription: 'Require all of the paths listed in `configFiles` to exist.',\n\t\tscope: 'global',\n\t\tcheck: ({ manifest, cwd }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tif (manifest.configFiles === undefined) return undefined;\n\n\t\t\tfor (const file of manifest.configFiles) {\n\t\t\t\tif (fs.existsSync(path.join(cwd, file.path))) continue;\n\n\t\t\t\terrors.push(\n\t\t\t\t\t`The ${color.bold(file.name)} config file doesn't exist at ${color.bold(path.join(cwd, file.path))}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'no-config-file-framework-dependency': {\n\t\tdescription: 'Disallow frameworks (Svelte, Vue, React) as dependencies of config files.',\n\t\tscope: 'global',\n\t\tcheck: ({ manifest }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tif (manifest.configFiles === undefined) return undefined;\n\n\t\t\tfor (const configFile of manifest.configFiles) {\n\t\t\t\tconst frameworkDeps = [\n\t\t\t\t\t...(configFile.devDependencies ?? []),\n\t\t\t\t\t...(configFile.dependencies ?? []),\n\t\t\t\t]\n\t\t\t\t\t.map((d) => parsePackageName(d).unwrap().name)\n\t\t\t\t\t.filter((d) => FRAMEWORKS.has(d));\n\n\t\t\t\tif (frameworkDeps.length > 0) {\n\t\t\t\t\tfor (const frameworkDep of frameworkDeps) {\n\t\t\t\t\t\terrors.push(\n\t\t\t\t\t\t\t`${color.bold(configFile.name)} depends on ${color.bold(frameworkDep)} causing it to be installed when added`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n\t'no-config-file-unpinned-dependency': {\n\t\tdescription: 'Require all dependencies of config files to have a pinned version.',\n\t\tscope: 'global',\n\t\tcheck: ({ manifest }) => {\n\t\t\tconst errors: string[] = [];\n\n\t\t\tif (!manifest.configFiles) return undefined;\n\n\t\t\tfor (const configFile of manifest.configFiles) {\n\t\t\t\tfor (const dep of [\n\t\t\t\t\t...(configFile.dependencies ?? []),\n\t\t\t\t\t...(configFile.devDependencies ?? []),\n\t\t\t\t]) {\n\t\t\t\t\tif (!dep.includes('@')) {\n\t\t\t\t\t\terrors.push(`Couldn't find a version to use for ${color.bold(dep)}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn errors.length > 0 ? errors : undefined;\n\t\t},\n\t},\n} as const;\n\nconst ruleConfigSchema = v.record(\n\truleKeySchema,\n\tv.union([\n\t\truleLevelSchema,\n\t\tv.tupleWithRest(\n\t\t\t[ruleLevelSchema, v.union([v.string(), v.number()])],\n\t\t\tv.union([v.string(), v.number()])\n\t\t),\n\t])\n);\n\nexport type RuleConfig = v.InferInput<typeof ruleConfigSchema>;\n\nconst DEFAULT_CONFIG: RuleConfig = {\n\t'no-category-index-file-dependency': 'warn',\n\t'no-unpinned-dependency': 'warn',\n\t'require-local-dependency-exists': 'error',\n\t'max-local-dependencies': ['warn', 10],\n\t'no-circular-dependency': 'error',\n\t'no-unused-block': 'warn',\n\t'no-framework-dependency': 'warn',\n\t'require-config-file-exists': 'error',\n\t'no-config-file-framework-dependency': 'warn',\n\t'no-config-file-unpinned-dependency': 'warn',\n} as const;\n\n/** Runs checks on the manifest file.\n *\n * @param manifest\n * @param config\n * @param ruleConfig\n * @returns\n */\nfunction runRules(\n\tmanifest: Manifest,\n\tconfig: RegistryConfig,\n\tcwd: string,\n\truleConfig: RuleConfig = DEFAULT_CONFIG\n): { warnings: string[]; errors: string[] } {\n\tconst warnings: string[] = [];\n\tconst errors: string[] = [];\n\n\t// run global rules\n\tfor (const [name, rule] of Object.entries(rules)) {\n\t\tif (rule.scope === 'block') continue;\n\n\t\tconst conf = ruleConfig[name as RuleKey]!;\n\n\t\tlet level: RuleLevel;\n\t\tconst options: (string | number)[] = [];\n\t\tif (Array.isArray(conf)) {\n\t\t\tlevel = conf[0];\n\t\t\toptions.push(...conf.slice(1));\n\t\t} else {\n\t\t\tlevel = conf;\n\t\t}\n\n\t\tif (level === 'off') continue;\n\n\t\tconst ruleErrors = rule.check({ manifest, options, cwd, config });\n\n\t\tif (!ruleErrors) continue;\n\n\t\tif (level === 'error') {\n\t\t\terrors.push(\n\t\t\t\t...ruleErrors.map(\n\t\t\t\t\t(err) =>\n\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.ERROR} ${color.red(err)} ${color.gray(name)}`\n\t\t\t\t)\n\t\t\t);\n\t\t\tcontinue;\n\t\t}\n\n\t\twarnings.push(\n\t\t\t...ruleErrors.map(\n\t\t\t\t(err) => `${ascii.VERTICAL_LINE}  ${ascii.WARN} ${err} ${color.gray(name)}`\n\t\t\t)\n\t\t);\n\t}\n\n\t// run block rules\n\tfor (const category of manifest.categories) {\n\t\tfor (const block of category.blocks) {\n\t\t\tfor (const [name, rule] of Object.entries(rules)) {\n\t\t\t\tif (rule.scope === 'global') continue;\n\n\t\t\t\tconst conf = ruleConfig[name as RuleKey]!;\n\n\t\t\t\tlet level: RuleLevel;\n\t\t\t\tconst options: (string | number)[] = [];\n\t\t\t\tif (Array.isArray(conf)) {\n\t\t\t\t\tlevel = conf[0];\n\t\t\t\t\toptions.push(...conf.slice(1));\n\t\t\t\t} else {\n\t\t\t\t\tlevel = conf;\n\t\t\t\t}\n\n\t\t\t\tif (level === 'off') continue;\n\n\t\t\t\tconst ruleErrors = rule.check(block, { manifest, options, cwd, config });\n\n\t\t\t\tif (!ruleErrors) continue;\n\n\t\t\t\tif (level === 'error') {\n\t\t\t\t\terrors.push(\n\t\t\t\t\t\t...ruleErrors.map(\n\t\t\t\t\t\t\t(err) =>\n\t\t\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.ERROR} ${color.red(err)} ${color.gray(name)}`\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\twarnings.push(\n\t\t\t\t\t...ruleErrors.map(\n\t\t\t\t\t\t(err) => `${ascii.VERTICAL_LINE}  ${ascii.WARN} ${err} ${color.gray(name)}`\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { warnings, errors };\n}\n\n/** Searches for the local dependency tree for the provided specifier returns the path it took to find the dependency */\nfunction searchForDep(\n\tsearch: string,\n\tblock: Block,\n\tcategories: Category[],\n\tchain: string[] = []\n): string[] | undefined {\n\tconst newChain = [...chain, `${block.category}/${block.name}`];\n\n\tfor (const dep of block.localDependencies) {\n\t\tif (dep === search) return newChain;\n\n\t\t// it will be found in another pass but we don't want to get a stack overflow\n\t\tif (chain.includes(dep)) return undefined;\n\n\t\tconst [categoryName, blockName] = dep.split('/');\n\n\t\tconst depBlock = categories\n\t\t\t.find((cat) => cat.name === categoryName)\n\t\t\t?.blocks.find((b) => b.name === blockName);\n\n\t\tif (!depBlock) continue;\n\n\t\tconst found = searchForDep(search, depBlock, categories, newChain);\n\n\t\tif (found) return [...found, search];\n\t}\n\n\treturn undefined;\n}\n\n/** Checks if the provided block is depended on anywhere */\nfunction isDependedOn(specifier: string, categories: Category[]): boolean {\n\tfor (const category of categories) {\n\t\tfor (const block of category.blocks) {\n\t\t\tif (!block.list) continue;\n\n\t\t\tconst chain = searchForDep(specifier, block, categories);\n\n\t\t\tif (chain) return true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport {\n\trules,\n\trunRules,\n\tDEFAULT_CONFIG,\n\truleLevelSchema,\n\truleConfigSchema,\n\truleKeySchema,\n\tsearchForDep,\n\tisDependedOn,\n};\n","import fs from 'node:fs';\nimport color from 'chalk';\nimport { program } from 'commander';\nimport type { Ignore } from 'ignore';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport { type Block, type Category, type Manifest, categorySchema } from '../../types';\nimport * as ascii from '../ascii';\nimport * as strings from '../blocks/ts/strings';\nimport type { RegistryConfig } from '../config';\nimport { languages } from '../language-support';\nimport { isDependedOn } from './check';\n\nconst TEST_SUFFIXES = [\n\t'.test.ts',\n\t'_test.ts',\n\t'.test.js',\n\t'_test.js',\n\t'.spec.ts',\n\t'_spec.ts',\n\t'.spec.js',\n\t'_spec.js',\n\t'.stories.jsx',\n\t'_stories.jsx',\n\t'.stories.tsx',\n\t'_stories.tsx',\n] as const;\n\nconst DOCS_SUFFIXES = ['.mdx', '.md'] as const;\n\nexport function isTestFile(file: string): boolean {\n\treturn strings.endsWithOneOf(file, TEST_SUFFIXES) !== undefined;\n}\n\nexport function isDocsFile(file: string): boolean {\n\treturn strings.endsWithOneOf(file, DOCS_SUFFIXES) !== undefined;\n}\n\ntype Options = {\n\tcwd: string;\n\tignore: Ignore;\n\tconfig: RegistryConfig;\n};\n\n/** Using the provided path to the blocks folder builds the blocks into categories and also resolves dependencies\n *\n * @param blocksPath\n * @returns\n */\nexport function buildBlocksDirectory(\n\tblocksPath: string,\n\t{ cwd, ignore, config }: Options\n): Category[] {\n\tlet paths: string[];\n\n\ttry {\n\t\tpaths = fs.readdirSync(blocksPath);\n\t} catch {\n\t\tprogram.error(color.red(`Couldn't read the ${color.bold(blocksPath)} directory.`));\n\t}\n\n\tconst categories: Category[] = [];\n\n\tfor (const categoryPath of paths) {\n\t\tconst categoryDir = path.join(blocksPath, categoryPath);\n\n\t\t// we only check folders\n\t\tif (fs.statSync(categoryDir).isFile()) continue;\n\n\t\t// we append a '/' to tell ignore that this is a directory not a file\n\t\tconst dirName = `${path.relative(cwd, categoryDir)}/`;\n\n\t\tif (ignore.ignores(dirName)) continue;\n\n\t\tconst categoryName = path.basename(categoryPath);\n\n\t\tif (!shouldIncludeCategory(categoryName, config)) continue;\n\n\t\tconst listCategory = shouldListCategory(categoryName, config);\n\n\t\tconst category: Category = {\n\t\t\tname: categoryName,\n\t\t\tblocks: [],\n\t\t};\n\n\t\tconst files = fs.readdirSync(categoryDir);\n\n\t\tfor (const file of files) {\n\t\t\tconst blockDir = path.join(categoryDir, file);\n\t\t\tconst relativePath = path.relative(cwd, blockDir);\n\n\t\t\tif (ignore.ignores(relativePath)) continue;\n\n\t\t\tif (fs.statSync(blockDir).isFile()) {\n\t\t\t\tif (isTestFile(file)) continue;\n\n\t\t\t\tif (isDocsFile(file)) {\n\t\t\t\t\tif (!config.includeDocs) {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Documentation files (*.md, *.mdx) are not included by default include them with ${color.bold('--include-docs')}!`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst name = transformBlockName(file);\n\n\t\t\t\tconst listBlock = shouldListBlock(name, config);\n\n\t\t\t\tif (!shouldIncludeBlock(name, config)) continue;\n\n\t\t\t\tconst lang = languages.find((resolver) => resolver.matches(file));\n\n\t\t\t\t// warn for unsupported language\n\t\t\t\tif (!lang) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped \\`${color.bold(blockDir)}\\` \\`*${color.bold(\n\t\t\t\t\t\t\tpath.parse(file).ext\n\t\t\t\t\t\t)}\\` files are not currently supported!`\n\t\t\t\t\t);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// tries to find a test file with the same name as the file\n\t\t\t\tconst testsPath = files.find((f) =>\n\t\t\t\t\tTEST_SUFFIXES.find((suffix) => f === `${name}${suffix}`)\n\t\t\t\t);\n\n\t\t\t\t// tries to find a docs file with the same name as the file\n\t\t\t\tconst docsPath = files.find((f) =>\n\t\t\t\t\tDOCS_SUFFIXES.find((suffix) => f === `${name}${suffix}`)\n\t\t\t\t);\n\n\t\t\t\tconst { dependencies, devDependencies, local, imports } = lang\n\t\t\t\t\t.resolveDependencies({\n\t\t\t\t\t\tfilePath: blockDir,\n\t\t\t\t\t\tisSubDir: false,\n\t\t\t\t\t\texcludeDeps: config.excludeDeps,\n\t\t\t\t\t\tdirs: config.dirs,\n\t\t\t\t\t\tcwd,\n\t\t\t\t\t})\n\t\t\t\t\t.match(\n\t\t\t\t\t\t(val) => val,\n\t\t\t\t\t\t(err) => {\n\t\t\t\t\t\t\tprogram.error(color.red(err));\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\tconst block: Block = {\n\t\t\t\t\tname,\n\t\t\t\t\tdirectory: path.relative(cwd, categoryDir),\n\t\t\t\t\tcategory: categoryName,\n\t\t\t\t\ttests: testsPath !== undefined,\n\t\t\t\t\tdocs: docsPath !== undefined,\n\t\t\t\t\tsubdirectory: false,\n\t\t\t\t\tlist: listCategory ? listBlock : false,\n\t\t\t\t\tfiles: [file],\n\t\t\t\t\tlocalDependencies: local,\n\t\t\t\t\t_imports_: imports,\n\t\t\t\t\tdependencies,\n\t\t\t\t\tdevDependencies,\n\t\t\t\t};\n\n\t\t\t\t// if test file exists add the file\n\t\t\t\tif (testsPath !== undefined) block.files.push(testsPath);\n\n\t\t\t\t// if docs file exists add the file\n\t\t\t\tif (docsPath !== undefined) block.files.push(docsPath);\n\n\t\t\t\tcategory.blocks.push(block);\n\t\t\t} else {\n\t\t\t\tconst blockName = file;\n\n\t\t\t\tconst listBlock = shouldListBlock(blockName, config);\n\n\t\t\t\tif (!shouldIncludeBlock(blockName, config)) continue;\n\n\t\t\t\tconst localDepsSet = new Set<string>();\n\t\t\t\tconst depsSet = new Set<string>();\n\t\t\t\tconst devDepsSet = new Set<string>();\n\t\t\t\tconst imports: Record<string, string> = {};\n\n\t\t\t\tlet hasTests = false;\n\t\t\t\tlet hasDocs = false;\n\n\t\t\t\tconst blockFiles: string[] = [];\n\n\t\t\t\t// if the user has enabled allow subdirectories we recursively check each directory and resolve any dependencies\n\t\t\t\tconst walkFiles = (base: string, files: string[]) => {\n\t\t\t\t\tfor (const f of files) {\n\t\t\t\t\t\tconst filePath = path.join(base, f);\n\t\t\t\t\t\t// relative to the block root\n\t\t\t\t\t\tconst relativeFilePath = filePath.slice(blockDir.length + 1);\n\n\t\t\t\t\t\tif (isTestFile(f)) {\n\t\t\t\t\t\t\thasTests = true;\n\n\t\t\t\t\t\t\tblockFiles.push(relativeFilePath);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isDocsFile(f)) {\n\t\t\t\t\t\t\tif (!config.includeDocs) {\n\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Documentation files (*.md, *.mdx) are not included by default include them with ${color.bold('--include-docs')}!`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\thasDocs = true;\n\t\t\t\t\t\t\tblockFiles.push(relativeFilePath);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fs.statSync(filePath).isDirectory()) {\n\t\t\t\t\t\t\tif (!config.allowSubdirectories) {\n\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped \\`${color.bold(path.join(blockDir, f))}\\` subdirectories are not allowed! Allow them with ${color.bold('--allow-subdirectories')}!`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst subFiles = fs.readdirSync(filePath);\n\n\t\t\t\t\t\t\twalkFiles(filePath, subFiles);\n\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst lang = languages.find((resolver) => resolver.matches(f));\n\n\t\t\t\t\t\tif (!lang) {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped \\`${filePath}\\` \\`*${color.bold(\n\t\t\t\t\t\t\t\t\tpath.parse(f).ext\n\t\t\t\t\t\t\t\t)}\\` files are not currently supported!`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tlocal,\n\t\t\t\t\t\t\tdependencies,\n\t\t\t\t\t\t\tdevDependencies,\n\t\t\t\t\t\t\timports: imps,\n\t\t\t\t\t\t} = lang\n\t\t\t\t\t\t\t.resolveDependencies({\n\t\t\t\t\t\t\t\tisSubDir: true,\n\t\t\t\t\t\t\t\texcludeDeps: config.excludeDeps,\n\t\t\t\t\t\t\t\tdirs: config.dirs,\n\t\t\t\t\t\t\t\tcontainingDir: blockDir,\n\t\t\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\t\t\tcwd,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.match(\n\t\t\t\t\t\t\t\t(val) => val,\n\t\t\t\t\t\t\t\t(err) => {\n\t\t\t\t\t\t\t\t\tprogram.error(color.red(err));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\tfor (const dep of local) {\n\t\t\t\t\t\t\t// don't add self\n\t\t\t\t\t\t\tif (dep === `${categoryName}/${blockName}`) continue;\n\n\t\t\t\t\t\t\tlocalDepsSet.add(dep);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const dep of dependencies) {\n\t\t\t\t\t\t\tdepsSet.add(dep);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const dep of devDependencies) {\n\t\t\t\t\t\t\tdevDepsSet.add(dep);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const [k, v] of Object.entries(imps)) {\n\t\t\t\t\t\t\timports[k] = v;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tblockFiles.push(relativeFilePath);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twalkFiles(blockDir, fs.readdirSync(blockDir));\n\n\t\t\t\tconst block: Block = {\n\t\t\t\t\tname: blockName,\n\t\t\t\t\tdirectory: path.relative(cwd, blockDir),\n\t\t\t\t\tcategory: categoryName,\n\t\t\t\t\ttests: hasTests,\n\t\t\t\t\tdocs: hasDocs,\n\t\t\t\t\tsubdirectory: true,\n\t\t\t\t\tlist: listCategory ? listBlock : false,\n\t\t\t\t\tfiles: blockFiles,\n\t\t\t\t\tlocalDependencies: Array.from(localDepsSet.keys()),\n\t\t\t\t\tdependencies: Array.from(depsSet.keys()),\n\t\t\t\t\tdevDependencies: Array.from(devDepsSet.keys()),\n\t\t\t\t\t_imports_: imports,\n\t\t\t\t};\n\n\t\t\t\tcategory.blocks.push(block);\n\t\t\t}\n\t\t}\n\n\t\tcategories.push(category);\n\t}\n\n\treturn categories;\n}\n\nexport function buildConfigFiles(\n\tconfig: RegistryConfig,\n\t{ cwd }: { cwd: string }\n): Manifest['configFiles'] {\n\tif (!config.configFiles) return undefined;\n\n\tconst configFiles: Manifest['configFiles'] = [];\n\n\tfor (const file of config.configFiles) {\n\t\tconst lang = languages.find((lang) => lang.matches(file.path));\n\n\t\tif (!lang) {\n\t\t\t// go ahead and add the file with no dependencies\n\t\t\tconfigFiles.push(file);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst { dependencies, devDependencies, local } = lang\n\t\t\t.resolveDependencies({\n\t\t\t\tfilePath: path.join(cwd, file.path),\n\t\t\t\tisSubDir: false,\n\t\t\t\texcludeDeps: config.excludeDeps,\n\t\t\t\tdirs: config.dirs,\n\t\t\t\tcwd,\n\t\t\t})\n\t\t\t.match(\n\t\t\t\t(val) => val,\n\t\t\t\t(err) => {\n\t\t\t\t\tprogram.error(color.red(err));\n\t\t\t\t}\n\t\t\t);\n\n\t\tif (local.length > 0) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`${color.bold(file.name)} ${color.bold(file.path)} Config files cannot have local dependencies!`\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tconfigFiles.push({ ...file, dependencies, devDependencies });\n\t}\n\n\treturn configFiles;\n}\n\nexport function shouldListBlock(name: string, config: RegistryConfig) {\n\t// the length check is just a short circuit here\n\tif (config.doNotListBlocks.length > 0 && config.doNotListBlocks.includes(name)) return false;\n\n\t// if the we only list the provided\n\t// we should only list if the name is included in that list\n\tif (config.listBlocks.length > 0) {\n\t\treturn config.listBlocks.includes(name);\n\t}\n\n\treturn true;\n}\n\nexport function shouldIncludeBlock(name: string, config: RegistryConfig) {\n\t// the length check is just a short circuit here\n\tif (config.excludeBlocks.length > 0 && config.excludeBlocks.includes(name)) return false;\n\n\t// if the we only include the provided\n\t// we should only include if the name is included in that list\n\tif (config.includeBlocks.length > 0) {\n\t\treturn config.includeBlocks.includes(name);\n\t}\n\n\treturn true;\n}\n\nexport function shouldListCategory(name: string, config: RegistryConfig) {\n\t// the length check is just a short circuit here\n\tif (config.doNotListCategories.length > 0 && config.doNotListCategories.includes(name))\n\t\treturn false;\n\n\t// if the we only list the provided\n\t// we should only list if the name is included in that list\n\tif (config.listCategories.length > 0) {\n\t\treturn config.listCategories.includes(name);\n\t}\n\n\treturn true;\n}\n\nexport function shouldIncludeCategory(name: string, config: RegistryConfig) {\n\t// the length check is just a short circuit here\n\tif (config.excludeCategories.length > 0 && config.excludeCategories.includes(name))\n\t\treturn false;\n\n\t// if the we only include the provided\n\t// we should only include if the name is included in that list\n\tif (config.includeCategories.length > 0) {\n\t\treturn config.includeCategories.includes(name);\n\t}\n\n\treturn true;\n}\n\n/** Takes the given file and returns the block name */\nfunction transformBlockName(file: string) {\n\treturn path.parse(path.basename(file)).name;\n}\n\nexport function pruneUnused(categories: Category[]): [Category[], number] {\n\tconst pruned: Category[] = [];\n\tconst prunedCount = 0;\n\n\tfor (const category of categories) {\n\t\tconst catBlocks: Block[] = [];\n\n\t\tfor (const block of category.blocks) {\n\t\t\tconst specifier = `${block.category}/${block.name}`;\n\n\t\t\tif (!block.list) {\n\t\t\t\tconst dependedOn = isDependedOn(specifier, categories);\n\n\t\t\t\tif (!dependedOn) continue;\n\t\t\t}\n\n\t\t\tcatBlocks.push(block);\n\t\t}\n\n\t\tif (catBlocks.length > 0) pruned.push({ name: category.name, blocks: catBlocks });\n\t}\n\n\treturn [pruned, prunedCount];\n}\n\nexport function readCategories(outputFilePath: string): Category[] {\n\treturn v.parse(v.array(categorySchema), JSON.parse(fs.readFileSync(outputFilePath).toString()));\n}\n","import fs from 'node:fs';\nimport color from 'chalk';\nimport { createPathsMatcher } from 'get-tsconfig';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport {\n\ttype Block,\n\taccessLevel,\n\tconfigFileSchema,\n\tmanifestMeta,\n\tpeerDependencySchema,\n} from '../types';\nimport { Err, Ok, type Result } from './blocks/ts/result';\nimport { ruleConfigSchema } from './build/check';\nimport { tryGetTsconfig } from './files';\n\n/** Files and directories ignore by default during build/publish */\nexport const IGNORES = ['.git', 'node_modules', '.DS_Store'] as const;\n\nexport const PROJECT_CONFIG_NAME = 'jsrepo.json';\nexport const REGISTRY_CONFIG_NAME = 'jsrepo-build-config.json';\n\nexport const formatterSchema = v.union([v.literal('prettier'), v.literal('biome')]);\n\nexport const pathsSchema = v.objectWithRest(\n\t{\n\t\t'*': v.string(),\n\t},\n\tv.string()\n);\n\nexport type Paths = v.InferInput<typeof pathsSchema>;\n\nexport const projectConfigSchema = v.object({\n\t$schema: v.string(),\n\trepos: v.optional(v.array(v.string()), []),\n\tincludeTests: v.boolean(),\n\tincludeDocs: v.optional(v.boolean(), false),\n\tpaths: pathsSchema,\n\tconfigFiles: v.optional(v.record(v.string(), v.string())),\n\twatermark: v.optional(v.boolean(), true),\n\tformatter: v.optional(formatterSchema),\n});\n\nexport function getProjectConfig(cwd: string): Result<ProjectConfig, string> {\n\tif (!fs.existsSync(path.join(cwd, PROJECT_CONFIG_NAME))) {\n\t\treturn Err('Could not find your configuration file! Please run `init`.');\n\t}\n\n\tconst config = v.safeParse(\n\t\tprojectConfigSchema,\n\t\tJSON.parse(fs.readFileSync(path.join(cwd, PROJECT_CONFIG_NAME)).toString())\n\t);\n\n\tif (!config.success) {\n\t\treturn Err(`There was an error reading your \\`${PROJECT_CONFIG_NAME}\\` file!`);\n\t}\n\n\treturn Ok(config.output);\n}\n\nexport type ProjectConfig = v.InferOutput<typeof projectConfigSchema>;\n\nexport type Formatter = v.InferOutput<typeof formatterSchema>;\n\nexport const registryConfigSchema = v.object({\n\t$schema: v.string(),\n\tname: v.optional(v.string()),\n\tversion: v.optional(v.string()),\n\treadme: v.optional(v.string(), 'README.md'),\n\taccess: v.optional(accessLevel),\n\tmeta: v.optional(manifestMeta),\n\tdefaultPaths: v.optional(v.record(v.string(), v.string())),\n\tpeerDependencies: v.optional(peerDependencySchema),\n\tconfigFiles: v.optional(v.array(configFileSchema)),\n\tdirs: v.array(v.string()),\n\toutputDir: v.optional(v.string()),\n\tincludeBlocks: v.optional(v.array(v.string()), []),\n\tincludeCategories: v.optional(v.array(v.string()), []),\n\texcludeBlocks: v.optional(v.array(v.string()), []),\n\texcludeCategories: v.optional(v.array(v.string()), []),\n\tdoNotListBlocks: v.optional(v.array(v.string()), []),\n\tdoNotListCategories: v.optional(v.array(v.string()), []),\n\tlistBlocks: v.optional(v.array(v.string()), []),\n\tlistCategories: v.optional(v.array(v.string()), []),\n\texcludeDeps: v.optional(v.array(v.string()), []),\n\tallowSubdirectories: v.optional(v.boolean()),\n\tpreview: v.optional(v.boolean()),\n\tincludeDocs: v.optional(v.boolean(), false),\n\trules: v.optional(ruleConfigSchema),\n});\n\nexport function getRegistryConfig(cwd: string): Result<RegistryConfig | null, string> {\n\tif (!fs.existsSync(path.join(cwd, REGISTRY_CONFIG_NAME))) {\n\t\treturn Ok(null);\n\t}\n\n\tconst config = v.safeParse(\n\t\tregistryConfigSchema,\n\t\tJSON.parse(fs.readFileSync(path.join(cwd, REGISTRY_CONFIG_NAME)).toString())\n\t);\n\n\tif (!config.success) {\n\t\treturn Err(`There was an error reading your \\`${REGISTRY_CONFIG_NAME}\\` file!`);\n\t}\n\n\treturn Ok(config.output);\n}\n\nexport type RegistryConfig = v.InferOutput<typeof registryConfigSchema>;\n\n/** Resolves the paths relative to the cwd */\nexport function resolvePaths(paths: Paths, cwd: string): Result<Paths, string> {\n\tconst config = tryGetTsconfig(cwd).unwrapOr(null);\n\n\tconst matcher = config ? createPathsMatcher(config) : null;\n\n\tconst newPaths: Paths = { '*': '' };\n\n\tfor (const [category, p] of Object.entries(paths)) {\n\t\tif (p.startsWith('./')) {\n\t\t\tnewPaths[category] = path.relative(cwd, path.join(path.resolve(cwd), p));\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (matcher === null) {\n\t\t\treturn Err(\n\t\t\t\t`Cannot resolve ${color.bold(`\\`\"${category}\": \"${p}\"\\``)} from paths because we couldn't find a tsconfig! If you intended to use a relative path ensure that your path starts with ${color.bold('`./`')}.`\n\t\t\t);\n\t\t}\n\n\t\tconst resolved = tryResolvePath(p, matcher, cwd);\n\n\t\tif (!resolved) {\n\t\t\treturn Err(\n\t\t\t\t`Cannot resolve ${color.bold(`\\`\"${category}\": \"${p}\"\\``)} from paths because we couldn't find a matching alias in the tsconfig. If you intended to use a relative path ensure that your path starts with ${color.bold('`./`')}.`\n\t\t\t);\n\t\t}\n\n\t\tnewPaths[category] = resolved;\n\t}\n\n\treturn Ok(newPaths);\n}\n\nfunction tryResolvePath(\n\tunresolvedPath: string,\n\tmatcher: (specifier: string) => string[],\n\tcwd: string\n): string | undefined {\n\tconst paths = matcher(unresolvedPath);\n\n\treturn paths.length > 0 ? path.relative(cwd, paths[0]) : undefined;\n}\n\n/** Gets the path where the block should be installed.\n *\n * @param block\n * @param resolvedPaths\n * @param cwd\n * @returns\n */\nexport function getPathForBlock(block: Block, resolvedPaths: Paths, cwd: string): string {\n\tlet directory: string;\n\n\tif (resolvedPaths[block.category] !== undefined) {\n\t\tdirectory = path.join(cwd, resolvedPaths[block.category]);\n\t} else {\n\t\tdirectory = path.join(cwd, resolvedPaths['*'], block.category);\n\t}\n\n\treturn directory;\n}\n","import color from 'chalk';\nimport {\n\thttp,\n\tazure,\n\tbitbucket,\n\tfetchManifest,\n\tfetchRaw,\n\tgithub,\n\tgitlab,\n\tjsrepo,\n\tproviders,\n\tselectProvider,\n} from '.';\nimport type { Block, Manifest } from '../../types';\nimport { Err, Ok, type Result } from '../blocks/ts/result';\nimport * as u from '../blocks/ts/url';\nimport { iFetch } from '../fetch';\nimport * as persisted from '../persisted';\nimport { TokenManager } from '../token-manager';\nimport type { RegistryProvider, RegistryProviderState } from './types';\n\nexport type RemoteBlock = Block & { sourceRepo: RegistryProviderState };\n\n/** Wraps the basic implementation to inject our internal fetch method and the correct token. */\nexport async function internalFetchRaw(\n\tstate: RegistryProviderState,\n\tresourcePath: string,\n\t{ verbose }: { verbose?: (msg: string) => void } = {}\n) {\n\treturn await fetchRaw(state, resourcePath, {\n\t\tverbose,\n\t\t// @ts-expect-error it's fine\n\t\tfetch: iFetch,\n\t\ttoken: getProviderToken(state.provider, state.url),\n\t});\n}\n\n/** Wraps the basic implementation to inject internal fetch method and the correct token. */\nexport async function internalFetchManifest(\n\tstate: RegistryProviderState,\n\t{ verbose }: { verbose?: (msg: string) => void } = {}\n) {\n\treturn await fetchManifest(state, {\n\t\tverbose,\n\t\t// @ts-expect-error it's fine\n\t\tfetch: iFetch,\n\t\ttoken: getProviderToken(state.provider, state.url),\n\t});\n}\n\n/** Gets the locally stored token for the given provider */\nexport function getProviderToken(provider: RegistryProvider, url: string): string | undefined {\n\tconst storage = new TokenManager();\n\n\t// there isn't an auth implementation for http\n\tif (provider.name === 'http') {\n\t\treturn storage.get(`http-${new URL(url).origin}`);\n\t}\n\n\treturn storage.get(provider.name);\n}\n\n/** Parses the provided url and returns the state.\n *\n * @param repo\n * @returns\n */\nexport async function getProviderState(\n\trepo: string,\n\t{ noCache = false }: { noCache?: boolean } = {}\n): Promise<Result<RegistryProviderState, string>> {\n\tconst provider = selectProvider(repo);\n\n\tif (provider) {\n\t\tconst storage = persisted.get();\n\n\t\t// only git providers are cached\n\t\tif (provider.name !== http.name && !noCache) {\n\t\t\tif (noCache) {\n\t\t\t\t// remove the outdated cache if it exists\n\t\t\t\tstorage.delete(`${repo}-state`);\n\t\t\t} else {\n\t\t\t\tconst cached = storage.get(`${repo}-state`);\n\n\t\t\t\tif (cached) return Ok({ ...(cached as RegistryProviderState), provider });\n\t\t\t}\n\t\t}\n\n\t\tconst parsed = provider.parse(repo, { fullyQualified: false });\n\n\t\tconst state = await provider.state(repo, {\n\t\t\ttoken: getProviderToken(provider, parsed.url),\n\t\t\t// @ts-expect-error but it does work\n\t\t\tfetch: iFetch,\n\t\t});\n\n\t\t// only cache git providers\n\t\tif (provider.name !== http.name && !noCache) {\n\t\t\tstorage.set(`${repo}-state`, state);\n\t\t}\n\n\t\treturn Ok(state);\n\t}\n\n\treturn Err(\n\t\t`Only ${providers.map((p, i) => `${i === providers.length - 1 ? 'and ' : ''}${color.bold(p.name)}`).join(', ')} registries are supported at this time!`\n\t);\n}\n\n/** Gets the provider state for each provided repo url\n *\n * @param repos\n * @returns\n */\nexport async function forEachPathGetProviderState(\n\trepos: string[],\n\t{ noCache = false }: { noCache?: boolean } = {}\n): Promise<Result<RegistryProviderState[], { message: string; repo: string }>> {\n\tconst resolvedPaths: RegistryProviderState[] = [];\n\n\tconst errors = await Promise.all(\n\t\trepos.map(async (repo) => {\n\t\t\tconst getProviderResult = await getProviderState(repo, { noCache });\n\n\t\t\tif (getProviderResult.isErr())\n\t\t\t\treturn Err({ message: getProviderResult.unwrapErr(), repo });\n\n\t\t\tconst providerState = getProviderResult.unwrap();\n\n\t\t\tresolvedPaths.push(providerState);\n\t\t})\n\t);\n\n\tconst err = errors.find((err) => err !== undefined);\n\n\tif (err) return err;\n\n\treturn Ok(resolvedPaths);\n}\n\n/** Fetches blocks for each registry and stores them in a map by their repo as well as category and block name.\n *\n * Example Key:\n * `github/ieedan/std/utils/math`\n *\n * @param repos\n * @returns\n */\nexport async function fetchBlocks(\n\trepos: RegistryProviderState[],\n\t{ verbose }: { verbose?: (msg: string) => void } = {}\n): Promise<Result<Map<string, RemoteBlock>, { message: string; repo: string }>> {\n\tconst blocksMap = new Map<string, RemoteBlock>();\n\n\tconst errors = await Promise.all(\n\t\trepos.map(async (state) => {\n\t\t\tconst getManifestResult = await internalFetchManifest(state, { verbose });\n\n\t\t\tif (getManifestResult.isErr()) {\n\t\t\t\treturn Err({ message: getManifestResult.unwrapErr(), repo: state.url });\n\t\t\t}\n\n\t\t\tconst manifest = getManifestResult.unwrap();\n\n\t\t\tfor (const category of manifest.categories) {\n\t\t\t\tfor (const block of category.blocks) {\n\t\t\t\t\tblocksMap.set(u.join(state.url, `${block.category}/${block.name}`), {\n\t\t\t\t\t\t...block,\n\t\t\t\t\t\tsourceRepo: state,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t);\n\n\tconst err = errors.find((err) => err !== undefined);\n\n\tif (err) return err;\n\n\treturn Ok(blocksMap);\n}\n\n/** Maps the result of fetchManifests into a map of remote blocks\n *\n * @param manifests\n */\nexport function getRemoteBlocks(manifests: FetchManifestResult[]) {\n\tconst blocksMap = new Map<string, RemoteBlock>();\n\n\tfor (const manifest of manifests) {\n\t\tfor (const category of manifest.manifest.categories) {\n\t\t\tfor (const block of category.blocks) {\n\t\t\t\tblocksMap.set(u.join(manifest.state.url, `${block.category}/${block.name}`), {\n\t\t\t\t\t...block,\n\t\t\t\t\tsourceRepo: manifest.state,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn blocksMap;\n}\n\nexport type FetchManifestResult = {\n\tstate: RegistryProviderState;\n\tmanifest: Manifest;\n};\n\n/** Fetches the manifests for each provider\n *\n * @param repos\n * @returns\n */\nexport async function fetchManifests(\n\trepos: RegistryProviderState[],\n\t{ verbose }: { verbose?: (msg: string) => void } = {}\n): Promise<Result<FetchManifestResult[], { message: string; repo: string }>> {\n\tconst manifests: FetchManifestResult[] = [];\n\n\tconst errors = await Promise.all(\n\t\trepos.map(async (state) => {\n\t\t\tconst getManifestResult = await internalFetchManifest(state, { verbose });\n\n\t\t\tif (getManifestResult.isErr()) {\n\t\t\t\treturn Err({ message: getManifestResult.unwrapErr(), repo: state.url });\n\t\t\t}\n\n\t\t\tconst manifest = getManifestResult.unwrap();\n\n\t\t\tmanifests.push({ state, manifest });\n\t\t})\n\t);\n\n\tconst err = errors.find((err) => err !== undefined);\n\n\tif (err) return err;\n\n\treturn Ok(manifests);\n}\n\nexport * from './types';\n\nexport {\n\tazure,\n\tbitbucket,\n\tgithub,\n\tgitlab,\n\thttp,\n\tjsrepo,\n\tproviders,\n\tinternalFetchManifest as fetchManifest,\n\tinternalFetchRaw as fetchRaw,\n\tselectProvider,\n};\n","import fs from 'node:fs';\nimport color from 'chalk';\nimport { program } from 'commander';\nimport path from 'pathe';\nimport type { Block } from '../types';\nimport * as array from './blocks/ts/array';\nimport { Err, Ok, type Result } from './blocks/ts/result';\nimport * as url from './blocks/ts/url';\nimport { isDocsFile, isTestFile } from './build';\nimport { type Paths, type ProjectConfig, getPathForBlock, resolvePaths } from './config';\nimport * as registry from './registry-providers/internal';\n\nexport async function resolveTree(\n\tblockSpecifiers: string[],\n\tblocksMap: Map<string, registry.RemoteBlock>,\n\trepoPaths: registry.RegistryProviderState[],\n\tinstalled: Map<string, registry.RemoteBlock> = new Map()\n): Promise<Result<registry.RemoteBlock[], string>> {\n\tconst blocks = new Map<string, registry.RemoteBlock>();\n\n\tfor (const blockSpecifier of blockSpecifiers) {\n\t\tlet block: registry.RemoteBlock | undefined = undefined;\n\n\t\tconst provider = registry.selectProvider(blockSpecifier);\n\n\t\t// if the block starts with github (or another provider) we know it has been resolved\n\t\tif (!provider) {\n\t\t\tif (repoPaths.length === 0) {\n\t\t\t\treturn Err(\n\t\t\t\t\tcolor.red(\n\t\t\t\t\t\t`If your config doesn't contain repos then you must provide the repo in the block specifier ex: \\`${color.bold(\n\t\t\t\t\t\t\t`github/ieedan/std/${blockSpecifier}`\n\t\t\t\t\t\t)}\\`!`\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// check every repo for the block and return the first block found\n\t\t\tfor (const providerState of repoPaths) {\n\t\t\t\tconst { url: repoIdent, specifier } = providerState.provider.parse(\n\t\t\t\t\turl.join(providerState.url, blockSpecifier),\n\t\t\t\t\t{ fullyQualified: true }\n\t\t\t\t);\n\n\t\t\t\tconst tempBlock = blocksMap.get(url.join(repoIdent, specifier!));\n\n\t\t\t\tif (tempBlock === undefined) continue;\n\n\t\t\t\tblock = tempBlock;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\t// get shortened name\n\t\t\tconst { url: repoIdent, specifier } = provider.parse(blockSpecifier, {\n\t\t\t\tfullyQualified: true,\n\t\t\t});\n\n\t\t\t// just beautifies name a bit\n\t\t\tblock = blocksMap.get(url.join(repoIdent, specifier!));\n\t\t}\n\n\t\tif (!block) {\n\t\t\treturn Err(`Invalid block! ${color.bold(blockSpecifier)} does not exist!`);\n\t\t}\n\n\t\tconst specifier = `${block.category}/${block.name}`;\n\n\t\tblocks.set(specifier, block);\n\n\t\tif (block.localDependencies && block.localDependencies.length > 0) {\n\t\t\tconst subDeps = await resolveTree(\n\t\t\t\tblock.localDependencies.filter((dep) => !blocks.has(dep) && !installed.has(dep)),\n\t\t\t\tblocksMap,\n\t\t\t\trepoPaths,\n\t\t\t\tblocks\n\t\t\t);\n\n\t\t\tif (subDeps.isErr()) return Err(subDeps.unwrapErr());\n\n\t\t\tfor (const dep of subDeps.unwrap()) {\n\t\t\t\tblocks.set(`${dep.category}/${dep.name}`, dep);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Ok(array.fromMap(blocks, (_, val) => val));\n}\n\ntype InstalledBlock = {\n\tspecifier: `${string}/${string}`;\n\tpath: string;\n\tblock: Block;\n};\n\n/** Finds installed blocks and returns them as `<category>/<name>`\n *\n * @param blocks\n * @param config\n * @returns\n */\nexport function getInstalled(\n\tblocks: Map<string, Block>,\n\tconfig: ProjectConfig,\n\tcwd: string\n): InstalledBlock[] {\n\tconst installedBlocks: InstalledBlock[] = [];\n\n\tconst resolvedPaths = resolvePaths(config.paths, cwd).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tfor (const [_, block] of blocks) {\n\t\tconst baseDir = getPathForBlock(block, resolvedPaths, cwd);\n\n\t\tlet blockPath = path.join(baseDir, block.files[0]);\n\t\tif (block.subdirectory) {\n\t\t\tblockPath = path.join(baseDir, block.name);\n\t\t}\n\n\t\tif (fs.existsSync(blockPath))\n\t\t\tinstalledBlocks.push({\n\t\t\t\tspecifier: `${block.category}/${block.name}`,\n\t\t\t\tpath: blockPath,\n\t\t\t\tblock,\n\t\t\t});\n\t}\n\n\treturn installedBlocks;\n}\n\nexport type RegistryFile = {\n\tname: string;\n\tcontent: Result<string, string>;\n};\n\ntype PreloadedBlock = {\n\tblock: registry.RemoteBlock;\n\tfiles: Promise<RegistryFile[]>;\n};\n\n/** Starts loading the content of the files for each block and\n * returns the blocks mapped to a promise that contains their files and their contents.\n *\n * @param blocks\n * @returns\n */\nexport function preloadBlocks(\n\tblocks: registry.RemoteBlock[],\n\tconfig: Pick<ProjectConfig, 'includeTests' | 'includeDocs'>\n): PreloadedBlock[] {\n\tconst preloaded: PreloadedBlock[] = [];\n\n\tfor (const block of blocks) {\n\t\t// filters out test/docs files if they are not supposed to be included\n\t\tconst includedFiles = block.files.filter((file) => {\n\t\t\tif (isTestFile(file) && !config.includeTests) return false;\n\n\t\t\tif (isDocsFile(file) && !config.includeDocs) return false;\n\n\t\t\treturn true;\n\t\t});\n\n\t\tconst files = Promise.all(\n\t\t\tincludedFiles.map(async (file) => {\n\t\t\t\tconst content = await registry.fetchRaw(\n\t\t\t\t\tblock.sourceRepo,\n\t\t\t\t\tpath.join(block.directory, file)\n\t\t\t\t);\n\n\t\t\t\treturn { name: file, content };\n\t\t\t})\n\t\t);\n\n\t\tpreloaded.push({\n\t\t\tblock,\n\t\t\tfiles,\n\t\t});\n\t}\n\n\treturn preloaded;\n}\n\n/** Gets the path for the file belonging to the provided block\n *\n * @param fileName\n * @param block\n * @param resolvedPaths\n * @param cwd\n * @returns\n */\nexport function getBlockFilePath(\n\tfileName: string,\n\tblock: registry.RemoteBlock,\n\tresolvedPaths: Paths,\n\tcwd: string\n) {\n\tconst directory = getPathForBlock(block, resolvedPaths, cwd);\n\n\tif (block.subdirectory) {\n\t\treturn path.join(directory, block.name, fileName);\n\t}\n\n\treturn path.join(directory, fileName);\n}\n","import { InvalidArgumentError } from 'commander';\n\n/** Handles `--x foo=bar,bar=foo`\n *\n * @param value\n * @returns\n */\nexport function parseRecord(value: string | undefined): Record<string, string> | undefined {\n\tif (value === undefined) return undefined;\n\n\tconst result: Record<string, string> = {};\n\n\tfor (const pair of value.split(',')) {\n\t\tconst [key, value] = pair.split('=');\n\n\t\tif (key === undefined || value === undefined) {\n\t\t\tthrow new InvalidArgumentError(\n\t\t\t\t'Expected map to be provided in the following format: `--option key=value,key=value`'\n\t\t\t);\n\t\t}\n\n\t\tresult[key] = value;\n\t}\n\n\treturn result;\n}\n","/*\n\tInstalled from github/ieedan/std\n*/\n\n/** Returns a promise that immediately resolves to `T`, useful when you need to mix sync and async code.\n *\n * @param val\n *\n * ### Usage\n * ```ts\n * const promises: Promise<number>[] = [];\n *\n * promises.push(immediate(10));\n * ```\n */\nexport function immediate<T>(val: T): Promise<T> {\n\treturn new Promise<T>((res) => res(val));\n}\n","import fs from 'node:fs';\nimport type { PartialConfiguration } from '@biomejs/wasm-nodejs';\nimport path from 'pathe';\nimport * as prettier from 'prettier';\nimport type { Formatter } from './config';\n\nexport type FormatterConfig = {\n\tprettierOptions: prettier.Options | null;\n\tbiomeOptions: PartialConfiguration | null;\n};\n\nexport async function loadFormatterConfig({\n\tformatter,\n\tcwd,\n}: { formatter?: Formatter; cwd: string }): Promise<FormatterConfig> {\n\tlet prettierOptions: prettier.Options | null = null;\n\tif (formatter === 'prettier') {\n\t\tprettierOptions = await prettier.resolveConfig(path.join(cwd, '.prettierrc'));\n\t}\n\n\tlet biomeOptions: PartialConfiguration | null = null;\n\tif (formatter === 'biome') {\n\t\tconst configPath = path.join(cwd, 'biome.json');\n\t\tif (fs.existsSync(configPath)) {\n\t\t\tbiomeOptions = JSON.parse(fs.readFileSync(configPath).toString());\n\t\t}\n\t}\n\n\treturn {\n\t\tbiomeOptions,\n\t\tprettierOptions,\n\t};\n}\n","export function getWatermark(repoUrl: string): string {\n\treturn `Installed from ${repoUrl}`;\n}\n","import color from 'chalk';\nimport { program } from 'commander';\nimport path from 'pathe';\nimport semver from 'semver';\nimport type { Manifest } from '../types';\nimport * as ASCII from './ascii';\nimport { cleanVersion, getPackage } from './package';\nimport type { RegistryProviderState } from './registry-providers';\n\n/** Checks if there are any reasons that the CLI should not proceed and logs warnings or stops execution accordingly.\n *\n * @param providerState\n * @param manifest\n * @returns\n */\nexport function checkPreconditions(\n\tproviderState: RegistryProviderState,\n\tmanifest: Manifest,\n\tcwd: string\n) {\n\tif (!manifest.peerDependencies) return;\n\n\tconst pkg = getPackage(path.join(cwd, 'package.json')).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tif (err.endsWith(\"doesn't exist\")) {\n\t\t\t\tprogram.error(\n\t\t\t\t\t`Couldn't find your ${color.bold('package.json')}. Please create one.`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tprogram.error(color.red(err));\n\t\t}\n\t);\n\n\tconst dependencies = { ...pkg.dependencies, ...pkg.devDependencies };\n\n\tconst incompatible: {\n\t\tname: string;\n\t\tversion: string;\n\t\texists: boolean;\n\t\texpected: string;\n\t\tmessage?: string;\n\t}[] = [];\n\n\tfor (const [name, options] of Object.entries(manifest.peerDependencies)) {\n\t\tlet expected: string;\n\t\tlet message: string | undefined = undefined;\n\n\t\tif (typeof options === 'string') {\n\t\t\texpected = options;\n\t\t} else {\n\t\t\texpected = options.version;\n\t\t\tmessage = options.message;\n\t\t}\n\n\t\tconst version = dependencies[name];\n\n\t\tif (!version) {\n\t\t\tincompatible.push({\n\t\t\t\tname,\n\t\t\t\texpected,\n\t\t\t\tmessage,\n\t\t\t\tversion,\n\t\t\t\texists: false,\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!semver.satisfies(cleanVersion(version), expected)) {\n\t\t\tincompatible.push({\n\t\t\t\tname,\n\t\t\t\texpected,\n\t\t\t\tmessage,\n\t\t\t\tversion,\n\t\t\t\texists: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tif (incompatible.length > 0) {\n\t\tprocess.stdout.write(\n\t\t\t`${ASCII.VERTICAL_LINE}\\n${color.yellow('')} ${ASCII.JUNCTION_TOP} Issues with ${color.bold(providerState.url)} peer dependencies\\n`\n\t\t);\n\t\tconst msgs = incompatible\n\t\t\t.map((dep, i) => {\n\t\t\t\tconst last = incompatible.length - 1 === i;\n\n\t\t\t\tlet message: string;\n\n\t\t\t\tif (dep.exists) {\n\t\t\t\t\tmessage = `${color.yellowBright('x unmet peer')} need ${color.bold(`${dep.name}@`)}${color.greenBright.bold(dep.expected)} >> found ${color.yellowBright.bold(dep.version)}`;\n\t\t\t\t} else {\n\t\t\t\t\tmessage = `${color.red('x missing peer')} need ${color.bold(`${dep.name}@`)}${color.greenBright.bold(dep.expected)}`;\n\t\t\t\t}\n\n\t\t\t\tconst versionMessage = `${ASCII.VERTICAL_LINE} ${last ? ASCII.BOTTOM_LEFT_CORNER : ASCII.JUNCTION_RIGHT}${ASCII.HORIZONTAL_LINE} ${message}`;\n\n\t\t\t\tif (!dep.message) {\n\t\t\t\t\treturn versionMessage;\n\t\t\t\t}\n\n\t\t\t\treturn `${versionMessage}\\n${ASCII.VERTICAL_LINE} ${!last ? ASCII.VERTICAL_LINE : ''}  ${color.gray(dep.message)}`;\n\t\t\t})\n\t\t\t.join('\\n');\n\n\t\tprocess.stdout.write(`${msgs}\\n`);\n\t}\n}\n","import fs from 'node:fs';\nimport { cancel, confirm, isCancel, log, multiselect, outro, select, text } from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, Option, program } from 'commander';\nimport { resolveCommand } from 'package-manager-detector/commands';\nimport { detect } from 'package-manager-detector/detect';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport * as ascii from '../utils/ascii';\nimport { getBlockFilePath, getInstalled, preloadBlocks, resolveTree } from '../utils/blocks';\nimport { parseRecord } from '../utils/blocks/commander/parsers';\nimport * as promises from '../utils/blocks/ts/promises';\nimport * as url from '../utils/blocks/ts/url';\nimport {\n\ttype Formatter,\n\ttype ProjectConfig,\n\tgetProjectConfig,\n\tprojectConfigSchema,\n\tresolvePaths,\n} from '../utils/config';\nimport { transformRemoteContent } from '../utils/files';\nimport { loadFormatterConfig } from '../utils/format';\nimport { getWatermark } from '../utils/get-watermark';\nimport * as persisted from '../utils/persisted';\nimport { checkPreconditions } from '../utils/preconditions';\nimport {\n\tintro,\n\tnextSteps,\n\tpromptInstallDependencies,\n\tpromptUpdateFile,\n\tspinner,\n\ttruncatedList,\n} from '../utils/prompts';\nimport * as registry from '../utils/registry-providers/internal';\n\nconst schema = v.object({\n\twatermark: v.optional(v.boolean()),\n\ttests: v.optional(v.boolean()),\n\tdocs: v.optional(v.boolean()),\n\tformatter: v.optional(v.union([v.literal('prettier'), v.literal('biome'), v.literal('none')])),\n\tpaths: v.optional(v.record(v.string(), v.string())),\n\texpand: v.boolean(),\n\tmaxUnchanged: v.number(),\n\trepo: v.optional(v.string()),\n\tallow: v.boolean(),\n\tyes: v.boolean(),\n\tcache: v.boolean(),\n\tverbose: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nexport const add = new Command('add')\n\t.description('Add blocks to your project.')\n\t.argument(\n\t\t'[blocks...]',\n\t\t'Names of the blocks you want to add to your project. ex: (utils/math, github/ieedan/std/utils/math)'\n\t)\n\t.addOption(\n\t\tnew Option('--formatter <choice>', 'The formatter to use when adding blocks.').choices([\n\t\t\t'prettier',\n\t\t\t'biome',\n\t\t\t'none',\n\t\t])\n\t)\n\t.addOption(\n\t\tnew Option('--watermark <choice>', 'Include a watermark at the top of added files.')\n\t\t\t.choices(['true', 'false'])\n\t\t\t.argParser((val) => val === 'true')\n\t)\n\t.addOption(\n\t\tnew Option('--tests <choice>', 'Include tests when adding blocks.')\n\t\t\t.choices(['true', 'false'])\n\t\t\t.argParser((val) => val === 'true')\n\t)\n\t.addOption(\n\t\tnew Option('--docs <choice>', 'Include docs when adding blocks.')\n\t\t\t.choices(['true', 'false'])\n\t\t\t.argParser((val) => val === 'true')\n\t)\n\t.option(\n\t\t'--paths <category=path,category=path>',\n\t\t'The paths where categories should be added to your project.',\n\t\tparseRecord,\n\t\tundefined\n\t)\n\t.option('-E, --expand', 'Expands the diff so you see the entire file.', false)\n\t.option(\n\t\t'--max-unchanged <number>',\n\t\t'Maximum unchanged lines that will show without being collapsed.',\n\t\t(val) => Number.parseInt(val), // this is such a dumb api thing\n\t\t3\n\t)\n\t.option('--repo <repo>', 'Repository to download the blocks from.')\n\t.option('-A, --allow', 'Allow jsrepo to download code from the provided repo.', false)\n\t.option('-y, --yes', 'Skip confirmation prompt.', false)\n\t.option('--no-cache', 'Disable caching of resolved git urls.')\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (blockNames, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _add(blockNames, options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _add(blockNames: string[], options: Options) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tverbose(`Attempting to add ${JSON.stringify(blockNames)}`);\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tconst configResult = getProjectConfig(options.cwd);\n\n\t/** The user has opted for no config */\n\tconst noConfig = configResult.isErr();\n\n\tlet config: ProjectConfig;\n\n\tif (configResult.isErr()) {\n\t\tlet shouldContinue = options.yes;\n\n\t\tif (!options.yes) {\n\t\t\tconst response = await confirm({\n\t\t\t\tmessage: `You don't have ${ascii.JSREPO} initialized in your project. Do you want to continue?`,\n\t\t\t\tinitialValue: false,\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tshouldContinue = response;\n\t\t}\n\n\t\tif (!shouldContinue) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\t// add default config used for default values in prompts\n\t\tconfig = {\n\t\t\t$schema: '',\n\t\t\tincludeTests: false,\n\t\t\tincludeDocs: false,\n\t\t\twatermark: true,\n\t\t\tpaths: {\n\t\t\t\t'*': './src/blocks',\n\t\t\t},\n\t\t\trepos: [],\n\t\t};\n\t} else {\n\t\tconfig = configResult.unwrap();\n\t}\n\n\tconfig.formatter =\n\t\toptions.formatter !== undefined && options.formatter !== 'none'\n\t\t\t? options.formatter\n\t\t\t: config.formatter;\n\tconfig.watermark = options.watermark !== undefined ? options.watermark : config.watermark;\n\tconfig.includeTests = options.tests !== undefined ? options.tests : config.includeTests;\n\tconfig.includeDocs = options.docs !== undefined ? options.docs : config.includeDocs;\n\tconfig.paths =\n\t\toptions.paths !== undefined ? { ...config.paths, ...options.paths } : config.paths;\n\n\tlet repoPaths = config.repos;\n\tconst mustResolveRepos = new Set<string>();\n\tlet resolveAllRepos = false;\n\n\t// we just want to override all others if supplied via the CLI\n\tif (options.repo) {\n\t\trepoPaths = [options.repo];\n\t}\n\n\t// resolve repos for blocks\n\tfor (const blockSpecifier of blockNames) {\n\t\tconst provider = registry.selectProvider(blockSpecifier);\n\n\t\t// we are only getting repos for blocks that specified repos\n\t\tif (!provider) {\n\t\t\t// if a block doesn't specify a repo we must resolve all\n\t\t\tresolveAllRepos = true;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst { url: repo } = provider.parse(blockSpecifier, { fullyQualified: true });\n\n\t\tconst alreadyExists =\n\t\t\t!config.repos.find((repoPath) => repoPath === repo) && !mustResolveRepos.has(repo);\n\n\t\tif (!alreadyExists) {\n\t\t\tif (!options.allow) {\n\t\t\t\tconst result = await confirm({\n\t\t\t\t\tmessage: `Allow ${ascii.JSREPO} to download and run code from ${color.cyan(repo)}?`,\n\t\t\t\t\tinitialValue: true,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(result) || !result) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// only add if it doesn't exist\n\t\t\trepoPaths.push(repo);\n\t\t}\n\n\t\t// this way we add the config.repos as well\n\t\tmustResolveRepos.add(repo);\n\t}\n\n\tif (!resolveAllRepos && blockNames.length > 0) {\n\t\trepoPaths = Array.from(mustResolveRepos);\n\t}\n\n\tif (!options.allow && options.repo) {\n\t\tconst result = await confirm({\n\t\t\tmessage: `Allow ${ascii.JSREPO} to download and run code from ${color.cyan(options.repo)}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\t}\n\n\tif (repoPaths.length === 0) {\n\t\tif (noConfig) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`Fully quality blocks ex: (github/ieedan/std/utils/math) or provide the \\`${color.bold(\n\t\t\t\t\t\t'--repo'\n\t\t\t\t\t)}\\` flag to specify a registry.`\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`There were no repos present in your config and you didn't provide the \\`${color.bold(\n\t\t\t\t\t'--repo'\n\t\t\t\t)}\\` flag with a repo.`\n\t\t\t)\n\t\t);\n\t}\n\n\tverbose(`Resolving ${color.cyan(repoPaths.join(', '))}`);\n\n\tif (!options.verbose) loading.start(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst resolvedRepos: registry.RegistryProviderState[] = (\n\t\tawait registry.forEachPathGetProviderState(repoPaths, { noCache: !options.cache })\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed to get info for ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tverbose(`Resolved ${color.cyan(repoPaths.join(', '))}`);\n\n\tverbose(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst manifests = (\n\t\tawait registry.fetchManifests(resolvedRepos, {\n\t\t\tverbose: options.verbose ? verbose : undefined,\n\t\t})\n\t).match(\n\t\t(v) => v,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed fetching blocks from ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tconst blocksMap = registry.getRemoteBlocks(manifests);\n\n\tif (!options.verbose) loading.stop(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tverbose(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tfor (const manifest of manifests) {\n\t\tcheckPreconditions(manifest.state, manifest.manifest, options.cwd);\n\t}\n\n\tlet installedBlocks = getInstalled(blocksMap, config, options.cwd).map((val) => val.specifier);\n\n\tlet installingBlockNames = blockNames;\n\n\t// if no blocks are provided prompt the user for what blocks they want\n\tif (installingBlockNames.length === 0) {\n\t\tconst promptResult = await multiselect({\n\t\t\tmessage: 'Select which blocks to add.',\n\t\t\toptions: Array.from(blocksMap.entries())\n\t\t\t\t.filter(([_, value]) => value.list)\n\t\t\t\t.map(([key, value]) => {\n\t\t\t\t\tconst shortName = `${value.category}/${value.name}`;\n\n\t\t\t\t\tconst blockExists =\n\t\t\t\t\t\tinstalledBlocks.findIndex((block) => block === shortName) !== -1;\n\n\t\t\t\t\tlet label: string;\n\n\t\t\t\t\t// show the full repo if there are multiple repos\n\t\t\t\t\tif (repoPaths.length > 1) {\n\t\t\t\t\t\tlabel = `${color.cyan(url.join(value.sourceRepo.url, value.category))}/${value.name}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlabel = `${color.cyan(value.category)}/${value.name}`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: blockExists ? color.gray(label) : label,\n\t\t\t\t\t\tvalue: key,\n\t\t\t\t\t\t// show hint for `Installed` if block is already installed\n\t\t\t\t\t\thint: blockExists ? 'Installed' : undefined,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\trequired: true,\n\t\t});\n\n\t\tif (isCancel(promptResult)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tinstallingBlockNames = promptResult as string[];\n\t}\n\n\tverbose(`Installing blocks ${color.cyan(installingBlockNames.join(', '))}`);\n\n\tconst installingBlocks = (\n\t\tawait resolveTree(installingBlockNames, blocksMap, resolvedRepos)\n\t).match(\n\t\t(val) => val,\n\t\t(err) => program.error(err)\n\t);\n\n\tconst devDeps: Set<string> = new Set<string>();\n\tconst deps: Set<string> = new Set<string>();\n\n\tconst store = persisted.get();\n\n\tif (noConfig) {\n\t\tconst zeroConfigKey = `${options.cwd}-zero-config`;\n\n\t\tconst zeroConfigParsed = v.safeParse(projectConfigSchema, store.get(zeroConfigKey));\n\n\t\tconst zeroConfig = zeroConfigParsed.success ? zeroConfigParsed.output : config;\n\n\t\tconst categories = Array.from(new Set(installingBlocks.map((b) => b.category)));\n\n\t\tif (options.paths === undefined) {\n\t\t\tfor (const cat of categories) {\n\t\t\t\tconst blocksPath = await text({\n\t\t\t\t\tmessage: `Where would you like to add ${color.cyan(cat)}?`,\n\t\t\t\t\tplaceholder: zeroConfig ? zeroConfig.paths[cat] : `./src/${cat}`,\n\t\t\t\t\tinitialValue: zeroConfig ? zeroConfig.paths[cat] : `./src/${cat}`,\n\t\t\t\t\tdefaultValue: zeroConfig ? zeroConfig.paths[cat] : `./src/${cat}`,\n\t\t\t\t\tvalidate(value) {\n\t\t\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(blocksPath)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tconfig.paths[cat] = blocksPath;\n\t\t\t}\n\t\t}\n\n\t\tif (!options.yes && options.tests === undefined) {\n\t\t\tconst includeTests = await confirm({\n\t\t\t\tmessage: 'Include tests?',\n\t\t\t\tinitialValue: zeroConfig.includeTests,\n\t\t\t});\n\n\t\t\tif (isCancel(includeTests)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tconfig.includeTests = includeTests;\n\t\t}\n\n\t\tif (!options.yes && options.watermark === undefined) {\n\t\t\tconst addWatermark = await confirm({\n\t\t\t\tmessage: 'Add watermark?',\n\t\t\t\tinitialValue: zeroConfig.watermark,\n\t\t\t});\n\n\t\t\tif (isCancel(addWatermark)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tconfig.watermark = addWatermark;\n\t\t}\n\n\t\tif (options.formatter === undefined) {\n\t\t\tlet defaultFormatter = 'none';\n\n\t\t\tif (fs.existsSync(path.join(options.cwd, '.prettierrc'))) {\n\t\t\t\tdefaultFormatter = 'prettier';\n\t\t\t}\n\n\t\t\tif (fs.existsSync(path.join(options.cwd, 'biome.json'))) {\n\t\t\t\tdefaultFormatter = 'biome';\n\t\t\t}\n\n\t\t\tconst response = await select({\n\t\t\t\tmessage: 'What formatter would you like to use?',\n\t\t\t\toptions: ['Prettier', 'Biome', 'None'].map((val) => ({\n\t\t\t\t\tvalue: val.toLowerCase(),\n\t\t\t\t\tlabel: val,\n\t\t\t\t})),\n\t\t\t\tinitialValue:\n\t\t\t\t\tdefaultFormatter === 'none'\n\t\t\t\t\t\t? zeroConfig.formatter\n\t\t\t\t\t\t\t? zeroConfig.formatter\n\t\t\t\t\t\t\t: 'none'\n\t\t\t\t\t\t: defaultFormatter,\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tif (response !== 'none') {\n\t\t\t\tconfig.formatter = response as Formatter;\n\t\t\t}\n\t\t}\n\n\t\tstore.set(zeroConfigKey, config);\n\n\t\t// re-run to get installed blocks at the provided path\n\t\tinstalledBlocks = getInstalled(blocksMap, config, options.cwd).map((val) => val.specifier);\n\t}\n\n\tconst { prettierOptions, biomeOptions } = await loadFormatterConfig({\n\t\tformatter: config.formatter,\n\t\tcwd: options.cwd,\n\t});\n\n\tconst resolvedPaths = resolvePaths(config.paths, options.cwd).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tconst updatedBlocks = new Set<string>();\n\n\tlet overwriteAll: boolean | undefined;\n\n\tconst preloadedBlocks = preloadBlocks(installingBlocks, config);\n\n\tconst updatedFiles: Promise<{\n\t\tdestination: string;\n\t\tcontent: string;\n\t\tblock: registry.RemoteBlock;\n\t}>[] = [];\n\n\tfor (const preloadedBlock of preloadedBlocks) {\n\t\tconst fullSpecifier = url.join(\n\t\t\tpreloadedBlock.block.sourceRepo.url,\n\t\t\tpreloadedBlock.block.category,\n\t\t\tpreloadedBlock.block.name\n\t\t);\n\t\tconst shortSpecifier = `${preloadedBlock.block.category}/${preloadedBlock.block.name}`;\n\n\t\tverbose(`Setting up ${fullSpecifier}`);\n\n\t\tconst blockExists = installedBlocks.find((b) => shortSpecifier === b);\n\n\t\tif (config.includeTests && preloadedBlock.block.tests) {\n\t\t\tverbose('Trying to include tests');\n\n\t\t\tdevDeps.add('vitest');\n\t\t}\n\n\t\tfor (const dep of preloadedBlock.block.devDependencies) {\n\t\t\tdevDeps.add(dep);\n\t\t}\n\n\t\tfor (const dep of preloadedBlock.block.dependencies) {\n\t\t\tdeps.add(dep);\n\t\t}\n\n\t\tif (blockExists && !options.yes && !overwriteAll) {\n\t\t\tif (overwriteAll === undefined) {\n\t\t\t\tconst overwriteBlocks = installingBlocks\n\t\t\t\t\t.map((installing) => `${installing.category}/${installing.name}`)\n\t\t\t\t\t.filter((spec) => installedBlocks.find((b) => b === spec));\n\n\t\t\t\tlog.warn(\n\t\t\t\t\t`The following components ${color.bold.yellow('already exist')}: ${color.cyan(truncatedList(overwriteBlocks))}`\n\t\t\t\t);\n\n\t\t\t\tconst overwrite = await confirm({\n\t\t\t\t\tmessage: `Would you like to ${color.bold.red('overwrite')} all existing components?`,\n\t\t\t\t\tactive: 'Yes, overwrite everything',\n\t\t\t\t\tinactive: 'No, let me decide individually',\n\t\t\t\t\tinitialValue: false,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(overwrite)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\toverwriteAll = overwrite;\n\t\t\t}\n\n\t\t\tif (!overwriteAll) {\n\t\t\t\tconst files = await preloadedBlock.files;\n\n\t\t\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}\\n`);\n\n\t\t\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}  ${fullSpecifier}\\n`);\n\n\t\t\t\tfor (const file of files) {\n\t\t\t\t\tconst content = file.content.match(\n\t\t\t\t\t\t(v) => v,\n\t\t\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t\t\t);\n\n\t\t\t\t\tconst destPath = getBlockFilePath(\n\t\t\t\t\t\tfile.name,\n\t\t\t\t\t\tpreloadedBlock.block,\n\t\t\t\t\t\tresolvedPaths,\n\t\t\t\t\t\toptions.cwd\n\t\t\t\t\t);\n\n\t\t\t\t\tconst remoteContent = (\n\t\t\t\t\t\tawait transformRemoteContent({\n\t\t\t\t\t\t\tfile: {\n\t\t\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\t\t\tdestPath: destPath,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbiomeOptions,\n\t\t\t\t\t\t\tprettierOptions,\n\t\t\t\t\t\t\tconfig,\n\t\t\t\t\t\t\timports: preloadedBlock.block._imports_,\n\t\t\t\t\t\t\twatermark: getWatermark(preloadedBlock.block.sourceRepo.url),\n\t\t\t\t\t\t\tverbose,\n\t\t\t\t\t\t\tcwd: options.cwd,\n\t\t\t\t\t\t})\n\t\t\t\t\t).match(\n\t\t\t\t\t\t(v) => v,\n\t\t\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t\t\t);\n\n\t\t\t\t\tlet localContent = '';\n\t\t\t\t\tif (fs.existsSync(destPath)) {\n\t\t\t\t\t\tlocalContent = fs.readFileSync(destPath).toString();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst updateResult = await promptUpdateFile({\n\t\t\t\t\t\tconfig: { biomeOptions, prettierOptions, formatter: config.formatter },\n\t\t\t\t\t\tcurrent: {\n\t\t\t\t\t\t\tpath: destPath,\n\t\t\t\t\t\t\tcontent: localContent,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tincoming: {\n\t\t\t\t\t\t\tpath: url.join(fullSpecifier, file.name),\n\t\t\t\t\t\t\tcontent: remoteContent,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t...options,\n\t\t\t\t\t\t\tloading,\n\t\t\t\t\t\t\tno: false,\n\t\t\t\t\t\t\tverbose: options.verbose ? verbose : undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (updateResult.applyChanges) {\n\t\t\t\t\t\tupdatedFiles.push(\n\t\t\t\t\t\t\tpromises.immediate({\n\t\t\t\t\t\t\t\tdestination: destPath,\n\t\t\t\t\t\t\t\tcontent: updateResult.updatedContent,\n\t\t\t\t\t\t\t\tblock: preloadedBlock.block,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tupdatedBlocks.add(shortSpecifier);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// once files load map over them and add them to updatedFiles\n\t\tpreloadedBlock.files.then((files) => {\n\t\t\tfiles.map(async (file) => {\n\t\t\t\tconst content = file.content.match(\n\t\t\t\t\t(v) => v,\n\t\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t\t);\n\n\t\t\t\tconst destPath = getBlockFilePath(\n\t\t\t\t\tfile.name,\n\t\t\t\t\tpreloadedBlock.block,\n\t\t\t\t\tresolvedPaths,\n\t\t\t\t\toptions.cwd\n\t\t\t\t);\n\n\t\t\t\tconst updatedFile = transformRemoteContent({\n\t\t\t\t\tfile: {\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\tdestPath: destPath,\n\t\t\t\t\t},\n\t\t\t\t\tbiomeOptions,\n\t\t\t\t\tprettierOptions,\n\t\t\t\t\tconfig,\n\t\t\t\t\timports: preloadedBlock.block._imports_,\n\t\t\t\t\twatermark: getWatermark(preloadedBlock.block.sourceRepo.url),\n\t\t\t\t\tverbose,\n\t\t\t\t\tcwd: options.cwd,\n\t\t\t\t}).then((remoteContent) => {\n\t\t\t\t\tif (remoteContent.isErr()) {\n\t\t\t\t\t\tprogram.error(color.red(remoteContent.unwrapErr()));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdestination: destPath,\n\t\t\t\t\t\tcontent: remoteContent.unwrap(),\n\t\t\t\t\t\tblock: preloadedBlock.block,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tupdatedFiles.push(updatedFile);\n\t\t\t});\n\t\t});\n\n\t\tupdatedBlocks.add(shortSpecifier);\n\t}\n\n\tif (updatedBlocks.size === 0) {\n\t\tlog.success('Nothing to update');\n\t} else {\n\t\tloading.start('Adding blocks');\n\n\t\t// wait for any remaining files to finish loading\n\t\tawait Promise.all(preloadedBlocks.map((p) => p.files));\n\n\t\tawait Promise.all(\n\t\t\tupdatedFiles.map(async (updatedFile) => {\n\t\t\t\tconst file = await updatedFile;\n\n\t\t\t\tconst folder = path.dirname(file.destination);\n\n\t\t\t\tif (!fs.existsSync(folder)) {\n\t\t\t\t\tverbose(`Creating directory ${color.bold(folder)}`);\n\n\t\t\t\t\tfs.mkdirSync(folder, {\n\t\t\t\t\t\trecursive: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tverbose(`Writing to ${color.bold(file.destination)}`);\n\n\t\t\t\tfs.writeFileSync(file.destination, file.content);\n\t\t\t})\n\t\t);\n\n\t\tloading.stop(`Added blocks ${color.cyan(Array.from(updatedBlocks).join(', '))}`);\n\t}\n\n\tconst pm = (await detect({ cwd: options.cwd }))?.agent ?? 'npm';\n\n\tconst installResult = await promptInstallDependencies(deps, devDeps, {\n\t\tyes: options.yes,\n\t\tcwd: options.cwd,\n\t\tpm,\n\t});\n\n\tif (installResult.dependencies.size > 0 || installResult.devDependencies.size > 0) {\n\t\t// next steps if they didn't install dependencies\n\t\tlet steps = [];\n\n\t\tif (!installResult.installed) {\n\t\t\tif (deps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...deps]);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (devDeps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...devDeps, '-D']);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dev dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// put steps with numbers above here\n\t\tsteps = steps.map((step, i) => `${i + 1}. ${step}`);\n\n\t\tif (!installResult.installed) {\n\t\t\tsteps.push('');\n\t\t}\n\n\t\tsteps.push('Import and use the blocks!');\n\n\t\tconst next = nextSteps(steps);\n\n\t\tprocess.stdout.write(next);\n\t}\n}\n","/*\n\tInstalled from @ieedan/std\n*/\n\n/** Await this to pause execution until the duration has passed.\n *\n * @param durationMs The duration in ms until the sleep in over\n * @returns\n *\n * ## Usage\n * ```ts\n * console.log(Date.now()) // 1725739228744\n *\n * await sleep(1000);\n *\n * console.log(Date.now()) // 1725739229744\n * ```\n */\nexport function sleep(durationMs: number): Promise<void> {\n\treturn new Promise((res) => setTimeout(res, durationMs));\n}\n","import { cancel, confirm, isCancel, log, outro } from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, program } from 'commander';\nimport nodeMachineId from 'node-machine-id';\nimport * as v from 'valibot';\nimport * as ASCII from '../utils/ascii';\nimport { sleep } from '../utils/blocks/ts/sleep';\nimport { iFetch } from '../utils/fetch';\nimport { intro, spinner } from '../utils/prompts';\nimport * as jsrepo from '../utils/registry-providers/jsrepo';\nimport { TokenManager } from '../utils/token-manager';\n\nconst schema = v.object({\n\ttoken: v.optional(v.string()),\n\tlogout: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nexport const auth = new Command('auth')\n\t.description('Authenticate to jsrepo.com')\n\t.option('--logout', 'Execute the logout flow.', false)\n\t.option('--token <token>', 'The token to use for authenticating to this service.')\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _auth(options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _auth(options: Options) {\n\tconst tokenManager = new TokenManager();\n\n\tif (options.logout) {\n\t\ttokenManager.delete('jsrepo');\n\t\tlog.success(`Logged out of ${ASCII.JSREPO_DOT_COM}!`);\n\t\treturn;\n\t}\n\n\tif (options.token !== undefined) {\n\t\ttokenManager.set('jsrepo', options.token);\n\t\tlog.success(`Logged into ${ASCII.JSREPO_DOT_COM}!`);\n\t\treturn;\n\t}\n\n\tif (tokenManager.get('jsrepo') !== undefined) {\n\t\tconst result = await confirm({\n\t\t\tmessage: 'You are currently signed into jsrepo do you want to sign out?',\n\t\t\tinitialValue: false,\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\t}\n\n\tconst hardwareId = nodeMachineId.machineIdSync(true);\n\n\tlet anonSessionId: string;\n\n\ttry {\n\t\tconst response = await iFetch(`${jsrepo.BASE_URL}/api/login/device`, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'content-type': 'application/json' },\n\t\t\tbody: JSON.stringify({ hardwareId }),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error('There was an error creating the session');\n\t\t}\n\n\t\tconst res = await response.json();\n\n\t\tanonSessionId = res.id;\n\t} catch (err) {\n\t\tprogram.error(color.red(err));\n\t}\n\n\tlog.step(`Sign in at ${color.cyan(`${jsrepo.BASE_URL}/login/device/${anonSessionId}`)}`);\n\n\tconst timeout = 1000 * 60 * 60 * 15; // 15 minutes\n\n\tconst loading = spinner();\n\n\tconst pollingTimeout = setTimeout(() => {\n\t\tloading.stop('You never signed in.');\n\n\t\tprogram.error(color.red('Session timed out try again!'));\n\t}, timeout);\n\n\tloading.start('Waiting for you to sign in...');\n\n\twhile (true) {\n\t\t// wait initially cause c'mon ain't no way\n\t\tawait sleep(5000); // wait 5 seconds\n\n\t\tconst endpoint = `${jsrepo.BASE_URL}/api/login/device/${anonSessionId}`;\n\n\t\ttry {\n\t\t\tconst response = await iFetch(endpoint, {\n\t\t\t\tmethod: 'PATCH',\n\t\t\t\theaders: { 'content-type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ hardwareId }),\n\t\t\t});\n\n\t\t\tif (!response.ok) continue;\n\n\t\t\tclearTimeout(pollingTimeout);\n\n\t\t\tconst key = await response.text();\n\n\t\t\ttokenManager.set('jsrepo', key);\n\n\t\t\tloading.stop(`Logged into ${ASCII.JSREPO_DOT_COM}!`);\n\n\t\t\tbreak;\n\t\t} catch {\n\t\t\t// continue\n\t\t}\n\t}\n}\n","import fs from 'node:fs';\nimport { log, outro } from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, program } from 'commander';\nimport ignore from 'ignore';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport { MANIFEST_FILE } from '../constants';\nimport type { Category } from '../types';\nimport * as ascii from '../utils/ascii';\nimport { buildBlocksDirectory, buildConfigFiles, pruneUnused } from '../utils/build';\nimport { DEFAULT_CONFIG, runRules } from '../utils/build/check';\nimport { IGNORES, type RegistryConfig, getRegistryConfig } from '../utils/config';\nimport { createManifest, parseManifest } from '../utils/manifest';\nimport { intro, spinner } from '../utils/prompts';\n\nconst schema = v.object({\n\tdirs: v.optional(v.array(v.string())),\n\toutputDir: v.optional(v.string()),\n\tincludeBlocks: v.optional(v.array(v.string())),\n\tincludeCategories: v.optional(v.array(v.string())),\n\texcludeBlocks: v.optional(v.array(v.string())),\n\texcludeCategories: v.optional(v.array(v.string())),\n\texcludeDeps: v.optional(v.array(v.string())),\n\tlistBlocks: v.optional(v.array(v.string())),\n\tlistCategories: v.optional(v.array(v.string())),\n\tdoNotListBlocks: v.optional(v.array(v.string())),\n\tdoNotListCategories: v.optional(v.array(v.string())),\n\tallowSubdirectories: v.optional(v.boolean()),\n\tpreview: v.optional(v.boolean()),\n\tincludeDocs: v.optional(v.boolean()),\n\toutput: v.boolean(),\n\tverbose: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nconst build = new Command('build')\n\t.description(`Builds the provided --dirs in the project root into a \\`${MANIFEST_FILE}\\` file.`)\n\t.option('--dirs [dirs...]', 'The directories containing the blocks.')\n\t.option(\n\t\t'--output-dir <dir>',\n\t\t'The directory to output the registry to. (Copies jsrepo-manifest.json + all required files)'\n\t)\n\t.option('--include-blocks [blockNames...]', 'Include only the blocks with these names.')\n\t.option(\n\t\t'--include-categories [categoryNames...]',\n\t\t'Include only the categories with these names.'\n\t)\n\t.option('--exclude-blocks [blockNames...]', 'Do not include the blocks with these names.')\n\t.option(\n\t\t'--exclude-categories [categoryNames...]',\n\t\t'Do not include the categories with these names.'\n\t)\n\t.option('--list-blocks [blockNames...]', 'List only the blocks with these names.')\n\t.option('--list-categories [categoryNames...]', 'List only the categories with these names.')\n\t.option('--do-not-list-blocks [blockNames...]', 'Do not list the blocks with these names.')\n\t.option(\n\t\t'--do-not-list-categories [categoryNames...]',\n\t\t'Do not list the categories with these names.'\n\t)\n\t.option('--exclude-deps [deps...]', 'Dependencies that should not be added.')\n\t.option('--allow-subdirectories', 'Allow subdirectories to be built.')\n\t.option('--preview', 'Display a preview of the blocks list.')\n\t.option('--include-docs', 'Include docs files (*.mdx, *.md) in the registry.')\n\t.option('--no-output', `Do not output a \\`${MANIFEST_FILE}\\` file.`)\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _build(options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _build(options: Options) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tconst categories: Category[] = [];\n\n\tconst config: RegistryConfig = getRegistryConfig(options.cwd).match(\n\t\t(val) => {\n\t\t\tif (val === null) {\n\t\t\t\treturn {\n\t\t\t\t\t$schema: '',\n\t\t\t\t\treadme: 'README.md',\n\t\t\t\t\tdirs: options.dirs ?? [],\n\t\t\t\t\toutputDir: options.outputDir,\n\t\t\t\t\tdoNotListBlocks: options.doNotListBlocks ?? [],\n\t\t\t\t\tdoNotListCategories: options.doNotListCategories ?? [],\n\t\t\t\t\tlistBlocks: options.listBlocks ?? [],\n\t\t\t\t\tlistCategories: options.listCategories ?? [],\n\t\t\t\t\texcludeDeps: options.excludeDeps ?? [],\n\t\t\t\t\tincludeBlocks: options.includeBlocks ?? [],\n\t\t\t\t\tincludeCategories: options.includeCategories ?? [],\n\t\t\t\t\texcludeBlocks: options.excludeBlocks ?? [],\n\t\t\t\t\texcludeCategories: options.excludeCategories ?? [],\n\t\t\t\t\tallowSubdirectories: options.allowSubdirectories,\n\t\t\t\t\tpreview: options.preview,\n\t\t\t\t\tincludeDocs: options.includeDocs ?? false,\n\t\t\t\t} satisfies RegistryConfig;\n\t\t\t}\n\n\t\t\tconst mergedVal = val;\n\n\t\t\t// overwrites config with flag values\n\n\t\t\tif (options.dirs) mergedVal.dirs = options.dirs;\n\t\t\tif (options.outputDir) mergedVal.outputDir = options.outputDir;\n\t\t\tif (options.doNotListBlocks) mergedVal.doNotListBlocks = options.doNotListBlocks;\n\t\t\tif (options.doNotListCategories)\n\t\t\t\tmergedVal.doNotListCategories = options.doNotListCategories;\n\t\t\tif (options.listBlocks) mergedVal.listBlocks = options.listBlocks;\n\t\t\tif (options.listCategories) mergedVal.listCategories = options.listCategories;\n\t\t\tif (options.includeBlocks) mergedVal.includeBlocks = options.includeBlocks;\n\t\t\tif (options.includeCategories) mergedVal.includeCategories = options.includeCategories;\n\t\t\tif (options.excludeBlocks) mergedVal.excludeBlocks = options.excludeBlocks;\n\t\t\tif (options.excludeCategories) mergedVal.excludeCategories = options.excludeCategories;\n\t\t\tif (options.excludeDeps) mergedVal.excludeDeps = options.excludeDeps;\n\t\t\tif (options.allowSubdirectories !== undefined)\n\t\t\t\tmergedVal.allowSubdirectories = options.allowSubdirectories;\n\t\t\tif (options.preview !== undefined) mergedVal.preview = options.preview;\n\t\t\tif (options.includeDocs !== undefined) mergedVal.includeDocs = options.includeDocs;\n\n\t\t\tmergedVal.rules = { ...DEFAULT_CONFIG, ...mergedVal.rules };\n\n\t\t\treturn mergedVal;\n\t\t},\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tlet outDir: string;\n\n\tif (config.outputDir) {\n\t\toutDir = path.join(options.cwd, config.outputDir);\n\t} else {\n\t\toutDir = options.cwd;\n\t}\n\n\tconst manifestOut = path.join(outDir, MANIFEST_FILE);\n\n\tif (options.output && fs.existsSync(manifestOut)) {\n\t\t// we need to remove all previously copied directories\n\t\tif (config.outputDir) {\n\t\t\t// read old manifest to determine where the unwanted files are\n\t\t\t// we can't just rm -rf because other static files could be hosted out of the same directory\n\t\t\tconst oldManifest = parseManifest(fs.readFileSync(manifestOut).toString());\n\n\t\t\tif (oldManifest.isOk()) {\n\t\t\t\t// first just remove all the files\n\t\t\t\tfor (const category of oldManifest.unwrap().categories) {\n\t\t\t\t\tfor (const block of category.blocks) {\n\t\t\t\t\t\tconst newDirPath = path.join(outDir, block.directory);\n\n\t\t\t\t\t\tif (fs.existsSync(newDirPath)) {\n\t\t\t\t\t\t\tfs.rmSync(newDirPath, { recursive: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfs.rmSync(manifestOut);\n\t}\n\n\tconst ig = ignore();\n\n\ttry {\n\t\tconst ignoreFile = fs.readFileSync(path.join(options.cwd, '.gitignore')).toString();\n\n\t\tig.add(ignoreFile);\n\t} catch {\n\t\t// just continue on\n\t}\n\n\tig.add(IGNORES);\n\n\tfor (const dir of config.dirs) {\n\t\tconst dirPath = path.join(options.cwd, dir);\n\n\t\tloading.start(`Building ${color.cyan(dirPath)}`);\n\n\t\tconst builtCategories = buildBlocksDirectory(dirPath, {\n\t\t\tcwd: options.cwd,\n\t\t\tignore: ig,\n\t\t\tconfig,\n\t\t});\n\n\t\tfor (const category of builtCategories) {\n\t\t\tif (categories.find((cat) => cat.name === category.name) !== undefined) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped adding \\`${color.cyan(`${dir}/${category.name}`)}\\` because a category with the same name already exists!`\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcategories.push(category);\n\t\t}\n\n\t\tloading.stop(`Built ${color.cyan(dirPath)}`);\n\t}\n\n\tconst configFiles = buildConfigFiles(config, { cwd: options.cwd });\n\n\tconst manifest = createManifest(categories, configFiles, config);\n\n\tloading.start('Checking manifest');\n\n\tconst { warnings, errors } = runRules(manifest, config, options.cwd, config.rules);\n\n\tloading.stop('Completed checking manifest.');\n\n\t// add gap for errors\n\tif (warnings.length > 0 || errors.length > 0) {\n\t\tconsole.log(ascii.VERTICAL_LINE);\n\t}\n\n\tfor (const warning of warnings) {\n\t\tconsole.log(warning);\n\t}\n\n\tif (errors.length > 0) {\n\t\tfor (const error of errors) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`Completed checking manifest with ${color.bold(`${errors.length} error(s)`)} and ${color.bold(`${warnings.length} warning(s)`)}`\n\t\t\t)\n\t\t);\n\t}\n\n\t// removes any unused blocks or categories\n\tconst [prunedCategories, count] = pruneUnused(manifest.categories);\n\n\tmanifest.categories = prunedCategories;\n\n\tif (count > 0) {\n\t\tlog.step(`Removed ${count} unused block${count > 1 ? 's' : ''}.`);\n\t}\n\n\tif (config.preview) {\n\t\tconst blocks = manifest.categories.flatMap((cat) =>\n\t\t\tcat.blocks.filter((b) => b.list).map((b) => `${color.cyan(b.category)}/${b.name}`)\n\t\t);\n\n\t\tlog.message(`${color.yellow('Preview')}:`);\n\n\t\tfor (const block of blocks) {\n\t\t\tconsole.log(`${ascii.VERTICAL_LINE}   ${block}`);\n\t\t}\n\t}\n\n\tif (options.output) {\n\t\tif (config.outputDir) {\n\t\t\tloading.start(`Copying registry files to \\`${color.cyan(outDir)}\\``);\n\n\t\t\t// copy config files to output directory\n\t\t\tif (manifest.configFiles) {\n\t\t\t\tfor (const file of manifest.configFiles) {\n\t\t\t\t\tconst originalPath = path.join(options.cwd, file.path);\n\t\t\t\t\tconst destPath = path.join(outDir, file.path);\n\n\t\t\t\t\tconst containing = path.join(destPath, '../');\n\n\t\t\t\t\tif (!fs.existsSync(containing)) {\n\t\t\t\t\t\tfs.mkdirSync(containing, { recursive: true });\n\t\t\t\t\t}\n\n\t\t\t\t\tfs.copyFileSync(originalPath, destPath);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// copy the files for each block in each category\n\t\t\tfor (const category of manifest.categories) {\n\t\t\t\tfor (const block of category.blocks) {\n\t\t\t\t\tconst originalPath = path.join(options.cwd, block.directory);\n\t\t\t\t\tconst newDirPath = path.join(outDir, block.directory);\n\n\t\t\t\t\tfor (const file of block.files) {\n\t\t\t\t\t\tconst containing = path.join(newDirPath, file, '../');\n\n\t\t\t\t\t\tif (!fs.existsSync(containing)) {\n\t\t\t\t\t\t\tfs.mkdirSync(containing, { recursive: true });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfs.copyFileSync(path.join(originalPath, file), path.join(newDirPath, file));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tloading.stop(`Copied registry files to \\`${color.cyan(outDir)}\\``);\n\t\t}\n\n\t\tloading.start(`Writing output to \\`${color.cyan(manifestOut)}\\``);\n\n\t\t// write manifest\n\t\tfs.writeFileSync(manifestOut, JSON.stringify(manifest, null, '\\t'));\n\n\t\tloading.stop(`Wrote output to \\`${color.cyan(manifestOut)}\\``);\n\t}\n}\n\nexport { build };\n","import fs from 'node:fs';\nimport { cancel, confirm, isCancel, select } from '@clack/prompts';\nimport color from 'chalk';\nimport { Argument, Command, program } from 'commander';\nimport { resolveCommand } from 'package-manager-detector/commands';\nimport { detect } from 'package-manager-detector/detect';\nimport path from 'pathe';\nimport { x } from 'tinyexec';\nimport * as v from 'valibot';\nimport * as ascii from '../utils/ascii';\nimport { resolveTree } from '../utils/blocks';\nimport * as url from '../utils/blocks/ts/url';\nimport { isTestFile } from '../utils/build';\nimport { type ProjectConfig, getProjectConfig, resolvePaths } from '../utils/config';\nimport {\n\ttype ConcurrentTask,\n\tintro,\n\tpromptInstallDependencies,\n\trunTasksConcurrently,\n\tspinner,\n} from '../utils/prompts';\nimport * as registry from '../utils/registry-providers/internal';\n\nconst schema = v.objectWithRest(\n\t{\n\t\trepo: v.optional(v.string()),\n\t\tallow: v.boolean(),\n\t\tcache: v.boolean(),\n\t\tverbose: v.boolean(),\n\t\tcwd: v.string(),\n\t},\n\tv.unknown()\n);\n\ntype Options = v.InferInput<typeof schema>;\n\nconst exec = new Command('exec')\n\t.alias('x')\n\t.description('Execute a block as a script.')\n\t.addArgument(\n\t\tnew Argument(\n\t\t\t'script',\n\t\t\t'Name of the script you want to execute. ex: (general/hello, github/ieedan/std/general/hello)'\n\t\t).argOptional()\n\t)\n\t.option('--repo <repo>', 'Repository to download and run the script from.')\n\t.option('-A, --allow', 'Allow jsrepo to download code from the provided repo.', false)\n\t.option('--no-cache', 'Disable caching of resolved git urls.')\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.allowExcessArguments()\n\t.allowUnknownOption()\n\t.action(async (script, opts, command) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _exec(script, options, command);\n\t});\n\n// biome-ignore lint/suspicious/noExplicitAny: we don't have a type for command\nexport async function _exec(s: string | undefined, options: Options, command: any) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tlet script = s;\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tconst configResult = getProjectConfig(options.cwd);\n\n\t/** The user has opted for no config */\n\tconst noConfig = configResult.isErr();\n\n\tlet config: ProjectConfig;\n\n\tif (configResult.isErr()) {\n\t\t// add default config used for default values in prompts\n\t\tconfig = {\n\t\t\t$schema: '',\n\t\t\tincludeTests: false,\n\t\t\tincludeDocs: false,\n\t\t\twatermark: true,\n\t\t\tpaths: {\n\t\t\t\t'*': './',\n\t\t\t},\n\t\t\trepos: [],\n\t\t};\n\t} else {\n\t\tconfig = configResult.unwrap();\n\t}\n\n\tlet repoPaths = config.repos;\n\n\t// we just want to override all others if supplied via the CLI\n\tif (options.repo) repoPaths = [options.repo];\n\n\tconst provider = script ? registry.selectProvider(script) : undefined;\n\n\t// we are only getting repos for blocks that specified repos\n\tif (script && provider) {\n\t\tconst { url: repo } = provider.parse(script, { fullyQualified: true });\n\n\t\tif (!repoPaths.find((repoPath) => repoPath === repo)) {\n\t\t\tif (!options.allow) {\n\t\t\t\tconst result = await confirm({\n\t\t\t\t\tmessage: `Allow ${ascii.JSREPO} to download and run code from ${color.cyan(repo)}?`,\n\t\t\t\t\tinitialValue: true,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(result) || !result) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trepoPaths = [repo];\n\t\t}\n\t}\n\n\tif (!options.allow && options.repo) {\n\t\tconst result = await confirm({\n\t\t\tmessage: `Allow ${ascii.JSREPO} to download and run code from ${color.cyan(options.repo)}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\t}\n\n\tif (repoPaths.length === 0) {\n\t\tif (noConfig) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`Fully quality your script ex: (github/ieedan/std/scripts/build) or provide the \\`${color.bold(\n\t\t\t\t\t\t'--repo'\n\t\t\t\t\t)}\\` flag to specify a registry.`\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`There were no repos present in your config and you didn't provide the \\`${color.bold(\n\t\t\t\t\t'--repo'\n\t\t\t\t)}\\` flag with a repo.`\n\t\t\t)\n\t\t);\n\t}\n\n\tloading.start(`Fetching scripts from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst resolvedRepos: registry.RegistryProviderState[] = (\n\t\tawait registry.forEachPathGetProviderState(repoPaths, { noCache: !options.cache })\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed to get info for ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tconst blocksMap = (\n\t\tawait registry.fetchBlocks(resolvedRepos, {\n\t\t\tverbose: options.verbose ? verbose : undefined,\n\t\t})\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed fetching scripts from ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tloading.stop(`Retrieved scripts from ${color.cyan(repoPaths.join(', '))}`);\n\n\t// if no blocks are provided prompt the user for what blocks they want\n\tif (!script) {\n\t\tconst promptResult = await select({\n\t\t\tmessage: 'Select which script to run.',\n\t\t\toptions: Array.from(blocksMap.entries())\n\t\t\t\t.filter(([_, value]) => value.list)\n\t\t\t\t.map(([key, value]) => {\n\t\t\t\t\tlet label: string;\n\n\t\t\t\t\t// show the full repo if there are multiple repos\n\t\t\t\t\tif (repoPaths.length > 1) {\n\t\t\t\t\t\tlabel = `${color.cyan(url.join(value.sourceRepo.url, value.category))}/${value.name}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlabel = `${color.cyan(value.category)}/${value.name}`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\tvalue: key,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t});\n\n\t\tif (isCancel(promptResult)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tscript = promptResult as string;\n\t}\n\n\tconst installingBlocks = (await resolveTree([script], blocksMap, resolvedRepos)).match(\n\t\t(val) => val,\n\t\t(err) => program.error(err)\n\t);\n\n\tconst tempDirBase = 'temp-jsrepo-exec';\n\n\tconst tempDirectoryRelative = `./${tempDirBase}/${encodeURIComponent(script)}`;\n\n\tconst tempDirectory = path.join(process.cwd(), tempDirectoryRelative);\n\n\tconfig.paths['*'] = tempDirectoryRelative;\n\n\tfs.mkdirSync(tempDirectory, { recursive: true });\n\n\tconst pm = (await detect({ cwd: process.cwd() }))?.agent ?? 'npm';\n\n\tconst tasks: ConcurrentTask[] = [];\n\n\tconst devDeps: Set<string> = new Set<string>();\n\tconst deps: Set<string> = new Set<string>();\n\n\tconst resolvedPathsResult = resolvePaths(config.paths, options.cwd);\n\n\tif (resolvedPathsResult.isErr()) {\n\t\tprogram.error(color.red(resolvedPathsResult.unwrapErr()));\n\t}\n\n\tconst resolvedPaths = resolvedPathsResult.unwrap();\n\n\tconst addedBlocks: string[] = [];\n\n\tfor (const block of installingBlocks) {\n\t\tconst fullSpecifier = `${block.sourceRepo.url}/${block.category}/${block.name}`;\n\t\tconst shortSpecifier = `${block.category}/${block.name}`;\n\n\t\tconst providerInfo = block.sourceRepo;\n\n\t\tconst directory = path.join(options.cwd, resolvedPaths['*'], block.category);\n\n\t\taddedBlocks.push(shortSpecifier);\n\n\t\ttasks.push({\n\t\t\trun: async ({ message }) => {\n\t\t\t\tmessage(`Adding ${color.cyan(fullSpecifier)}`);\n\n\t\t\t\t// in case the directory didn't already exist\n\t\t\t\tfs.mkdirSync(directory, { recursive: true });\n\n\t\t\t\tconst files: { content: string; destPath: string }[] = [];\n\n\t\t\t\tconst getSourceFile = async (filePath: string) => {\n\t\t\t\t\tconst content = await registry.fetchRaw(providerInfo, filePath);\n\n\t\t\t\t\tif (content.isErr()) {\n\t\t\t\t\t\tloading.stop(color.red(`Error fetching ${color.bold(filePath)}`));\n\t\t\t\t\t\tprogram.error(\n\t\t\t\t\t\t\tcolor.red(`There was an error trying to get ${fullSpecifier}`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn content.unwrap();\n\t\t\t\t};\n\n\t\t\t\tfor (const sourceFile of block.files) {\n\t\t\t\t\tif (!config.includeTests && isTestFile(sourceFile)) continue;\n\n\t\t\t\t\tconst sourcePath = path.join(block.directory, sourceFile);\n\n\t\t\t\t\tlet destPath: string;\n\t\t\t\t\tif (block.subdirectory) {\n\t\t\t\t\t\tdestPath = path.join(directory, block.name, sourceFile);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdestPath = path.join(directory, sourceFile);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst content = await getSourceFile(sourcePath);\n\n\t\t\t\t\tconst pathFolder = destPath.slice(0, destPath.length - sourceFile.length);\n\n\t\t\t\t\tfs.mkdirSync(pathFolder, {\n\t\t\t\t\t\trecursive: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tfiles.push({ content, destPath });\n\t\t\t\t}\n\n\t\t\t\tfor (const file of files) {\n\t\t\t\t\tfs.writeFileSync(file.destPath, file.content);\n\t\t\t\t}\n\n\t\t\t\tif (config.includeTests && block.tests) {\n\t\t\t\t\tconst { devDependencies } = JSON.parse(\n\t\t\t\t\t\tfs.readFileSync(path.join(options.cwd, 'package.json')).toString()\n\t\t\t\t\t);\n\n\t\t\t\t\tif (devDependencies === undefined || devDependencies.vitest === undefined) {\n\t\t\t\t\t\tdevDeps.add('vitest');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const dep of block.devDependencies) {\n\t\t\t\t\tdevDeps.add(dep);\n\t\t\t\t}\n\n\t\t\t\tfor (const dep of block.dependencies) {\n\t\t\t\t\tdeps.add(dep);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tawait runTasksConcurrently({\n\t\tstartMessage: 'Adding blocks',\n\t\tstopMessage: `Added ${color.cyan(addedBlocks.join(', '))}`,\n\t\tloading,\n\t\ttasks,\n\t});\n\n\tconst hasDependencies = deps.size > 0 || devDeps.size > 0;\n\n\t// create temporary package.json\n\tif (hasDependencies) {\n\t\t// add package.json\n\t\tconst packageContent = {\n\t\t\tname: 'temp-package',\n\t\t\ttype: 'module',\n\t\t\tversion: '0.0.1',\n\t\t};\n\n\t\tconst packagePath = path.join(tempDirectory, 'package.json');\n\n\t\tfs.writeFileSync(packagePath, JSON.stringify(packageContent, null, '\\t'));\n\t}\n\n\tawait promptInstallDependencies(deps, devDeps, {\n\t\tyes: true,\n\t\tno: false,\n\t\tcwd: tempDirectory,\n\t\tpm,\n\t\tignoreWorkspace: true,\n\t});\n\n\tconst startIndex = (command.parent.rawArgs as string[]).findIndex((arg) => arg === '--');\n\n\tlet passthroughArgs: string[] = [];\n\n\tif (startIndex !== -1) {\n\t\tpassthroughArgs = command.parent.rawArgs.slice(startIndex + 1);\n\t}\n\n\tverbose(`Passing args ${color.cyan(passthroughArgs.join(' '))}`);\n\n\t// run the cli\n\n\tconsole.clear();\n\n\tconst runningBlock = installingBlocks[0];\n\n\tlet file: string;\n\n\t// tsx seems to be smart enough to figure out if it is a .ts file\n\tif (runningBlock.subdirectory) {\n\t\tfile = path.join(tempDirectory, `${runningBlock.category}/${runningBlock.name}/index.js`);\n\t} else {\n\t\tfile = path.join(tempDirectory, `${runningBlock.category}/${runningBlock.name}.js`);\n\t}\n\n\tconst cmd = resolveCommand(pm, 'execute', ['tsx', file, ...passthroughArgs]);\n\n\tif (!cmd) {\n\t\tprogram.error(color.red('Error resolving run command!'));\n\t}\n\n\ttry {\n\t\tconst proc = x(cmd.command, cmd.args, { nodeOptions: { cwd: process.cwd() } });\n\n\t\tfor await (const line of proc) {\n\t\t\tprocess.stdout.write(`${line}\\n`);\n\t\t}\n\t} finally {\n\t\tfs.rmSync(path.join(process.cwd(), tempDirBase), { recursive: true, force: true });\n\t}\n}\n\nexport { exec };\n","import color from 'chalk';\nimport { Command, program } from 'commander';\nimport fetch from 'make-fetch-happen';\nimport * as v from 'valibot';\nimport type { Category, Manifest } from '../types';\nimport * as array from '../utils/blocks/ts/array';\nimport * as pad from '../utils/blocks/ts/pad';\nimport * as jsrepo from '../utils/registry-providers/jsrepo';\nimport { TokenManager } from '../utils/token-manager';\n\nconst schema = v.object({\n\tjson: v.boolean(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nexport const info = new Command('info')\n\t.description('Get info about a registry on jsrepo.com')\n\t.argument('registry', 'Name of the registry to get the info for i.e. @ieedan/std')\n\t.option('--json', 'Output the response in formatted JSON.', false)\n\t.action(async (registry, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait _info(registry, options);\n\t});\n\nasync function _info(registry: string, options: Options) {\n\tconst tokenManager = new TokenManager();\n\n\tconst token = tokenManager.get(jsrepo.jsrepo.name);\n\n\tconst headers: Record<string, string> = {};\n\n\tif (token) {\n\t\tconst [key, value] = jsrepo.jsrepo.authHeader!(token);\n\n\t\theaders[key] = value;\n\t}\n\n\tconst url = new URL(`/api/scopes/${registry}`, jsrepo.BASE_URL).toString();\n\n\tconst response = await fetch(url, { headers });\n\n\tif (!response.ok) {\n\t\tif (response.status === 404) {\n\t\t\tprogram.error(color.red('Registry not found!'));\n\t\t} else {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`Error fetching registry! Error: ${response.status} - ${response.statusText}`\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tconst result = (await response.json()) as RegistryInfoResponse;\n\n\tif (options.json) {\n\t\treturn process.stdout.write(JSON.stringify(result, null, '  '));\n\t}\n\n\tprocess.stdout.write(formattedOutput(result));\n}\n\nfunction formattedOutput(registryInfo: RegistryInfoResponse) {\n\tlet out = `${color.cyan(`${registryInfo.name}@${registryInfo.version}`)} | versions: ${color.cyan(registryInfo.versions.length.toString())}\\n`;\n\n\tif (registryInfo.meta.description) {\n\t\tout += `${registryInfo.meta.description}\\n`;\n\t}\n\n\tif (registryInfo.meta.homepage) {\n\t\tout += `${color.blue(registryInfo.meta.homepage)}\\n`;\n\t}\n\n\tout += '\\n';\n\n\tif (registryInfo.meta.tags) {\n\t\tout += `keywords: ${registryInfo.meta.tags.map((t) => color.cyan(t)).join(', ')}\\n\\n`;\n\t}\n\n\tconst multipleOfThree = (num: number) => num % 3 === 0;\n\n\tconst blockTitles = registryInfo.categories\n\t\t.flatMap((c) => c.blocks)\n\t\t.map((b) =>\n\t\t\tb.list ? color.blue(`${b.category}/${b.name}`) : color.dim(`${b.category}/${b.name}`)\n\t\t);\n\n\tconst minBlockTitleLength = array.maxLength(blockTitles) + 4;\n\n\tout += `blocks:\n${blockTitles\n\t.map((b, i) => {\n\t\tconst isMultipleOfThree = multipleOfThree(i + 1);\n\t\tconst isLast = i + 1 >= blockTitles.length;\n\n\t\tif (isMultipleOfThree) {\n\t\t\treturn `${b}\\n`;\n\t\t}\n\n\t\treturn `${pad.rightPadMin(b, minBlockTitleLength, ' ')}${isLast ? '\\n' : ''}`;\n\t})\n\t.join('')}\n`;\n\n\tif (registryInfo.meta.authors) {\n\t\tout += `authors:\n${registryInfo.meta.authors.map((a) => `- ${color.blue(a)}`).join('\\n')}\\n\\n`;\n\t}\n\n\tout += `tags:\n${Object.entries(registryInfo.tags)\n\t.map(([tag, version]) => `${color.blue(tag)}: ${version}`)\n\t.join('\\n')}\\n\\n`;\n\n\treturn out;\n}\n\ntype MinUser = {\n\tname: string;\n\tusername: string;\n\temail: string;\n};\n\ntype RegistryInfoResponse = {\n\tname: string;\n\tversion: string;\n\treleasedBy: MinUser;\n\tprimaryLanguage: string;\n\tfirstPublishedAt: Date;\n\tmeta: {\n\t\tauthors: string[] | undefined;\n\t\tbugs: string | undefined;\n\t\tdescription: string | undefined;\n\t\thomepage: string | undefined;\n\t\trepository: string | undefined;\n\t\ttags: string[] | undefined;\n\t};\n\taccess: NonNullable<Manifest['access']>;\n\tpeerDependencies: NonNullable<Manifest['peerDependencies']> | null;\n\tconfigFiles: NonNullable<Manifest['configFiles']> | null;\n\tcategories: Category[];\n\ttags: Record<string, string>;\n\tversions: string[];\n\ttime: Record<string, Date>;\n};\n","import fs from 'node:fs';\nimport {\n\tcancel,\n\tconfirm,\n\tisCancel,\n\tlog,\n\tmultiselect,\n\toutro,\n\tpassword,\n\tselect,\n\tspinner,\n\ttext,\n} from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, Option, program } from 'commander';\nimport { createPathsMatcher } from 'get-tsconfig';\nimport { detect, resolveCommand } from 'package-manager-detector';\nimport path from 'pathe';\nimport * as v from 'valibot';\nimport * as ascii from '../utils/ascii';\nimport { parseRecord } from '../utils/blocks/commander/parsers';\nimport * as u from '../utils/blocks/ts/url';\nimport {\n\ttype Formatter,\n\tPROJECT_CONFIG_NAME,\n\ttype Paths,\n\ttype ProjectConfig,\n\tREGISTRY_CONFIG_NAME,\n\tformatterSchema,\n\tgetProjectConfig,\n\tgetRegistryConfig,\n} from '../utils/config';\nimport { packageJson } from '../utils/context';\nimport { formatFile, matchJSDescendant, tryGetTsconfig } from '../utils/files';\nimport { loadFormatterConfig } from '../utils/format';\nimport { json } from '../utils/language-support';\nimport type { PackageJson } from '../utils/package';\nimport { checkPreconditions } from '../utils/preconditions';\nimport {\n\ttype Task,\n\tintro,\n\tnextSteps,\n\tpromptInstallDependencies,\n\tpromptUpdateFile,\n\trunTasks,\n} from '../utils/prompts';\nimport * as registry from '../utils/registry-providers/internal';\nimport { TokenManager } from '../utils/token-manager';\n\nconst schema = v.object({\n\trepos: v.optional(v.array(v.string())),\n\twatermark: v.boolean(),\n\ttests: v.optional(v.boolean()),\n\tdocs: v.optional(v.boolean()),\n\tformatter: v.optional(formatterSchema),\n\tpaths: v.optional(v.record(v.string(), v.string())),\n\tconfigFiles: v.optional(v.record(v.string(), v.string())),\n\tproject: v.optional(v.boolean()),\n\tregistry: v.optional(v.boolean()),\n\tbuildScript: v.string(),\n\tpublishScript: v.string(),\n\texpand: v.boolean(),\n\tmaxUnchanged: v.number(),\n\tyes: v.boolean(),\n\tcache: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nconst init = new Command('init')\n\t.description('Initializes your project with a configuration file.')\n\t.argument('[registries...]', 'Registries to install the blocks from.', [])\n\t.option('--repos [repos...]', 'Repository to install the blocks from. (DEPRECATED)')\n\t.option(\n\t\t'--no-watermark',\n\t\t'Will not add a watermark to each file upon adding it to your project.'\n\t)\n\t.option('--tests', 'Will include tests with the blocks.')\n\t.option('--docs', 'Will include docs with the blocks.')\n\t.addOption(\n\t\tnew Option(\n\t\t\t'--formatter <formatter>',\n\t\t\t'What formatter to use when adding or updating blocks.'\n\t\t).choices(['prettier', 'biome'])\n\t)\n\t.addOption(\n\t\tnew Option('--paths <category=path>,<category=path>', 'The paths to install the blocks to.')\n\t\t\t.argParser(parseRecord)\n\t\t\t.default({})\n\t)\n\t.addOption(\n\t\tnew Option(\n\t\t\t'--config-files <configFile=path>,<configFile=path>',\n\t\t\t'The paths to install the config files to.'\n\t\t)\n\t\t\t.argParser(parseRecord)\n\t\t\t.default({})\n\t)\n\t.option('-P, --project', 'Takes you through the steps to initialize a project.')\n\t.option('-R, --registry', 'Takes you through the steps to initialize a registry.')\n\t.option(\n\t\t'--build-script <name>',\n\t\t'The name of the build script. (For Registry setup)',\n\t\t'build:registry'\n\t)\n\t.option(\n\t\t'--publish-script <name>',\n\t\t'The name of the publish script. (For Registry setup)',\n\t\t'release:registry'\n\t)\n\t.option('-E, --expand', 'Expands the diff so you see the entire file.', false)\n\t.option(\n\t\t'--max-unchanged <number>',\n\t\t'Maximum unchanged lines that will show without being collapsed.',\n\t\t(val) => Number.parseInt(val), // this is such a dumb api thing\n\t\t3\n\t)\n\t.option('-y, --yes', 'Skip confirmation prompt.', false)\n\t.option('--no-cache', 'Disable caching of resolved git urls.')\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (registries, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tif (options.registry !== undefined && options.project !== undefined) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`You cannot provide both ${color.bold('--project')} and ${color.bold('--registry')} at the same time.`\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tif (options.repos !== undefined) {\n\t\t\tlog.warn(\n\t\t\t\t`The ${color.gray('`--repos`')} flag is deprecated! Instead supply registries as arguments. ${color.cyan(`\\`jsrepo init ${options.repos.join(' ')}\\``)}`\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\toptions.registry === undefined &&\n\t\t\toptions.project === undefined &&\n\t\t\tregistries.length === 0\n\t\t) {\n\t\t\tconst response = await select({\n\t\t\t\tmessage: 'Initialize a project or registry?',\n\t\t\t\toptions: [\n\t\t\t\t\t{ value: 'project', label: 'project' },\n\t\t\t\t\t{ value: 'registry', label: 'registry' },\n\t\t\t\t],\n\t\t\t\tinitialValue: 'project',\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\toptions.project = response === 'project';\n\t\t}\n\n\t\tif (options.project || registries.length > 0) {\n\t\t\tawait _initProject(registries, options);\n\t\t} else {\n\t\t\tawait _initRegistry(options);\n\t\t}\n\n\t\toutro(color.green('All done!'));\n\t});\n\nconst _initProject = async (registries: string[], options: Options) => {\n\tconst initialConfig = getProjectConfig(options.cwd);\n\n\tconst loading = spinner();\n\n\tlet paths: Paths;\n\tlet configFiles: Record<string, string> = {};\n\n\tconst tsconfigResult = tryGetTsconfig(options.cwd).unwrapOr(null);\n\n\tlet defaultPath =\n\t\toptions.paths?.['*'] ??\n\t\t(initialConfig.isOk() ? initialConfig.unwrap().paths['*'] : undefined);\n\n\tif (options.yes && defaultPath === undefined) {\n\t\tprogram.error(\n\t\t\tcolor.red('You must provide a default path to install the blocks when using --yes.')\n\t\t);\n\t}\n\n\tif (defaultPath === undefined) {\n\t\tconst defaultPathResult = await text({\n\t\t\tmessage: 'Please enter a default path to install the blocks',\n\t\t\tvalidate(value) {\n\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\n\t\t\t\tif (!value.startsWith('./')) {\n\t\t\t\t\tconst error =\n\t\t\t\t\t\t'Invalid path alias! If you are intending to use a relative path make sure it starts with `./`';\n\n\t\t\t\t\tif (tsconfigResult === null) {\n\t\t\t\t\t\treturn error;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst matcher = createPathsMatcher(tsconfigResult);\n\n\t\t\t\t\tif (matcher) {\n\t\t\t\t\t\tconst found = matcher(value);\n\n\t\t\t\t\t\tif (found.length === 0) return error;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tplaceholder: './src/blocks',\n\t\t\tinitialValue: defaultPath,\n\t\t});\n\n\t\tif (isCancel(defaultPathResult)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tdefaultPath = defaultPathResult;\n\t}\n\n\tif (initialConfig.isOk()) {\n\t\tpaths = { ...initialConfig.unwrap().paths, '*': defaultPath };\n\t\tconfigFiles = initialConfig.unwrap().configFiles ?? {};\n\t} else {\n\t\tpaths = { '*': defaultPath };\n\t}\n\n\tpaths = { ...paths, ...options.paths };\n\n\t// configure formatter\n\tif (!options.formatter) {\n\t\tlet defaultFormatter = initialConfig.isErr()\n\t\t\t? 'none'\n\t\t\t: (initialConfig.unwrap().formatter ?? 'none');\n\n\t\tif (fs.existsSync(path.join(options.cwd, '.prettierrc'))) {\n\t\t\tdefaultFormatter = 'prettier';\n\t\t}\n\n\t\tif (fs.existsSync(path.join(options.cwd, 'biome.json'))) {\n\t\t\tdefaultFormatter = 'biome';\n\t\t}\n\n\t\tconst response = await select({\n\t\t\tmessage: 'Which formatter would you like to use?',\n\t\t\toptions: ['Prettier', 'Biome', 'None'].map((val) => ({\n\t\t\t\tvalue: val.toLowerCase(),\n\t\t\t\tlabel: val,\n\t\t\t})),\n\t\t\tinitialValue: defaultFormatter,\n\t\t});\n\n\t\tif (isCancel(response)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tif (response !== 'none') {\n\t\t\toptions.formatter = response as Formatter;\n\t\t}\n\t}\n\n\tconst repos = Array.from(\n\t\tnew Set([\n\t\t\t...registries,\n\t\t\t...(options.repos ?? []),\n\t\t\t...(initialConfig.isOk() ? initialConfig.unwrap().repos : []),\n\t\t])\n\t);\n\n\tconst deps = new Set<string>();\n\tconst devDeps = new Set<string>();\n\n\tconst setupRepo = async (url: string) => {\n\t\tconst promptResult = await promptForRegistryConfig({\n\t\t\turl,\n\t\t\tpaths,\n\t\t\tconfigFiles,\n\t\t\toptions,\n\t\t\tformatter: options.formatter,\n\t\t});\n\n\t\tfor (const dep of promptResult.dependencies) {\n\t\t\tdeps.add(dep);\n\t\t}\n\n\t\tfor (const dep of promptResult.devDependencies) {\n\t\t\tdevDeps.add(dep);\n\t\t}\n\n\t\tpaths = promptResult.paths;\n\t\tconfigFiles = promptResult.configFiles;\n\t};\n\n\tif (repos.length > 0) {\n\t\tfor (const repo of repos) {\n\t\t\t// if already present in config ask if you would like to set it up\n\t\t\tif (\n\t\t\t\t!registries.find((r) => r === repo) &&\n\t\t\t\tinitialConfig.isOk() &&\n\t\t\t\tinitialConfig.unwrap().repos.find((r) => r === repo)\n\t\t\t) {\n\t\t\t\tconst confirmResult = await confirm({\n\t\t\t\t\tmessage: `Initialize ${repo}?`,\n\t\t\t\t\tinitialValue: options.yes,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(confirmResult)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tif (!confirmResult) continue;\n\t\t\t}\n\n\t\t\tlog.info(`Initializing ${color.cyan(repo)}`);\n\n\t\t\tawait setupRepo(repo);\n\t\t}\n\t}\n\n\twhile (true) {\n\t\tif (!options.yes) {\n\t\t\tconst confirmResult = await confirm({\n\t\t\t\tmessage: repos.length > 0 ? 'Add another repo?' : 'Add a repo?',\n\t\t\t\tinitialValue: repos.length === 0, // default to yes for first repo\n\t\t\t});\n\n\t\t\tif (isCancel(confirmResult)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tif (!confirmResult) break;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst result = await text({\n\t\t\tmessage: 'Where should we download the blocks from?',\n\t\t\tplaceholder: 'github/ieedan/std',\n\t\t\tvalidate: (val) => {\n\t\t\t\tif (val.trim().length === 0) return 'Please provide a value';\n\n\t\t\t\tif (!registry.selectProvider(val)) {\n\t\t\t\t\treturn `Invalid provider! Valid providers (${registry.providers.map((provider) => provider.name).join(', ')})`;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tif (isCancel(result)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tawait setupRepo(result);\n\n\t\trepos.push(result);\n\t}\n\n\tconst config: ProjectConfig = {\n\t\t$schema: `https://unpkg.com/jsrepo@${packageJson.version}/schemas/project-config.json`,\n\t\trepos,\n\t\tincludeTests:\n\t\t\tinitialConfig.isOk() && options.tests === undefined\n\t\t\t\t? initialConfig.unwrap().includeTests\n\t\t\t\t: (options.tests ?? false),\n\t\tincludeDocs:\n\t\t\tinitialConfig.isOk() && options.docs === undefined\n\t\t\t\t? initialConfig.unwrap().includeDocs\n\t\t\t\t: (options.docs ?? false),\n\t\twatermark: options.watermark,\n\t\tformatter: options.formatter,\n\t\tconfigFiles,\n\t\tpaths,\n\t};\n\n\tloading.start(`Writing config to \\`${PROJECT_CONFIG_NAME}\\``);\n\n\tconst { prettierOptions, biomeOptions } = await loadFormatterConfig({\n\t\tformatter: config.formatter,\n\t\tcwd: options.cwd,\n\t});\n\n\tconst configPath = path.join(options.cwd, PROJECT_CONFIG_NAME);\n\n\tconst configContent = await json.format(JSON.stringify(config, null, '\\t'), {\n\t\tbiomeOptions,\n\t\tprettierOptions,\n\t\tfilePath: configPath,\n\t\tformatter: config.formatter,\n\t});\n\n\tif (!fs.existsSync(options.cwd)) {\n\t\tfs.mkdirSync(options.cwd, { recursive: true });\n\t}\n\n\tfs.writeFileSync(configPath, configContent);\n\n\tloading.stop(`Wrote config to \\`${PROJECT_CONFIG_NAME}\\`.`);\n\n\tconst pm = (await detect({ cwd: options.cwd }))?.agent ?? 'npm';\n\n\tconst installResult = await promptInstallDependencies(deps, devDeps, {\n\t\tyes: options.yes,\n\t\tcwd: options.cwd,\n\t\tpm,\n\t});\n\n\tif (installResult.dependencies.size > 0 || installResult.devDependencies.size > 0) {\n\t\t// next steps if they didn't install dependencies\n\t\tlet steps = [];\n\n\t\tif (!installResult.installed) {\n\t\t\tif (deps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...deps]);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (devDeps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...devDeps, '-D']);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dev dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// put steps with numbers above here\n\t\tsteps = steps.map((step, i) => `${i + 1}. ${step}`);\n\n\t\tif (!installResult.installed) {\n\t\t\tsteps.push('');\n\t\t}\n\n\t\tsteps.push(`Add blocks with ${color.cyan('jsrepo add')}!`);\n\n\t\tconst next = nextSteps(steps);\n\n\t\tprocess.stdout.write(next);\n\t}\n};\n\nasync function promptForRegistryConfig({\n\turl,\n\tpaths,\n\tconfigFiles,\n\tformatter,\n\toptions,\n}: {\n\turl: string;\n\tpaths: Paths;\n\tconfigFiles: Record<string, string>;\n\tformatter: ProjectConfig['formatter'];\n\toptions: Options;\n}): Promise<{\n\tpaths: Paths;\n\tconfigFiles: Record<string, string>;\n\tdependencies: string[];\n\tdevDependencies: string[];\n}> {\n\tconst loading = spinner();\n\n\tconst storage = new TokenManager();\n\n\tconst provider = registry.selectProvider(url);\n\n\tif (!provider) {\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`Invalid provider! Valid providers (${registry.providers.map((provider) => provider.name).join(', ')})`\n\t\t\t)\n\t\t);\n\t}\n\n\tlet tokenKey: string = provider.name;\n\n\tif (provider.name === registry.http.name) {\n\t\tconst parsed = registry.http.parse(url, { fullyQualified: false });\n\n\t\t// this is safe since we had to parse the url earlier to get the provider\n\t\tconst registryUrl = new URL(parsed.url);\n\n\t\ttokenKey = `http-${registryUrl.origin}`;\n\t}\n\n\tconst token = storage.get(tokenKey);\n\n\t// don't ask if the provider is a custom domain\n\tif (!token && !options.yes) {\n\t\tconst result = await confirm({\n\t\t\tmessage: 'Would you like to add an auth token?',\n\t\t\tinitialValue: false,\n\t\t});\n\n\t\tif (isCancel(result)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tif (result) {\n\t\t\tconst response = await password({\n\t\t\t\tmessage: 'Paste your token',\n\t\t\t\tvalidate(value) {\n\t\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tstorage.set(tokenKey, response);\n\t\t}\n\t}\n\n\tloading.start(`Fetching manifest from ${color.cyan(url)}`);\n\n\tconst providerState = (await registry.getProviderState(url, { noCache: !options.cache })).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tconst manifest = (await registry.fetchManifest(providerState)).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tloading.stop(`Fetched manifest from ${color.cyan(url)}`);\n\n\tcheckPreconditions(providerState, manifest, options.cwd);\n\n\tconst dependencies: string[] = [];\n\tconst devDependencies: string[] = [];\n\n\t// setup config files\n\tif (manifest.configFiles) {\n\t\tconst { prettierOptions, biomeOptions } = await loadFormatterConfig({\n\t\t\tformatter: formatter,\n\t\t\tcwd: options.cwd,\n\t\t});\n\n\t\tfor (const file of manifest.configFiles) {\n\t\t\tif (file.optional && !options.yes) {\n\t\t\t\tconst result = await confirm({\n\t\t\t\t\tmessage: `Would you like to add the ${file.name} file?`,\n\t\t\t\t\tinitialValue: true,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(result)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tif (!result) continue;\n\t\t\t}\n\n\t\t\tdependencies.push(...(file.dependencies ?? []));\n\t\t\tdevDependencies.push(...(file.devDependencies ?? []));\n\n\t\t\t// get the path to the file from the user\n\t\t\tif (!configFiles[file.name]) {\n\t\t\t\tif (options.configFiles?.[file.name]) {\n\t\t\t\t\tconfigFiles[file.name] = options.configFiles[file.name];\n\t\t\t\t} else if (!options.yes) {\n\t\t\t\t\tconst result = await text({\n\t\t\t\t\t\tmessage: `Where is your ${file.name} file?`,\n\t\t\t\t\t\tdefaultValue: file.expectedPath,\n\t\t\t\t\t\tinitialValue: file.expectedPath,\n\t\t\t\t\t\tplaceholder: file.expectedPath,\n\t\t\t\t\t\tvalidate(value) {\n\t\t\t\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isCancel(result)) {\n\t\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\t\tprocess.exit(0);\n\t\t\t\t\t}\n\n\t\t\t\t\tconfigFiles[file.name] = result;\n\t\t\t\t} else {\n\t\t\t\t\tif (!file.expectedPath) {\n\t\t\t\t\t\tprogram.error(\n\t\t\t\t\t\t\tcolor.red(`You must provide a path for ${file.name} when using --yes!`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tconfigFiles[file.name] = file.expectedPath;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet fullFilePath = path.join(options.cwd, configFiles[file.name]);\n\n\t\t\tlet fileContents: string | undefined;\n\n\t\t\tif (fs.existsSync(fullFilePath)) {\n\t\t\t\tfileContents = fs.readFileSync(fullFilePath).toString();\n\t\t\t} else {\n\t\t\t\tconst dir = path.dirname(fullFilePath);\n\n\t\t\t\tif (fs.existsSync(dir)) {\n\t\t\t\t\tconst matchedPath = matchJSDescendant(fullFilePath);\n\n\t\t\t\t\tif (matchedPath) {\n\t\t\t\t\t\tfileContents = fs.readFileSync(matchedPath).toString();\n\n\t\t\t\t\t\tconst newPath = path.relative(options.cwd, matchedPath);\n\n\t\t\t\t\t\tlog.warn(\n\t\t\t\t\t\t\t`Located ${color.bold(configFiles[file.name])} at ${color.bold(newPath)}`\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// update path\n\t\t\t\t\t\tconfigFiles[file.name] = newPath;\n\n\t\t\t\t\t\tfullFilePath = path.join(options.cwd, newPath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tloading.start(`Fetching the ${color.cyan(file.name)} from ${color.cyan(url)}`);\n\n\t\t\tconst remoteContent = (await registry.fetchRaw(providerState, file.path)).match(\n\t\t\t\t(v) => v,\n\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t);\n\n\t\t\tconst originalRemoteContent = await formatFile({\n\t\t\t\tfile: {\n\t\t\t\t\tcontent: remoteContent,\n\t\t\t\t\tdestPath: fullFilePath,\n\t\t\t\t},\n\t\t\t\tbiomeOptions,\n\t\t\t\tprettierOptions,\n\t\t\t\tformatter,\n\t\t\t});\n\n\t\t\tloading.stop(`Fetched the ${color.cyan(file.name)} from ${color.cyan(url)}`);\n\n\t\t\tlet acceptedChanges = options.yes || fileContents === undefined;\n\n\t\t\tif (fileContents) {\n\t\t\t\tif (!options.yes) {\n\t\t\t\t\tconst from = u.join(providerState.url, file.name);\n\n\t\t\t\t\tconst updateResult = await promptUpdateFile({\n\t\t\t\t\t\tconfig: { biomeOptions, prettierOptions, formatter },\n\t\t\t\t\t\tcurrent: {\n\t\t\t\t\t\t\tcontent: fileContents,\n\t\t\t\t\t\t\tpath: fullFilePath,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tincoming: {\n\t\t\t\t\t\t\tcontent: originalRemoteContent,\n\t\t\t\t\t\t\tpath: from,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t...options,\n\t\t\t\t\t\t\tloading,\n\t\t\t\t\t\t\tno: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (updateResult.applyChanges) {\n\t\t\t\t\t\tacceptedChanges = true;\n\t\t\t\t\t\tfileContents = updateResult.updatedContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst dir = path.dirname(fullFilePath);\n\n\t\t\t\tif (!fs.existsSync(dir)) {\n\t\t\t\t\tfs.mkdirSync(dir, { recursive: true });\n\t\t\t\t}\n\n\t\t\t\tfileContents = originalRemoteContent;\n\t\t\t}\n\n\t\t\tif (acceptedChanges && fileContents) {\n\t\t\t\tloading.start(`Writing ${color.cyan(file.name)} to ${color.cyan(fullFilePath)}`);\n\n\t\t\t\tfs.writeFileSync(fullFilePath, fileContents);\n\n\t\t\t\tloading.stop(`Wrote ${color.cyan(file.name)} to ${color.cyan(fullFilePath)}`);\n\t\t\t}\n\t\t}\n\t}\n\n\t// configure category paths\n\tif (!options.yes) {\n\t\tconst configurePaths = await multiselect({\n\t\t\tmessage: 'Which category paths would you like to configure?',\n\t\t\toptions: manifest.categories.map((cat) => ({\n\t\t\t\tlabel: cat.name,\n\t\t\t\tvalue: cat.name,\n\t\t\t\thint: manifest.defaultPaths?.[cat.name]\n\t\t\t\t\t? `Default: ${manifest.defaultPaths?.[cat.name]}`\n\t\t\t\t\t: undefined,\n\t\t\t})),\n\t\t\trequired: false,\n\t\t});\n\n\t\tif (isCancel(configurePaths)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tif (configurePaths.length > 0) {\n\t\t\tfor (const category of configurePaths) {\n\t\t\t\tconst configuredValue = paths[category] ?? manifest.defaultPaths?.[category];\n\n\t\t\t\tconst categoryPath = await text({\n\t\t\t\t\tmessage: `Where should ${category} be added in your project?`,\n\t\t\t\t\tvalidate(value) {\n\t\t\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\t\t\t\t\t},\n\t\t\t\t\tplaceholder: configuredValue ? configuredValue : `./src/${category}`,\n\t\t\t\t\tdefaultValue: configuredValue,\n\t\t\t\t\tinitialValue: configuredValue,\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(categoryPath)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tpaths[category] = categoryPath;\n\t\t\t}\n\t\t}\n\t}\n\n\t// use the default path (if it exists) for any categories the user didn't configure\n\tfor (const category of manifest.categories) {\n\t\tif (paths[category.name] !== undefined) continue;\n\n\t\tconst defaultPath = manifest.defaultPaths?.[category.name];\n\n\t\tif (!defaultPath) continue;\n\n\t\tpaths[category.name] = defaultPath;\n\t}\n\n\treturn { paths, configFiles, dependencies, devDependencies };\n}\n\nconst _initRegistry = async (options: Options) => {\n\tconst loading = spinner();\n\n\tconst packagePath = path.join(options.cwd, 'package.json');\n\n\tif (!fs.existsSync(packagePath)) {\n\t\tprogram.error(color.red(`Couldn't find your ${color.bold('package.json')}!`));\n\t}\n\n\tlet config = getRegistryConfig(options.cwd).match(\n\t\t(val) => val,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tif (!config) {\n\t\tconfig = {\n\t\t\t$schema: '',\n\t\t\tname: undefined,\n\t\t\tversion: undefined,\n\t\t\treadme: 'README.md',\n\t\t\tdirs: [],\n\t\t\tdoNotListBlocks: [],\n\t\t\tdoNotListCategories: [],\n\t\t\tlistBlocks: [],\n\t\t\tlistCategories: [],\n\t\t\texcludeDeps: [],\n\t\t\tincludeBlocks: [],\n\t\t\tincludeCategories: [],\n\t\t\texcludeBlocks: [],\n\t\t\texcludeCategories: [],\n\t\t\tpreview: false,\n\t\t\tincludeDocs: false,\n\t\t};\n\t}\n\n\tconfig.$schema = `https://unpkg.com/jsrepo@${packageJson.version}/schemas/registry-config.json`;\n\n\twhile (true) {\n\t\tif (config.dirs.length > 0) {\n\t\t\tconst confirmResult = await confirm({\n\t\t\t\tmessage: 'Add another blocks directory?',\n\t\t\t\tinitialValue: false,\n\t\t\t});\n\n\t\t\tif (isCancel(confirmResult)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tif (!confirmResult) break;\n\t\t}\n\n\t\tconst response = await text({\n\t\t\tmessage: 'Where are your blocks located?',\n\t\t\tplaceholder: './src',\n\t\t\tdefaultValue: './src',\n\t\t\tinitialValue: './src',\n\t\t\tvalidate: (val) => {\n\t\t\t\tif (val.trim().length === 0) return 'Please provide a value!';\n\t\t\t},\n\t\t});\n\n\t\tif (isCancel(response)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tconfig.dirs.push(response);\n\t}\n\n\tconst pkg = JSON.parse(fs.readFileSync(packagePath).toString());\n\n\tlet configurePublish = !options.yes;\n\n\tif (!options.yes) {\n\t\tconst confirmResult = await confirm({\n\t\t\tmessage: `Configure to publish to ${ascii.JSREPO_DOT_COM}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(confirmResult)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tconfigurePublish = confirmResult;\n\t}\n\n\tif (configurePublish) {\n\t\tif (!config.name) {\n\t\t\tconst nameResponse = await text({\n\t\t\t\tmessage: \"What's the name of your registry?\",\n\t\t\t\tplaceholder: '@ieedan/std',\n\t\t\t\tvalidate: (val) => {\n\t\t\t\t\tif (val.trim().length === 0) return 'Please provide a value!';\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (isCancel(nameResponse)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tconfig.name = nameResponse;\n\t\t}\n\n\t\tif (!config.version) {\n\t\t\tconfig.version = '0.0.1';\n\t\t}\n\n\t\toptions.publishScript = await promptForScriptKey(\n\t\t\toptions.publishScript,\n\t\t\tpkg,\n\t\t\toptions,\n\t\t\t'release:registry'\n\t\t);\n\t} else {\n\t\toptions.buildScript = await promptForScriptKey(\n\t\t\toptions.buildScript,\n\t\t\tpkg,\n\t\t\toptions,\n\t\t\t'build:registry'\n\t\t);\n\t}\n\n\tconst alreadyInstalled = pkg.devDependencies && pkg.devDependencies.jsrepo !== undefined;\n\n\tconst pm = (await detect({ cwd: 'cwd' }))?.agent ?? 'npm';\n\n\tconst buildScript = 'jsrepo build';\n\tconst publishScript = 'jsrepo publish';\n\n\t// ensure we are adding to an object that exists\n\tif (pkg.scripts === undefined) {\n\t\tpkg.scripts = {};\n\t}\n\n\tif (configurePublish) {\n\t\tpkg.scripts[options.publishScript] = publishScript;\n\t} else {\n\t\tpkg.scripts[options.buildScript] = buildScript;\n\t}\n\n\tconst tasks: Task[] = [];\n\n\ttasks.push({\n\t\tloadingMessage: 'Adding script to package.json',\n\t\tcompletedMessage: 'Added script to package.json',\n\t\trun: async () => {\n\t\t\ttry {\n\t\t\t\tfs.writeFileSync(packagePath, JSON.stringify(pkg, null, '\\t'));\n\t\t\t} catch (err) {\n\t\t\t\tprogram.error(\n\t\t\t\t\tcolor.red(`Error writing to \\`${color.bold(packagePath)}\\`. Error: ${err}`)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\n\ttasks.push({\n\t\tloadingMessage: `Writing config to \\`${color.cyan(REGISTRY_CONFIG_NAME)}\\``,\n\t\tcompletedMessage: `Wrote config to \\`${color.cyan(REGISTRY_CONFIG_NAME)}\\``,\n\t\trun: async () => {\n\t\t\tconst configPath = path.join(options.cwd, REGISTRY_CONFIG_NAME);\n\n\t\t\ttry {\n\t\t\t\tfs.writeFileSync(path.join(configPath), JSON.stringify(config, null, '\\t'));\n\t\t\t} catch (err) {\n\t\t\t\tprogram.error(\n\t\t\t\t\tcolor.red(`Error writing to \\`${color.bold(configPath)}\\`. Error: ${err}`)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\n\tawait runTasks(tasks, { loading });\n\n\tlet installed = alreadyInstalled;\n\n\tif (!alreadyInstalled) {\n\t\tconst installedResult = await promptInstallDependencies(new Set(), new Set(['jsrepo']), {\n\t\t\tcwd: options.cwd,\n\t\t\tpm,\n\t\t\tyes: options.yes,\n\t\t});\n\n\t\tinstalled = installedResult.installed;\n\t}\n\n\tlet steps: string[] = [];\n\n\tif (!installed) {\n\t\tconst cmd = resolveCommand(pm, 'add', ['jsrepo', '-D']);\n\n\t\tsteps.push(\n\t\t\t`Install ${ascii.JSREPO} as a dev dependency \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t);\n\t}\n\n\tsteps.push(`Add categories to \\`${color.cyan(config.dirs.join(', '))}\\`.`);\n\n\tif (configurePublish) {\n\t\tconst runScript = resolveCommand(pm, 'run', [options.publishScript]);\n\n\t\tsteps.push(\n\t\t\t`Run \\`${color.cyan(`${runScript?.command} ${runScript?.args.join(' ')}`)}\\` to publish the registry.`\n\t\t);\n\t} else {\n\t\tconst runScript = resolveCommand(pm, 'run', [options.buildScript]);\n\n\t\tsteps.push(\n\t\t\t`Run \\`${color.cyan(`${runScript?.command} ${runScript?.args.join(' ')}`)}\\` to build the registry.`\n\t\t);\n\t}\n\n\t// put steps with numbers above here\n\tsteps = steps.map((step, i) => `${i + 1}. ${step}`);\n\n\tconst next = nextSteps(steps);\n\n\tprocess.stdout.write(next);\n};\n\nasync function promptForScriptKey(\n\tscriptKey: string,\n\tpkg: PackageJson,\n\toptions: Options,\n\tplaceholder: string\n) {\n\tlet key = scriptKey;\n\n\t// continue asking until the user either chooses to overwrite or inputs a script that doesn't exist yet\n\twhile (!options.yes && pkg.scripts && pkg.scripts[key]) {\n\t\tconst response = await confirm({\n\t\t\tmessage: `The \\`${color.cyan(key)}\\` already exists overwrite?`,\n\t\t\tinitialValue: false,\n\t\t});\n\n\t\tif (isCancel(response)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tif (!response) {\n\t\t\tconst response = await text({\n\t\t\t\tmessage: 'What would you like to call the script?',\n\t\t\t\tplaceholder,\n\t\t\t\tvalidate: (val) => {\n\t\t\t\t\tif (val.trim().length === 0) return 'Please provide a value!';\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tkey = response;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn key;\n}\n\nexport { init };\n","import { Server } from '@modelcontextprotocol/sdk/server/index.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport {\n\ttype CallToolRequest,\n\tCallToolRequestSchema,\n\tListToolsRequestSchema,\n\ttype Tool,\n} from '@modelcontextprotocol/sdk/types.js';\nimport color from 'chalk';\nimport { cli } from '../cli';\nimport { preloadBlocks } from './blocks';\nimport * as array from './blocks/ts/array';\nimport * as url from './blocks/ts/url';\nimport { getProjectConfig } from './config';\nimport { packageJson } from './context';\nimport { iFetch } from './fetch';\nimport * as registry from './registry-providers/internal';\nimport * as jsrepo from './registry-providers/jsrepo';\n\nconst listComponentsTool: Tool = {\n\tname: 'list-components',\n\tdescription:\n\t\t'Lists all available components/utilities for the provided registries. If registries are not provided tries to use the registries in the users jsrepo.json file.',\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tregistries: {\n\t\t\t\ttype: 'array',\n\t\t\t\tdescription:\n\t\t\t\t\t'Registries to list components from. If not provided will use the registries in the users jsrepo.json file.',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t},\n\t\t\tcwd: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: 'The current working directory of the users project.',\n\t\t\t},\n\t\t},\n\t\trequired: ['cwd'],\n\t},\n};\n\ninterface ListComponentsArgs {\n\tregistries?: string[];\n\tcwd: string;\n}\n\nasync function listComponents({ registries, cwd }: ListComponentsArgs) {\n\tif (!registries) {\n\t\tconst config = getProjectConfig(cwd).match(\n\t\t\t(v) => v,\n\t\t\t() => {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Could not find your configuration file! Please provide `registries`.'\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\n\t\tif (config.repos.length === 0) {\n\t\t\tthrow new Error(\n\t\t\t\t'No registries (repos) in your configuration file! Please provide `registries`.'\n\t\t\t);\n\t\t}\n\n\t\tregistries = config.repos;\n\t}\n\n\tconst states = (await registry.forEachPathGetProviderState(registries)).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting registry state for ${err.repo}: ${err.message}`);\n\t\t}\n\t);\n\n\tconst components = (await registry.fetchBlocks(states)).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting components for ${err.repo}: ${err.message}`);\n\t\t}\n\t);\n\n\treturn {\n\t\tcomponents: array\n\t\t\t.fromMap(components, (_, v) => v)\n\t\t\t.map((c) => url.join(c.sourceRepo.url, `${c.category}/${c.name}`)),\n\t};\n}\n\nconst getComponentCodeTool: Tool = {\n\tname: 'get-component-code',\n\tdescription: 'Returns the associated code files for the provided component.',\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tcomponent: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription:\n\t\t\t\t\t'The component to get the code for. Format: <registry>/<category>/<block>',\n\t\t\t},\n\t\t\tincludeTests: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription: 'Should tests be included with the component code.',\n\t\t\t\tdefault: false,\n\t\t\t},\n\t\t\tincludeDocs: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription: 'Should docs be included with the component code.',\n\t\t\t\tdefault: false,\n\t\t\t},\n\t\t},\n\t\trequired: ['component'],\n\t},\n};\n\ninterface GetComponentCodeArgs {\n\tcomponent: string;\n\tincludeTests?: boolean;\n\tincludeDocs?: boolean;\n}\n\nasync function getComponentCode({\n\tcomponent,\n\tincludeTests = false,\n\tincludeDocs = false,\n}: GetComponentCodeArgs) {\n\tconst provider = registry.selectProvider(component);\n\n\tif (!provider) {\n\t\tthrow new Error(\n\t\t\t`${component} is not valid! Expected a category and block proceeded by the registry url i.e. @ieedan/std/<category>/<block>`\n\t\t);\n\t}\n\n\tconst { url: repo, specifier } = provider.parse(component, { fullyQualified: true });\n\n\tif (!specifier) {\n\t\tthrow new Error(\n\t\t\t`${component} is not valid! Expected a category and block proceeded by the registry url i.e. @ieedan/std/<category>/<block>`\n\t\t);\n\t}\n\n\tconst state = (await registry.getProviderState(repo)).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting state for ${repo}: ${err}`);\n\t\t}\n\t);\n\n\tconst manifests = (await registry.fetchManifests([state])).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting manifest for ${repo}: ${err}`);\n\t\t}\n\t);\n\n\tconst blocksMap = registry.getRemoteBlocks(manifests);\n\n\tconst block = blocksMap.get(url.join(repo, specifier));\n\n\tif (!block) {\n\t\tthrow new Error(`${specifier} does not exist in ${repo}`);\n\t}\n\n\tconst preloaded = preloadBlocks([block], { includeTests, includeDocs });\n\n\tconst files = (await Promise.all(preloaded.map((p) => p.files))).flatMap((p) => [\n\t\t...p.map((f) => ({ name: f.name, content: f.content.unwrapOr('<FETCH ERROR>') })),\n\t]);\n\n\treturn {\n\t\tregistry: repo,\n\t\tcomponent: specifier,\n\t\tfiles,\n\t\tcommands: {\n\t\t\tadd: `jsrepo add ${component} -y -A`,\n\t\t\taddMultiple: `jsrepo add ${component} ... -y -A`,\n\t\t\tupdate: `jsrepo update ${component} -y -A`,\n\t\t},\n\t};\n}\n\nconst getConfigFilesTool: Tool = {\n\tname: 'get-config-files',\n\tdescription:\n\t\t'Lists the config files for this registry. These are files that are either necessary for the registry to work or optional as marked by the `optional` boolean on each file.',\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tregistry: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: 'Registry to list config files from.',\n\t\t\t\texamples: [\n\t\t\t\t\t'@ieedan/std',\n\t\t\t\t\t'github/ieedan/std',\n\t\t\t\t\t'gitlab/ieedan/std',\n\t\t\t\t\t'bitbucket/ieedan/std',\n\t\t\t\t\t'azure/ieedan/std/std',\n\t\t\t\t\t'https://example.com/r',\n\t\t\t\t],\n\t\t\t},\n\t\t\trequiredOnly: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tdescription:\n\t\t\t\t\t'When true only returns the config files required for the registry to work properly.',\n\t\t\t},\n\t\t},\n\t\trequired: ['registry'],\n\t},\n};\n\ninterface GetConfigFilesArgs {\n\tregistry: string;\n\trequiredOnly?: boolean;\n}\n\nasync function getConfigFiles({ registry: repo, requiredOnly = false }: GetConfigFilesArgs) {\n\tconst state = (await registry.getProviderState(repo)).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting state for ${repo}: ${err}`);\n\t\t}\n\t);\n\n\tconst manifest = (await registry.fetchManifest(state)).match(\n\t\t(v) => v,\n\t\t(err) => {\n\t\t\tthrow new Error(`Error getting manifest for ${repo}: ${err}`);\n\t\t}\n\t);\n\n\tif (!manifest.configFiles || manifest.configFiles.length === 0) return [];\n\n\tconst files = await Promise.all(\n\t\tmanifest.configFiles\n\t\t\t.filter((f) => !requiredOnly || !f.optional)\n\t\t\t.map(async (f) => {\n\t\t\t\tconst content = (await registry.fetchRaw(state, f.path)).unwrapOr('<FETCH ERROR>');\n\n\t\t\t\treturn {\n\t\t\t\t\t...f,\n\t\t\t\t\tcontent,\n\t\t\t\t};\n\t\t\t})\n\t);\n\n\treturn {\n\t\tconfigFiles: files,\n\t};\n}\n\nconst searchRegistriesTool: Tool = {\n\tname: 'search-registries',\n\tdescription:\n\t\t'Search jsrepo.com for registries that could include components the user needs in their project.',\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tquery: {\n\t\t\t\tdescription: 'A term to search for the registries by.',\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t},\n\t\trequired: ['query'],\n\t},\n};\n\ninterface SearchRegistriesArgs {\n\tquery: string;\n}\n\nasync function searchRegistries({ query }: SearchRegistriesArgs) {\n\tconst response = await iFetch(\n\t\t`${jsrepo.BASE_URL}/api/registries?order_by=most_popular&q=${query}`\n\t);\n\n\tif (!response.ok) return [];\n\n\tconst { data } = await response.json();\n\n\treturn {\n\t\t// @ts-expect-error shut up\n\t\tregistries: data.map((r) => {\n\t\t\tconst name = `@${r.scope.name}/${r.name}`;\n\t\t\treturn {\n\t\t\t\tname,\n\t\t\t\tdescription: r.metaDescription,\n\t\t\t\trepository: r.metaRepository,\n\t\t\t\tkeywords: r.metaTags,\n\t\t\t\thomepage: r.metaHomepage,\n\t\t\t\trating: r.rating,\n\t\t\t\tprimaryLanguage: r.metaPrimaryLanguage,\n\t\t\t\tmonthlyDownloads: r.monthlyFetches,\n\t\t\t\tlatestVersion: r.latestVersion,\n\t\t\t\taccess: r.access,\n\t\t\t\tcommands: {\n\t\t\t\t\tinit: `jsrepo init ${name}`,\n\t\t\t\t},\n\t\t\t};\n\t\t}),\n\t};\n}\n\nconst cliReferenceTool: Tool = {\n\tname: 'cli-reference',\n\tdescription: 'A reference for the usage of the jsrepo CLI.',\n\tinputSchema: {\n\t\ttype: 'object',\n\t},\n};\n\nfunction cliReference() {\n\treturn {\n\t\tname: cli.name(),\n\t\tdescription: cli.description(),\n\t\tversion: cli.version(),\n\t\tcommands: cli.commands.map((c) => ({\n\t\t\tname: c.name(),\n\t\t\tdescription: c.description(),\n\t\t\tusage: c.usage(),\n\t\t\toptions: c.options.map((o) => ({\n\t\t\t\tflags: o.flags,\n\t\t\t\tdescription: o.description,\n\t\t\t\tdefaultValue: o.defaultValue,\n\t\t\t})),\n\t\t})),\n\t};\n}\n\nexport async function connectServer() {\n\tconst server = new Server(\n\t\t{\n\t\t\tname: 'jsrepo',\n\t\t\tversion: packageJson.version,\n\t\t},\n\t\t{\n\t\t\tcapabilities: {\n\t\t\t\ttools: {},\n\t\t\t},\n\t\t}\n\t);\n\n\tserver.setRequestHandler(CallToolRequestSchema, async (request: CallToolRequest) => {\n\t\tconsole.error(`Received CallToolRequest calling: ${color.bold(request.params.name)}`);\n\t\ttry {\n\t\t\tswitch (request.params.name) {\n\t\t\t\tcase 'list-components': {\n\t\t\t\t\tconst args = request.params.arguments as unknown as ListComponentsArgs;\n\n\t\t\t\t\tconst response = await listComponents(args);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\ttext: `Available components:\n${JSON.stringify(response.components)}\nAdd a component to your project with:\njsrepo add ${response.components[0]} -y -A\nAdd multiple components to your project in parallel with:\njsrepo add ${response.components[0]} ${response.components[1] ?? response.components[0]} ... -y -A\nUpdate existing components with:\njsrepo update ${response.components[0]} -y -A\nUpdate multiple components with:\njsrepo update ${response.components[0]} ${response.components[1] ?? response.components[0]} ... -y -A`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcase 'get-component-code': {\n\t\t\t\t\tconst args = request.params.arguments as unknown as GetComponentCodeArgs;\n\n\t\t\t\t\tconst response = await getComponentCode(args);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\ttext: JSON.stringify(response),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcase 'get-config-files': {\n\t\t\t\t\tconst args = request.params.arguments as unknown as GetConfigFilesArgs;\n\n\t\t\t\t\tconst response = await getConfigFiles(args);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\ttext: JSON.stringify(response),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcase 'search-registries': {\n\t\t\t\t\tconst args = request.params.arguments as unknown as SearchRegistriesArgs;\n\n\t\t\t\t\tconst response = await searchRegistries(args);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\ttext: JSON.stringify(response),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcase 'cli-reference': {\n\t\t\t\t\tconst response = cliReference();\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\ttext: JSON.stringify(response),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new Error(`Invalid tool ${request.params.name}`);\n\t\t} catch (err) {\n\t\t\tconsole.error(\n\t\t\t\tcolor.red(`Error executing tool ${color.bold(request.params.name)}: ${err}`)\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcontent: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\ttext: JSON.stringify({\n\t\t\t\t\t\t\terror: err instanceof Error ? err.message : String(err),\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\t});\n\n\tserver.setRequestHandler(ListToolsRequestSchema, async () => {\n\t\tconsole.error('Received ListToolsRequest');\n\t\treturn {\n\t\t\ttools: [\n\t\t\t\tlistComponentsTool,\n\t\t\t\tgetComponentCodeTool,\n\t\t\t\tgetConfigFilesTool,\n\t\t\t\tsearchRegistriesTool,\n\t\t\t\tcliReferenceTool,\n\t\t\t],\n\t\t};\n\t});\n\n\tconst transport = new StdioServerTransport();\n\n\tconsole.error('Connecting server to transport...');\n\n\tawait server.connect(transport);\n\n\tconsole.error('Server connected');\n}\n","import { Command } from 'commander';\nimport { connectServer } from '../utils/mcp';\n\nexport const mcp = new Command('mcp')\n\t.description('Interact with jsrepo through an MCP server.')\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async () => {\n\t\tawait connectServer().catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\tprocess.exit(1);\n\t\t});\n\t});\n","import fs from 'node:fs';\nimport { log, outro } from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, program } from 'commander';\nimport ignore from 'ignore';\nimport path from 'pathe';\nimport semver from 'semver';\nimport * as tar from 'tar';\nimport * as v from 'valibot';\nimport type { Category } from '../types';\nimport * as ascii from '../utils/ascii';\nimport { buildBlocksDirectory, buildConfigFiles, pruneUnused } from '../utils/build';\nimport { DEFAULT_CONFIG, runRules } from '../utils/build/check';\nimport { IGNORES, type RegistryConfig, getRegistryConfig } from '../utils/config';\nimport { iFetch } from '../utils/fetch';\nimport { createManifest } from '../utils/manifest';\nimport type { PackageJson } from '../utils/package';\nimport { intro, spinner } from '../utils/prompts';\nimport * as jsrepo from '../utils/registry-providers/jsrepo';\nimport { TokenManager } from '../utils/token-manager';\n\nconst schema = v.object({\n\tprivate: v.boolean(),\n\tdryRun: v.boolean(),\n\tname: v.optional(v.string()),\n\tver: v.optional(v.string()),\n\tdirs: v.optional(v.array(v.string())),\n\tincludeBlocks: v.optional(v.array(v.string())),\n\tincludeCategories: v.optional(v.array(v.string())),\n\texcludeBlocks: v.optional(v.array(v.string())),\n\texcludeCategories: v.optional(v.array(v.string())),\n\texcludeDeps: v.optional(v.array(v.string())),\n\tlistBlocks: v.optional(v.array(v.string())),\n\tlistCategories: v.optional(v.array(v.string())),\n\tdoNotListBlocks: v.optional(v.array(v.string())),\n\tdoNotListCategories: v.optional(v.array(v.string())),\n\tallowSubdirectories: v.optional(v.boolean()),\n\tincludeDocs: v.optional(v.boolean()),\n\tverbose: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nexport const publish = new Command('publish')\n\t.description('Publish a registry to jsrepo.com.')\n\t.option(\n\t\t'--private',\n\t\t'When publishing the first version of the registry make it private.',\n\t\tfalse\n\t)\n\t.option('--dry-run', \"Test the publish but don't list on jsrepo.com.\", false)\n\t.option('--name <name>', 'The name of the registry. i.e. @ieedan/std')\n\t.option('--ver <version>', 'The version of the registry. i.e. 0.0.1')\n\t.option('--dirs [dirs...]', 'The directories containing the blocks.')\n\t.option('--include-blocks [blockNames...]', 'Include only the blocks with these names.')\n\t.option(\n\t\t'--include-categories [categoryNames...]',\n\t\t'Include only the categories with these names.'\n\t)\n\t.option('--exclude-blocks [blockNames...]', 'Do not include the blocks with these names.')\n\t.option(\n\t\t'--exclude-categories [categoryNames...]',\n\t\t'Do not include the categories with these names.'\n\t)\n\t.option('--list-blocks [blockNames...]', 'List only the blocks with these names.')\n\t.option('--list-categories [categoryNames...]', 'List only the categories with these names.')\n\t.option('--do-not-list-blocks [blockNames...]', 'Do not list the blocks with these names.')\n\t.option(\n\t\t'--do-not-list-categories [categoryNames...]',\n\t\t'Do not list the categories with these names.'\n\t)\n\t.option('--exclude-deps [deps...]', 'Dependencies that should not be added.')\n\t.option('--allow-subdirectories', 'Allow subdirectories to be built.')\n\t.option('--include-docs', 'Include documentation files (*.md, *.mdx) in the registry.')\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _publish(options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _publish(options: Options) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tconst config: RegistryConfig = getRegistryConfig(options.cwd).match(\n\t\t(val) => {\n\t\t\tif (val === null) {\n\t\t\t\treturn {\n\t\t\t\t\t$schema: '',\n\t\t\t\t\taccess: 'public',\n\t\t\t\t\treadme: 'README.md',\n\t\t\t\t\tdirs: options.dirs ?? [],\n\t\t\t\t\tdoNotListBlocks: options.doNotListBlocks ?? [],\n\t\t\t\t\tdoNotListCategories: options.doNotListCategories ?? [],\n\t\t\t\t\tlistBlocks: options.listBlocks ?? [],\n\t\t\t\t\tlistCategories: options.listCategories ?? [],\n\t\t\t\t\texcludeDeps: options.excludeDeps ?? [],\n\t\t\t\t\tincludeBlocks: options.includeBlocks ?? [],\n\t\t\t\t\tincludeCategories: options.includeCategories ?? [],\n\t\t\t\t\texcludeBlocks: options.excludeBlocks ?? [],\n\t\t\t\t\texcludeCategories: options.excludeCategories ?? [],\n\t\t\t\t\tallowSubdirectories: options.allowSubdirectories,\n\t\t\t\t\tincludeDocs: options.includeDocs ?? false,\n\t\t\t\t} satisfies RegistryConfig;\n\t\t\t}\n\n\t\t\tconst mergedVal = val;\n\n\t\t\t// overwrites config with flag values\n\n\t\t\tif (options.private) mergedVal.access = 'private';\n\t\t\tif (options.name) mergedVal.name = options.name;\n\t\t\tif (options.ver) mergedVal.version = options.ver;\n\t\t\tif (options.dirs) mergedVal.dirs = options.dirs;\n\t\t\tif (options.doNotListBlocks) mergedVal.doNotListBlocks = options.doNotListBlocks;\n\t\t\tif (options.doNotListCategories)\n\t\t\t\tmergedVal.doNotListCategories = options.doNotListCategories;\n\t\t\tif (options.listBlocks) mergedVal.listBlocks = options.listBlocks;\n\t\t\tif (options.listCategories) mergedVal.listCategories = options.listCategories;\n\t\t\tif (options.includeBlocks) mergedVal.includeBlocks = options.includeBlocks;\n\t\t\tif (options.includeCategories) mergedVal.includeCategories = options.includeCategories;\n\t\t\tif (options.excludeBlocks) mergedVal.excludeBlocks = options.excludeBlocks;\n\t\t\tif (options.excludeCategories) mergedVal.excludeCategories = options.excludeCategories;\n\t\t\tif (options.excludeDeps) mergedVal.excludeDeps = options.excludeDeps;\n\t\t\tif (options.allowSubdirectories !== undefined)\n\t\t\t\tmergedVal.allowSubdirectories = options.allowSubdirectories;\n\t\t\tif (options.includeDocs !== undefined) mergedVal.includeDocs = options.includeDocs;\n\n\t\t\tmergedVal.rules = { ...DEFAULT_CONFIG, ...mergedVal.rules };\n\n\t\t\treturn mergedVal;\n\t\t},\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tif (options.dryRun) {\n\t\tlog.warn(color.bgYellow.black(' DRY RUN '));\n\t}\n\n\t// -- pre-flights --\n\n\t// check name\n\tif (config.name !== undefined) {\n\t\ttry {\n\t\t\tconst [scope, registryName, ...rest] = config.name.split('/');\n\n\t\t\tif (rest.length > 0) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\n\t\t\tif (!scope.startsWith('@')) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\n\t\t\tif (!scope.slice(1).match(jsrepo.NAME_REGEX)) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\n\t\t\tif (!registryName.match(jsrepo.NAME_REGEX)) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t} catch {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`\\`${config.name}\\` is not a valid name. The name should be provided as \\`@<scope>/<registry>\\``\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t} else {\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`To publish to ${color.bold('jsrepo.com')} you need to provide the \\`name\\` field in the \\`jsrepo-build-config.json\\``\n\t\t\t)\n\t\t);\n\t}\n\n\t// check version\n\tif (config.version !== undefined) {\n\t\t// use version from package.json\n\t\tif (config.version === 'package') {\n\t\t\tconst packagePath = path.join(options.cwd, 'package.json');\n\n\t\t\tif (!fs.existsSync(packagePath)) {\n\t\t\t\tprogram.error(color.red(`Couldn't find your ${color.bold('package.json')}!`));\n\t\t\t}\n\n\t\t\tconst { version } = JSON.parse(fs.readFileSync(packagePath).toString()) as PackageJson;\n\n\t\t\tconfig.version = version;\n\t\t}\n\n\t\tconst valid = semver.valid(config.version);\n\n\t\tif (!valid) {\n\t\t\tprogram.error(`\\`${config.version}\\` is not a valid semver version.`);\n\t\t}\n\t} else {\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`To publish to ${color.bold('jsrepo.com')} you need to provide the \\`version\\` field in the \\`jsrepo-build-config.json\\``\n\t\t\t)\n\t\t);\n\t}\n\n\tconst apiKey = new TokenManager().get('jsrepo');\n\n\tif (apiKey === undefined) {\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`Please authenticate with ${color.cyan('jsrepo auth')} to publish to ${ascii.JSREPO_DOT_COM}.`\n\t\t\t)\n\t\t);\n\t}\n\n\t// build into temp dir\n\tconst categories: Category[] = [];\n\n\tconst ig = ignore();\n\n\ttry {\n\t\tconst ignoreFile = fs.readFileSync(path.join(options.cwd, '.gitignore')).toString();\n\n\t\tig.add(ignoreFile);\n\t} catch {\n\t\t// just continue on\n\t}\n\n\tig.add(IGNORES);\n\n\tfor (const dir of config.dirs) {\n\t\tconst dirPath = path.join(options.cwd, dir);\n\n\t\tloading.start(`Building ${color.cyan(dirPath)}`);\n\n\t\tconst builtCategories = buildBlocksDirectory(dirPath, {\n\t\t\tcwd: options.cwd,\n\t\t\tignore: ig,\n\t\t\tconfig,\n\t\t});\n\n\t\tfor (const category of builtCategories) {\n\t\t\tif (categories.find((cat) => cat.name === category.name) !== undefined) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${ascii.VERTICAL_LINE}  ${ascii.WARN} Skipped adding \\`${color.cyan(`${dir}/${category.name}`)}\\` because a category with the same name already exists!`\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcategories.push(category);\n\t\t}\n\n\t\tloading.stop(`Built ${color.cyan(dirPath)}`);\n\t}\n\n\tconst configFiles = buildConfigFiles(config, { cwd: options.cwd });\n\n\tconst manifest = createManifest(categories, configFiles, config);\n\n\tloading.start('Checking manifest');\n\n\tconst { warnings, errors } = runRules(manifest, config, options.cwd, config.rules);\n\n\tloading.stop('Completed checking manifest.');\n\n\t// add gap for errors\n\tif (warnings.length > 0 || errors.length > 0) {\n\t\tconsole.log(ascii.VERTICAL_LINE);\n\t}\n\n\tfor (const warning of warnings) {\n\t\tconsole.log(warning);\n\t}\n\n\tif (errors.length > 0) {\n\t\tfor (const error of errors) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`Completed checking manifest with ${color.bold(`${errors.length} error(s)`)} and ${color.bold(`${warnings.length} warning(s)`)}`\n\t\t\t)\n\t\t);\n\t}\n\n\t// removes any unused blocks or categories\n\tconst [prunedCategories, count] = pruneUnused(manifest.categories);\n\n\tmanifest.categories = prunedCategories;\n\n\tif (count > 0) {\n\t\tlog.step(`Removed ${count} unused block${count > 1 ? 's' : ''}.`);\n\t}\n\n\tloading.start(`Packaging ${color.cyan(manifest.name)}...`);\n\n\tconst tempOutDir = path.resolve(options.cwd, `jsrepo-publish-temp-${Date.now()}`);\n\n\tverbose(`Creating temp dir: ${tempOutDir}`);\n\n\tfs.mkdirSync(tempOutDir, { recursive: true });\n\n\tverbose('Writing manifest to temp dir');\n\n\t// write manifest\n\tfs.writeFileSync(path.resolve(tempOutDir, 'jsrepo-manifest.json'), JSON.stringify(manifest));\n\n\t// try copy readme\n\tconst readmePath = path.resolve(options.cwd, config.readme);\n\n\ttry {\n\t\tverbose('Attempting to copy readme');\n\n\t\tfs.copyFileSync(readmePath, path.join(tempOutDir, 'README.md'));\n\n\t\tverbose('Copied readme');\n\t} catch {\n\t\t// do nothing it's okay\n\t\tverbose('No readme found.');\n\t}\n\n\t// copy config files to output directory\n\tif (manifest.configFiles) {\n\t\tverbose('Copying config files');\n\n\t\tfor (const file of manifest.configFiles) {\n\t\t\tconst originalPath = path.join(options.cwd, file.path);\n\t\t\tconst destPath = path.join(tempOutDir, file.path);\n\n\t\t\tconst containing = path.join(destPath, '../');\n\n\t\t\tif (!fs.existsSync(containing)) {\n\t\t\t\tfs.mkdirSync(containing, { recursive: true });\n\t\t\t}\n\n\t\t\tfs.copyFileSync(originalPath, destPath);\n\t\t}\n\n\t\tverbose('Copied config files');\n\t}\n\n\tverbose('Copying registry files');\n\n\t// copy the files for each block in each category\n\tfor (const category of manifest.categories) {\n\t\tfor (const block of category.blocks) {\n\t\t\tconst originalPath = path.join(options.cwd, block.directory);\n\t\t\tconst newDirPath = path.join(tempOutDir, block.directory);\n\n\t\t\tfor (const file of block.files) {\n\t\t\t\tconst containing = path.join(newDirPath, file, '../');\n\n\t\t\t\tif (!fs.existsSync(containing)) {\n\t\t\t\t\tfs.mkdirSync(containing, { recursive: true });\n\t\t\t\t}\n\n\t\t\t\tfs.copyFileSync(path.join(originalPath, file), path.join(newDirPath, file));\n\t\t\t}\n\t\t}\n\t}\n\n\tverbose('Copied registry files');\n\n\tconst dest = path.resolve(options.cwd, `${config.name.replace('/', '_')}-package.tar.gz`);\n\n\tconst files = fs.readdirSync(tempOutDir);\n\n\tverbose('Creating archive file');\n\n\tawait tar.create(\n\t\t{\n\t\t\tz: true,\n\t\t\tcwd: tempOutDir,\n\t\t\tfile: dest,\n\t\t},\n\t\tfiles\n\t);\n\n\tverbose('Created archive file');\n\n\tverbose('Removing temp directory');\n\n\t// remove temp directory\n\tfs.rmSync(tempOutDir, { force: true, recursive: true });\n\n\tverbose('Removed temp directory');\n\n\tloading.stop(`Created package ${color.cyan(dest)}...`);\n\n\tconst access = config.access ?? 'public';\n\n\tlog.info(`Publishing to jsrepo with the access set to ${color.cyan(access)}`);\n\n\tloading.start(`Publishing ${color.bold(manifest.name)} to ${ascii.JSREPO_DOT_COM}...`);\n\n\tconst tarBuffer = fs.readFileSync(dest);\n\n\tverbose('Removing archive file');\n\n\t// remove archive file\n\tfs.rmSync(dest, { force: true, recursive: true });\n\n\tverbose('Removed archive file');\n\n\tverbose(`Publishing to ${`${jsrepo.BASE_URL}/api/publish`}`);\n\n\tconst response = await iFetch(`${jsrepo.BASE_URL}/api/publish`, {\n\t\tbody: tarBuffer,\n\t\theaders: {\n\t\t\t'content-type': 'application/gzip',\n\t\t\t'content-encoding': 'gzip',\n\t\t\t'x-api-key': apiKey,\n\t\t\t'x-dry-run': options.dryRun ? '1' : '0',\n\t\t\t'x-access': access,\n\t\t},\n\t\tmethod: 'POST',\n\t});\n\n\tloading.stop(`Got response from ${ascii.JSREPO_DOT_COM}.`);\n\n\tif (!response.ok) {\n\t\tconst res = (await response.json()) as { message: string };\n\n\t\tif (response.status === 500) {\n\t\t\tprogram.error(\n\t\t\t\t`${color.red(`${color.bold('[jsrepo.com]')} ${color.bold(response.status)} ${res.message}`)}\\nPlease try again. If this persists please contact support at ${color.cyan('https://www.jsrepo.com/help')}`\n\t\t\t);\n\t\t}\n\n\t\tprogram.error(\n\t\t\tcolor.red(`${color.bold('[jsrepo.com]')} ${color.bold(response.status)} ${res.message}`)\n\t\t);\n\t} else {\n\t\tconst res = (await response.json()) as PublishResponse;\n\n\t\tif (res.status === 'dry-run') {\n\t\t\tlog.success(`${color.hex('#f7df1e').bold('[jsrepo.com]')} Completed dry run!`);\n\t\t} else {\n\t\t\tlog.success(\n\t\t\t\t`${color.hex('#f7df1e').bold('[jsrepo.com]')} published ${color.greenBright(`@${res.scope}`)}/${res.registry}${color.greenBright(`@${res.version}`)}!`\n\t\t\t);\n\t\t}\n\t}\n}\n\ntype PublishResponse =\n\t| {\n\t\t\tstatus: 'published';\n\t\t\tscope: string;\n\t\t\tregistry: string;\n\t\t\tversion: string;\n\t\t\ttag: string | null;\n\t\t\tprivate: boolean;\n\t  }\n\t| {\n\t\t\tstatus: 'dry-run';\n\t  };\n","import fs from 'node:fs';\nimport { cancel, confirm, isCancel, outro } from '@clack/prompts';\nimport color from 'chalk';\nimport { Argument, Command, program } from 'commander';\nimport escapeStringRegexp from 'escape-string-regexp';\nimport oxc from 'oxc-parser';\nimport { resolveCommand } from 'package-manager-detector/commands';\nimport { detect } from 'package-manager-detector/detect';\nimport path from 'pathe';\nimport { x } from 'tinyexec';\nimport * as v from 'valibot';\nimport * as ascii from '../utils/ascii';\nimport { getInstalled } from '../utils/blocks';\nimport * as url from '../utils/blocks/ts/url';\nimport { isTestFile } from '../utils/build';\nimport { getPathForBlock, getProjectConfig, resolvePaths } from '../utils/config';\nimport { intro, spinner } from '../utils/prompts';\nimport * as registry from '../utils/registry-providers/internal';\n\nconst schema = v.object({\n\trepo: v.optional(v.string()),\n\tallow: v.boolean(),\n\tdebug: v.boolean(),\n\tcache: v.boolean(),\n\tverbose: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nconst test = new Command('test')\n\t.description('Tests local blocks against most recent remote tests.')\n\t.addArgument(new Argument('[blocks...]', 'The blocks you want to test.').default([]))\n\t.option('--repo <repo>', 'Repository to download the blocks from.')\n\t.option('-A, --allow', 'Allow jsrepo to download code from the provided repo.', false)\n\t.option('--debug', 'Leaves the temp test file around for debugging upon failure.', false)\n\t.option('--no-cache', 'Disable caching of resolved git urls.')\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (blockNames, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _test(blockNames, options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _test(blockNames: string[], options: Options) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tverbose(`Attempting to test ${JSON.stringify(blockNames)}`);\n\n\tconst config = getProjectConfig(options.cwd).match(\n\t\t(val) => val,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tlet repoPaths = config.repos;\n\n\t// we just want to override all others if supplied via the CLI\n\tif (options.repo) repoPaths = [options.repo];\n\n\tif (!options.allow && options.repo) {\n\t\tconst result = await confirm({\n\t\t\tmessage: `Allow ${color.cyan('jsrepo')} to download and run code from ${color.cyan(options.repo)}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\t}\n\n\tif (!options.verbose) loading.start(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst resolvedRepos: registry.RegistryProviderState[] = (\n\t\tawait registry.forEachPathGetProviderState(repoPaths, { noCache: !options.cache })\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed to get info for ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tverbose(`Resolved ${color.cyan(repoPaths.join(', '))}`);\n\n\tverbose(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst blocksMap = (\n\t\tawait registry.fetchBlocks(resolvedRepos, {\n\t\t\tverbose: options.verbose ? verbose : undefined,\n\t\t})\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed fetching blocks from ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tverbose(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tif (!options.verbose) loading.stop(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst tempTestDirectory = path.resolve(\n\t\tpath.join(options.cwd, `blocks-tests-temp-${Date.now()}`)\n\t);\n\n\tverbose(`Trying to create the temp directory ${color.bold(tempTestDirectory)}.`);\n\n\tfs.mkdirSync(tempTestDirectory, { recursive: true });\n\n\tconst cleanUp = () => {\n\t\tfs.rmSync(tempTestDirectory, { recursive: true, force: true });\n\t};\n\n\tconst installedBlocks = getInstalled(blocksMap, config, options.cwd).map(\n\t\t(val) => val.specifier\n\t);\n\n\tlet testingBlocks = blockNames;\n\n\t// in the case that we want to test all files\n\tif (blockNames.length === 0) {\n\t\ttestingBlocks = installedBlocks;\n\t}\n\n\tif (testingBlocks.length === 0) {\n\t\tcleanUp();\n\t\tprogram.error(color.red('There were no blocks found in your project!'));\n\t}\n\n\tconst testingBlocksMapped: { name: string; block: registry.RemoteBlock }[] = [];\n\n\tfor (const blockSpecifier of testingBlocks) {\n\t\tlet block: registry.RemoteBlock | undefined = undefined;\n\n\t\tconst provider = registry.selectProvider(blockSpecifier);\n\n\t\t// if the block starts with github (or another provider) we know it has been resolved\n\t\tif (!provider) {\n\t\t\tfor (const repo of repoPaths) {\n\t\t\t\t// we unwrap because we already checked this\n\t\t\t\tconst provider = registry.selectProvider(repo);\n\n\t\t\t\tif (!provider) continue;\n\n\t\t\t\tconst { url: parsedRepo, specifier } = provider.parse(\n\t\t\t\t\turl.join(repo, blockSpecifier),\n\t\t\t\t\t{\n\t\t\t\t\t\tfullyQualified: true,\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tconst tempBlock = blocksMap.get(url.join(parsedRepo, specifier!));\n\n\t\t\t\tif (tempBlock === undefined) continue;\n\n\t\t\t\tblock = tempBlock;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tconst { url: repo } = provider.parse(blockSpecifier, { fullyQualified: true });\n\n\t\t\tconst providerState = (await registry.getProviderState(repo)).match(\n\t\t\t\t(val) => val,\n\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t);\n\n\t\t\tconst map = (await registry.fetchBlocks([providerState])).match(\n\t\t\t\t(val) => val,\n\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t);\n\n\t\t\tfor (const [k, v] of map) {\n\t\t\t\tblocksMap.set(k, v);\n\t\t\t}\n\n\t\t\tblock = blocksMap.get(blockSpecifier);\n\t\t}\n\n\t\tif (!block) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(`Invalid block! ${color.bold(blockSpecifier)} does not exist!`)\n\t\t\t);\n\t\t}\n\n\t\ttestingBlocksMapped.push({ name: blockSpecifier, block });\n\t}\n\n\tconst resolvedPaths = resolvePaths(config.paths, options.cwd).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tfor (const { block } of testingBlocksMapped) {\n\t\tconst providerState = block.sourceRepo;\n\n\t\tconst fullSpecifier = url.join(block.sourceRepo.url, block.category, block.name);\n\n\t\tif (!options.verbose) {\n\t\t\tloading.start(`Setting up test file for ${color.cyan(fullSpecifier)}`);\n\t\t}\n\n\t\tif (!block.tests) {\n\t\t\tloading.stop(`No tests found for ${color.cyan(fullSpecifier)}`);\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet directory = getPathForBlock(block, resolvedPaths, options.cwd);\n\n\t\tdirectory = path.relative(tempTestDirectory, directory);\n\n\t\tconst getSourceFile = async (filePath: string) => {\n\t\t\tconst content = await registry.fetchRaw(providerState, filePath);\n\n\t\t\tif (content.isErr()) {\n\t\t\t\tloading.stop(color.red(`Error fetching ${color.bold(filePath)}`));\n\t\t\t\tprogram.error(color.red(`There was an error trying to get ${fullSpecifier}`));\n\t\t\t}\n\n\t\t\treturn content.unwrap();\n\t\t};\n\n\t\tverbose(`Downloading and copying test files for ${fullSpecifier}`);\n\n\t\tconst testFiles: string[] = [];\n\n\t\tfor (const testFile of block.files.filter((file) => isTestFile(file))) {\n\t\t\tconst content = await getSourceFile(path.join(block.directory, testFile));\n\n\t\t\tconst destPath = path.join(tempTestDirectory, testFile);\n\n\t\t\tfs.writeFileSync(destPath, content);\n\n\t\t\ttestFiles.push(destPath);\n\t\t}\n\n\t\t// resolve imports for the block\n\t\tfor (const file of testFiles) {\n\t\t\tverbose(`Opening test file ${file}`);\n\n\t\t\tlet code = fs.readFileSync(file).toString();\n\n\t\t\tconst result = oxc.parseSync(file, code);\n\n\t\t\tfor (const mod of result.module.staticImports) {\n\t\t\t\tconst moduleSpecifier = mod.moduleRequest.value;\n\n\t\t\t\tlet newModuleSpecifier: string | undefined = undefined;\n\n\t\t\t\tif (moduleSpecifier.startsWith('.')) {\n\t\t\t\t\tif (block.subdirectory) {\n\t\t\t\t\t\tnewModuleSpecifier = path.join(directory, block.name, moduleSpecifier);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewModuleSpecifier = path.join(directory, moduleSpecifier);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (newModuleSpecifier) {\n\t\t\t\t\t// this way we only replace the exact import since it will be surrounded in quotes\n\t\t\t\t\tconst literalRegex = new RegExp(\n\t\t\t\t\t\t`(['\"])${escapeStringRegexp(moduleSpecifier)}\\\\1`,\n\t\t\t\t\t\t'g'\n\t\t\t\t\t);\n\n\t\t\t\t\tcode = code.replaceAll(literalRegex, `$1${newModuleSpecifier}$1`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfs.writeFileSync(file, code);\n\t\t}\n\n\t\tverbose(`Completed ${color.cyan.bold(fullSpecifier)} test file`);\n\n\t\tif (!options.verbose) {\n\t\t\tloading.stop(`Completed setup for ${color.bold(fullSpecifier)}`);\n\t\t}\n\t}\n\n\tverbose('Beginning testing');\n\n\tconst pm = await detect({ cwd: options.cwd });\n\n\tif (pm == null) {\n\t\tprogram.error(color.red('Could not detect package manager'));\n\t}\n\n\tconst resolved = resolveCommand(pm.agent, 'execute', ['vitest', 'run', tempTestDirectory]);\n\n\tif (resolved == null) {\n\t\tprogram.error(color.red(`Could not resolve add command for '${pm.agent}'.`));\n\t}\n\n\tconst testCommand = `${resolved.command} ${resolved.args.join(' ')}`;\n\n\tverbose(`Running ${color.cyan(testCommand)} on ${color.cyan(options.cwd)}`);\n\n\ttry {\n\t\tconst proc = x(resolved.command, resolved.args, { nodeOptions: { cwd: options.cwd } });\n\n\t\tfor await (const line of proc) {\n\t\t\tprocess.stdout.write(`${line}\\n`);\n\t\t}\n\n\t\tcleanUp();\n\t} catch (err) {\n\t\tif (options.debug) {\n\t\t\tconsole.info(\n\t\t\t\t`${color.bold('--debug')} flag provided. Skipping cleanup. Run '${color.bold(\n\t\t\t\t\ttestCommand\n\t\t\t\t)}' to retry tests.\\n`\n\t\t\t);\n\t\t} else {\n\t\t\tcleanUp();\n\t\t}\n\n\t\tprogram.error(color.red(`Tests failed! Error ${err}`));\n\t}\n}\n\nexport { test };\n","import { cancel, confirm, isCancel, log, outro, password, select, text } from '@clack/prompts';\nimport color from 'chalk';\nimport { Argument, Command } from 'commander';\nimport * as v from 'valibot';\nimport { getProjectConfig } from '../utils/config';\nimport { intro } from '../utils/prompts';\nimport { http } from '../utils/registry-providers';\nimport { TokenManager } from '../utils/token-manager';\n\nconst schema = v.object({\n\ttoken: v.optional(v.string()),\n\tlogout: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nconst services = ['Anthropic', 'Azure', 'BitBucket', 'GitHub', 'GitLab', 'OpenAI', 'http'].sort();\n\nexport const tokens = new Command('tokens')\n\t.description('Provide a token for access to private repositories.')\n\t.addArgument(\n\t\tnew Argument('service', 'The service you want to authenticate to.')\n\t\t\t.choices(services.map((s) => s.toLowerCase()))\n\t\t\t.argOptional()\n\t)\n\t.option('--logout', 'Execute the logout flow.', false)\n\t.option('--token <token>', 'The token to use for authenticating to this service.')\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (service, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _tokens(service, options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _tokens(service: string | undefined, options: Options) {\n\tconst configuredRegistries: string[] = getProjectConfig(options.cwd).match(\n\t\t(v) => v.repos.filter(http.matches),\n\t\t() => []\n\t);\n\n\tlet selectedService = services.find((s) => s.toLowerCase() === service?.toLowerCase());\n\n\tconst storage = new TokenManager();\n\n\t// logout flow\n\tif (options.logout) {\n\t\tif (selectedService !== undefined) {\n\t\t\tif (selectedService === 'http') {\n\t\t\t\tawait promptHttpLogout(storage);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstorage.delete(selectedService);\n\t\t\tlog.success(`Logged out of ${selectedService}.`);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const serviceName of services) {\n\t\t\tif (serviceName === 'http') {\n\t\t\t\tawait promptHttpLogout(storage);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (storage.get(serviceName) === undefined) {\n\t\t\t\tlog.step(color.gray(`Already logged out of ${color.bold(serviceName)}.`));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst response = await confirm({\n\t\t\t\tmessage: `Logout of ${color.bold(serviceName)}?`,\n\t\t\t\tinitialValue: true,\n\t\t\t});\n\n\t\t\tif (isCancel(response)) {\n\t\t\t\tcancel('Canceled!');\n\t\t\t\tprocess.exit(0);\n\t\t\t}\n\n\t\t\tif (!response) continue;\n\n\t\t\tstorage.delete(serviceName);\n\t\t}\n\n\t\treturn;\n\t}\n\n\t// login flow\n\tif (selectedService === undefined) {\n\t\tconst response = await select({\n\t\t\tmessage: 'Which service do you want to authenticate to?',\n\t\t\toptions: services.map((serviceName) => ({\n\t\t\t\tlabel: serviceName,\n\t\t\t\tvalue: serviceName,\n\t\t\t})),\n\t\t\tinitialValue: services[0],\n\t\t});\n\n\t\tif (isCancel(response)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tselectedService = response;\n\n\t\tif (selectedService === 'http') {\n\t\t\tlet selectedRegistry = 'Other';\n\n\t\t\tif (configuredRegistries.length > 0) {\n\t\t\t\tconfiguredRegistries.push('Other');\n\n\t\t\t\tconst response = await select({\n\t\t\t\t\tmessage: 'Which registry do you want to authenticate to?',\n\t\t\t\t\toptions: configuredRegistries.map((serviceName) => ({\n\t\t\t\t\t\tlabel: serviceName,\n\t\t\t\t\t\tvalue: serviceName,\n\t\t\t\t\t})),\n\t\t\t\t\tinitialValue: services[0],\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(response)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tselectedRegistry = new URL(response).origin;\n\t\t\t}\n\n\t\t\t// prompt for registry\n\t\t\tif (selectedRegistry === 'Other') {\n\t\t\t\tconst response = await text({\n\t\t\t\t\tmessage: 'Please enter the registry url you want to authenticate to:',\n\t\t\t\t\tplaceholder: 'https://example.com',\n\t\t\t\t\tvalidate(value) {\n\t\t\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// try to parse the url\n\t\t\t\t\t\t\tnew URL(value);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// if parsing fails return the error\n\t\t\t\t\t\t\treturn 'Please provide a valid url';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (isCancel(response)) {\n\t\t\t\t\tcancel('Canceled!');\n\t\t\t\t\tprocess.exit(0);\n\t\t\t\t}\n\n\t\t\t\tselectedRegistry = new URL(response).origin;\n\t\t\t}\n\n\t\t\tselectedService = `http-${selectedRegistry}`;\n\t\t}\n\t}\n\n\tlet serviceName = selectedService;\n\n\tif (serviceName.startsWith('http')) {\n\t\tserviceName = serviceName.slice(5);\n\t}\n\n\tif (options.token === undefined) {\n\t\tconst response = await password({\n\t\t\tmessage: `Paste your token for ${color.bold(serviceName)}:`,\n\t\t\tvalidate(value) {\n\t\t\t\tif (value.trim() === '') return 'Please provide a value';\n\t\t\t},\n\t\t});\n\n\t\tif (isCancel(response) || !response) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\toptions.token = response;\n\t}\n\n\tstorage.set(selectedService, options.token);\n\n\tlog.success(`Logged into ${color.bold(serviceName)}.`);\n}\n\nasync function promptHttpLogout(storage: TokenManager) {\n\t// list all providers for logout\n\tconst registries = storage.getHttpRegistriesWithTokens();\n\n\tif (registries.length === 0) {\n\t\tlog.step(color.gray(`Already logged out of ${color.bold('http')}.`));\n\t}\n\n\tfor (const registry of registries) {\n\t\tlet registryUrl: URL;\n\n\t\ttry {\n\t\t\tregistryUrl = new URL(registry);\n\t\t} catch {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst response = await confirm({\n\t\t\tmessage: `Logout of ${color.bold(registryUrl.origin)}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(response)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tif (!response) continue;\n\n\t\tstorage.delete(`http-${registryUrl.origin}`);\n\t}\n}\n","import fs from 'node:fs';\nimport { cancel, confirm, isCancel, multiselect, outro } from '@clack/prompts';\nimport color from 'chalk';\nimport { Command, program } from 'commander';\nimport { resolveCommand } from 'package-manager-detector/commands';\nimport { detect } from 'package-manager-detector/detect';\nimport * as v from 'valibot';\nimport * as ascii from '../utils/ascii';\nimport { getBlockFilePath, getInstalled, preloadBlocks, resolveTree } from '../utils/blocks';\nimport * as url from '../utils/blocks/ts/url';\nimport { getProjectConfig, resolvePaths } from '../utils/config';\nimport { transformRemoteContent } from '../utils/files';\nimport { loadFormatterConfig } from '../utils/format';\nimport { getWatermark } from '../utils/get-watermark';\nimport { checkPreconditions } from '../utils/preconditions';\nimport {\n\tintro,\n\tnextSteps,\n\tpromptInstallDependencies,\n\tpromptUpdateFile,\n\tspinner,\n} from '../utils/prompts';\nimport * as registry from '../utils/registry-providers/internal';\n\nconst schema = v.object({\n\tall: v.boolean(),\n\texpand: v.boolean(),\n\tmaxUnchanged: v.number(),\n\tno: v.boolean(),\n\trepo: v.optional(v.string()),\n\tallow: v.boolean(),\n\tyes: v.boolean(),\n\tcache: v.boolean(),\n\tverbose: v.boolean(),\n\tcwd: v.string(),\n});\n\ntype Options = v.InferInput<typeof schema>;\n\nconst update = new Command('update')\n\t.description('Update blocks to the code in the remote repository.')\n\t.argument('[blocks...]', 'Names of the blocks you want to update. ex: (utils/math)')\n\t.option('--all', 'Update all installed components.', false)\n\t.option('-E, --expand', 'Expands the diff so you see the entire file.', false)\n\t.option(\n\t\t'--max-unchanged <number>',\n\t\t'Maximum unchanged lines that will show without being collapsed.',\n\t\t(val) => Number.parseInt(val), // this is such a dumb api thing\n\t\t3\n\t)\n\t.option('-n, --no', 'Do update any blocks.', false)\n\t.option('--repo <repo>', 'Repository to download the blocks from.')\n\t.option('-A, --allow', 'Allow jsrepo to download code from the provided repo.', false)\n\t.option('-y, --yes', 'Skip confirmation prompt.', false)\n\t.option('--no-cache', 'Disable caching of resolved git urls.')\n\t.option('--verbose', 'Include debug logs.', false)\n\t.option('--cwd <path>', 'The current working directory.', process.cwd())\n\t.action(async (blockNames, opts) => {\n\t\tconst options = v.parse(schema, opts);\n\n\t\tawait intro();\n\n\t\tawait _update(blockNames, options);\n\n\t\toutro(color.green('All done!'));\n\t});\n\nasync function _update(blockNames: string[], options: Options) {\n\tconst verbose = (msg: string) => {\n\t\tif (options.verbose) {\n\t\t\tconsole.info(`${ascii.INFO} ${msg}`);\n\t\t}\n\t};\n\n\tverbose(`Attempting to update ${JSON.stringify(blockNames)}`);\n\n\tconst loading = spinner({ verbose: options.verbose ? verbose : undefined });\n\n\tconst config = getProjectConfig(options.cwd).match(\n\t\t(val) => val,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tlet repoPaths = config.repos;\n\n\t// we just want to override all others if supplied via the CLI\n\tif (options.repo) repoPaths = [options.repo];\n\n\t// ensure blocks do not provide repos\n\tfor (const blockSpecifier of blockNames) {\n\t\tif (registry.providers.find((p) => blockSpecifier.startsWith(p.name))) {\n\t\t\tprogram.error(\n\t\t\t\tcolor.red(\n\t\t\t\t\t`Invalid value provided for block names \\`${color.bold(blockSpecifier)}\\`. Block names are expected to be provided in the format of \\`${color.bold('<category>/<name>')}\\``\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!options.allow && options.repo) {\n\t\tconst result = await confirm({\n\t\t\tmessage: `Allow ${color.cyan('jsrepo')} to download and run code from ${color.cyan(options.repo)}?`,\n\t\t\tinitialValue: true,\n\t\t});\n\n\t\tif (isCancel(result) || !result) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\t}\n\n\tverbose(`Resolving ${color.cyan(repoPaths.join(', '))}`);\n\n\tif (!options.verbose) loading.start(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst resolvedRepos: registry.RegistryProviderState[] = (\n\t\tawait registry.forEachPathGetProviderState(repoPaths, { noCache: !options.cache })\n\t).match(\n\t\t(val) => val,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed to get info for ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tverbose(`Resolved ${color.cyan(repoPaths.join(', '))}`);\n\n\tverbose(`Fetching blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tconst manifests = (await registry.fetchManifests(resolvedRepos)).match(\n\t\t(v) => v,\n\t\t({ repo, message }) => {\n\t\t\tloading.stop(`Failed fetching blocks from ${color.cyan(repo)}`);\n\t\t\tprogram.error(color.red(message));\n\t\t}\n\t);\n\n\tconst blocksMap = registry.getRemoteBlocks(manifests);\n\n\tif (!options.verbose) loading.stop(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tverbose(`Retrieved blocks from ${color.cyan(repoPaths.join(', '))}`);\n\n\tfor (const manifest of manifests) {\n\t\tcheckPreconditions(manifest.state, manifest.manifest, options.cwd);\n\t}\n\n\tconst installedBlocks = getInstalled(blocksMap, config, options.cwd);\n\n\tif (installedBlocks.length === 0) {\n\t\tprogram.error(\n\t\t\tcolor.red(\n\t\t\t\t`You haven't installed any blocks yet. Did you mean to \\`${color.bold('add')}\\`?`\n\t\t\t)\n\t\t);\n\t}\n\n\tlet updatingBlockNames = blockNames;\n\n\tif (options.all) {\n\t\tupdatingBlockNames = installedBlocks.map((block) => block.specifier);\n\t}\n\n\t// if no blocks are provided prompt the user for what blocks they want\n\tif (updatingBlockNames.length === 0) {\n\t\tconst promptResult = await multiselect({\n\t\t\tmessage: `Which blocks would you like to ${options.no ? 'diff' : 'update'}?`,\n\t\t\toptions: installedBlocks\n\t\t\t\t.filter((b) => b.block.list)\n\t\t\t\t.map((block) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: `${color.cyan(block.block.category)}/${block.block.name}`,\n\t\t\t\t\t\tvalue: block.specifier,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\trequired: true,\n\t\t});\n\n\t\tif (isCancel(promptResult)) {\n\t\t\tcancel('Canceled!');\n\t\t\tprocess.exit(0);\n\t\t}\n\n\t\tupdatingBlockNames = promptResult as string[];\n\t}\n\n\tverbose(`Preparing to update ${color.cyan(updatingBlockNames.join(', '))}`);\n\n\tconst updatingBlocks = (await resolveTree(updatingBlockNames, blocksMap, resolvedRepos)).match(\n\t\t(val) => val,\n\t\tprogram.error\n\t);\n\n\tconst devDeps: Set<string> = new Set<string>();\n\tconst deps: Set<string> = new Set<string>();\n\n\tconst { prettierOptions, biomeOptions } = await loadFormatterConfig({\n\t\tformatter: config.formatter,\n\t\tcwd: options.cwd,\n\t});\n\n\tconst resolvedPaths = resolvePaths(config.paths, options.cwd).match(\n\t\t(v) => v,\n\t\t(err) => program.error(color.red(err))\n\t);\n\n\tconst preloadedBlocks = preloadBlocks(updatingBlocks, config);\n\n\tfor (const preloadedBlock of preloadedBlocks) {\n\t\tconst fullSpecifier = url.join(\n\t\t\tpreloadedBlock.block.sourceRepo.url,\n\t\t\tpreloadedBlock.block.category,\n\t\t\tpreloadedBlock.block.name\n\t\t);\n\n\t\tconst watermark = getWatermark(preloadedBlock.block.sourceRepo.url);\n\n\t\tverbose(`Attempting to update ${fullSpecifier}`);\n\n\t\tif (config.includeTests && preloadedBlock.block.tests) {\n\t\t\tverbose('Trying to include tests');\n\n\t\t\tdevDeps.add('vitest');\n\t\t}\n\n\t\tfor (const dep of preloadedBlock.block.devDependencies) {\n\t\t\tdevDeps.add(dep);\n\t\t}\n\n\t\tfor (const dep of preloadedBlock.block.dependencies) {\n\t\t\tdeps.add(dep);\n\t\t}\n\n\t\tconst files = await preloadedBlock.files;\n\n\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}\\n`);\n\n\t\tprocess.stdout.write(`${ascii.VERTICAL_LINE}  ${fullSpecifier}\\n`);\n\n\t\tfor (const file of files) {\n\t\t\tconst content = file.content.match(\n\t\t\t\t(v) => v,\n\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t);\n\n\t\t\tconst destPath = getBlockFilePath(\n\t\t\t\tfile.name,\n\t\t\t\tpreloadedBlock.block,\n\t\t\t\tresolvedPaths,\n\t\t\t\toptions.cwd\n\t\t\t);\n\n\t\t\tconst remoteContent = (\n\t\t\t\tawait transformRemoteContent({\n\t\t\t\t\tfile: {\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\tdestPath: destPath,\n\t\t\t\t\t},\n\t\t\t\t\tbiomeOptions,\n\t\t\t\t\tprettierOptions,\n\t\t\t\t\tconfig,\n\t\t\t\t\timports: preloadedBlock.block._imports_,\n\t\t\t\t\twatermark,\n\t\t\t\t\tverbose,\n\t\t\t\t\tcwd: options.cwd,\n\t\t\t\t})\n\t\t\t).match(\n\t\t\t\t(v) => v,\n\t\t\t\t(err) => program.error(color.red(err))\n\t\t\t);\n\n\t\t\tlet localContent = '';\n\t\t\tif (fs.existsSync(destPath)) {\n\t\t\t\tlocalContent = fs.readFileSync(destPath).toString();\n\t\t\t}\n\n\t\t\tconst updateResult = await promptUpdateFile({\n\t\t\t\tconfig: { biomeOptions, prettierOptions, formatter: config.formatter },\n\t\t\t\tcurrent: {\n\t\t\t\t\tpath: destPath,\n\t\t\t\t\tcontent: localContent,\n\t\t\t\t},\n\t\t\t\tincoming: {\n\t\t\t\t\tpath: url.join(fullSpecifier, file.name),\n\t\t\t\t\tcontent: remoteContent,\n\t\t\t\t},\n\t\t\t\toptions: {\n\t\t\t\t\t...options,\n\t\t\t\t\tloading,\n\t\t\t\t\tverbose: options.verbose ? verbose : undefined,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (updateResult.applyChanges) {\n\t\t\t\tloading.start(`Writing changes to ${color.cyan(destPath)}`);\n\n\t\t\t\tfs.writeFileSync(destPath, updateResult.updatedContent);\n\n\t\t\t\tloading.stop(`Wrote changes to ${color.cyan(destPath)}.`);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst pm = (await detect({ cwd: options.cwd }))?.agent ?? 'npm';\n\n\tconst installResult = await promptInstallDependencies(deps, devDeps, {\n\t\tyes: options.yes,\n\t\tno: options.no,\n\t\tcwd: options.cwd,\n\t\tpm,\n\t});\n\n\tif (installResult.dependencies.size > 0 || installResult.devDependencies.size > 0) {\n\t\t// next steps if they didn't install dependencies\n\t\tlet steps = [];\n\n\t\tif (!installResult.installed) {\n\t\t\tif (deps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...deps]);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (devDeps.size > 0) {\n\t\t\t\tconst cmd = resolveCommand(pm, 'add', [...devDeps, '-D']);\n\n\t\t\t\tsteps.push(\n\t\t\t\t\t`Install dev dependencies \\`${color.cyan(`${cmd?.command} ${cmd?.args.join(' ')}`)}\\``\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// put steps with numbers above here\n\t\tsteps = steps.map((step, i) => `${i + 1}. ${step}`);\n\n\t\tif (!installResult.installed) {\n\t\t\tsteps.push('');\n\t\t}\n\n\t\tsteps.push('Import and use the blocks!');\n\n\t\tconst next = nextSteps(steps);\n\n\t\tprocess.stdout.write(next);\n\t}\n}\n\nexport { update };\n","import { program } from 'commander';\nimport pkg from '../package.json';\nimport * as commands from './commands';\n\nconst cli = program\n\t.name(pkg.name)\n\t.description(pkg.description)\n\t.version(pkg.version)\n\t.addCommand(commands.add)\n\t.addCommand(commands.auth)\n\t.addCommand(commands.build)\n\t.addCommand(commands.exec)\n\t.addCommand(commands.info)\n\t.addCommand(commands.init)\n\t.addCommand(commands.mcp)\n\t.addCommand(commands.publish)\n\t.addCommand(commands.test)\n\t.addCommand(commands.tokens)\n\t.addCommand(commands.update);\n\nexport { cli };\n","#!/usr/bin/env node\n\nimport { cli } from './cli';\n\ncli.parse();\n"]}